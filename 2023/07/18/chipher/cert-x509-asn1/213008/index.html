<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="EtcFly"><meta name="keywords" content=""><meta name="description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介   证书是通过抽象的语言描述的一种数据结构, ASN.1广泛用于描述各种证书的编码组成, 在电信和计算机网络领域，ASN.1（Abstract Syntax Notation One) 是一套描述数据的表示、编码、传输、解码的标准语"><meta property="og:type" content="article"><meta property="og:title" content="证书的类型和格式"><meta property="og:url" content="http://example.com/2023/07/18/chipher/cert-x509-asn1/213008/"><meta property="og:site_name" content="仗剑走天涯"><meta property="og:description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介   证书是通过抽象的语言描述的一种数据结构, ASN.1广泛用于描述各种证书的编码组成, 在电信和计算机网络领域，ASN.1（Abstract Syntax Notation One) 是一套描述数据的表示、编码、传输、解码的标准语"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/tls.png"><meta property="article:published_time" content="2023-07-18T21:30:08.000Z"><meta property="article:modified_time" content="2024-03-05T03:41:03.000Z"><meta property="article:author" content="EtcFly"><meta property="article:tag" content="原创"><meta property="article:tag" content="证书格式 - x509 - ASN.1"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/img/tls.png"><title>证书的类型和格式 仗剑走天涯</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/fluid-extention.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:4},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"3AEufnWAJdp8cFODp1DXvrQU-MdYXbMMI",app_key:"mGJiL6xVvYv21ygqfynJoCyO",server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Strive For Dream</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="证书的类型和格式"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-07-18 21:30" pubdate>2023年7月18日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 25k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 206 分钟 </span><span id="vvdpost_container_page_pvuv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="vvdpost_value_page_pv">0</span> 次&nbsp&nbsp <i class="iconfont icon-users" aria-hidden="true"></i> <span id="vvdpost_value_page_uv">0</span> 人</span><script>console.log(window.location.pathname);var httpRequest=new XMLHttpRequest;httpRequest.open("POST","https://etcfly.top:14200/poststats",!0),httpRequest.setRequestHeader("Content-type","application/json"),httpRequest.send(JSON.stringify(window.location.pathname)),httpRequest.onreadystatechange=function(){if(4==httpRequest.readyState&&200==httpRequest.status){var e=httpRequest.responseText,t=JSON.parse(e);console.log(t.pv);var o=document.querySelector("#vvdpost_container_page_pvuv");if(console.log(o),o){var n=document.querySelector("#vvdpost_value_page_pv");console.log(n);var s=document.querySelector("#vvdpost_value_page_uv");console.log(s),s&&s&&(n.innerText=t.pv,s.innerText=t.uv,o.style.display="inline")}}}</script></div></div></div></div></div></div><script async src="https://etcfly.top:14100/script.js" data-website-id="1a5c096d-21e5-4556-99b0-28c810c9c868"></script></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">证书的类型和格式</h1><p class="note note-info">本文最后更新于：2024年3月5日 凌晨</p><div class="markdown-body"><div class="note note-success"><p>版权归作者所有, 转载请保留该部分声明。<br>本文作者：EtcFly<br>原文地址：<a target="_blank" rel="noopener" href="https://etcfly.top">https://etcfly.top</a></p></div><hr><h3 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h3><p>  证书是通过抽象的语言描述的一种数据结构, <code>ASN.1</code>广泛用于描述各种证书的编码组成, 在电信和计算机网络领域，<code>ASN.1</code>（<code>Abstract Syntax Notation One</code>) 是一套描述数据的表示、编码、传输、解码的标准语言。它提供了一套正式、无歧义和精确的规则以描述独立于特定计算机硬件的对象结构。</p><p>  最初是<code>1984</code>年的<code>CCITT X.409:1984</code> 的一部分。由于其广泛应用，<code>1988</code> 年<code>ASN.1</code> 移到独立标准<code>X.208</code>，<code>1995</code>年进行全面修订后变成<code>X.680</code>系列标准。相关标准包括 <a target="_blank" rel="noopener" href="https://www.itu.int/rec/T-REC-X.680">X.680</a>（定义了 <code>ASN.1</code> 语言）和 <a target="_blank" rel="noopener" href="https://www.itu.int/rec/T-REC-X.690">X.690</a>（定义了 <code>DER</code> 和 <code>BER</code> 序列化格式）， 其前身分别是 <a target="_blank" rel="noopener" href="https://www.itu.int/rec/T-REC-X.208/en">X.208</a> 与 <a target="_blank" rel="noopener" href="https://www.itu.int/rec/T-REC-X.209/en">X.209</a>。</p><blockquote><p>  <code>ASN.1</code>本身只定义了表示信息的抽象句法，但是没有限定其编码的方法。各种<code>ASN.1</code>的编码规则为由<code>ASN.1</code>描述的抽象句法提供了详细的格式表达方法。标准的<code>ASN.1</code>编码规则有：</p></blockquote><ul><li>基本编码规则 （<code>BER，Basic Encoding Rules</code>）: <code>BER (Basic Encoding Rules)</code> 是一种很灵活的编码</li><li>唯一编码规则 （<code>DER，Distinguished Encoding Rules</code>）：在 <code>BER</code> 的基础上加入了规范化的规则，从而保证同样的信息编码方式也是唯一的</li><li>规范编码规则 （<code>CER，Canonical Encoding Rules</code>）</li><li>压缩编码规则 （<code>PER，Packed Encoding Rules</code>）: 编码更为紧凑，适合对存储空间或传输速度要求较高的场景</li><li><code>XML</code>编码规则（<code>XER，XML Encoding Rules</code>）: 在需要使用 <code>XML</code> 的情况下使用</li></ul><p>各类证书根据<code>ASN.1</code>编码规则定义自己的证书形式。常见采用<code>CER</code>、<code>DER</code>编码格式。如主流的<code>Web</code>服务软件采用证书格式通常如下:</p><ul><li><code>Apache</code>、<code>Nginx</code>等<code>Web</code>服务软件，一般使用<code>OpenSSL</code>工具提供的密码库，生成<code>PEM</code>、<code>KEY</code>、<code>CRT</code>等格式的证书文件。</li></ul><p>常用的<code>HTTPS</code>证书通常采用 <code>DER</code> 编码。 当然用 <code>BER</code> 也是可以的，但是数字签名必须根据 <code>DER</code> 编码计算，和证书的实际编码方式无关, 因此很少使用<code>BER</code>来编码<code>HTTPS</code>证书。</p><p><strong>注意</strong></p><ul><li><code>PEM</code>是<code>DER</code>经过<code>Base64</code>编码后, 并添加分隔线（“<code>-----BEGIN CERTIFICATE-----</code>” 和&quot;<code>-----END CERTIFICATE-----</code>&quot;）</li></ul><hr><h3 id="证书格式"><a class="markdownIt-Anchor" href="#证书格式"></a> 证书格式</h3><p>  您可以使用以下方法简单区分带有后缀扩展名的证书文件：</p><ul><li><code>*.DER</code> 或 <code>*.CER</code> 文件：这样的证书文件是二进制格式，只含有证书信息，不包含私钥。</li><li><code>*.CRT</code>文件：这样的证书文件可以是二进制格式，也可以是文本格式，一般均为文本格式，功能与 <code>*.DER</code> 及 <code>*.CER</code> 证书文件相同。</li><li><code>*.PEM</code> 文件：这样的证书文件一般是文本格式，可以存放证书或私钥，或者两者都包含。<code>*.PEM</code> 文件如果只包含私钥，一般用<code>*.KEY</code>文件代替。</li><li><code>*.PFX</code> 或 <code>*.P12</code> 文件：这样的证书文件是二进制格式，同时包含证书和私钥，且一般有密码保护。</li><li><code>*.CSR(Certificate Signing Request)</code> ,即证书签名请求,这个并不是证书,而是向权威证书颁发机构获得签名证书的申请,其核心内容是一个公钥(当然还附带了一些别的信息),在生成这个申请的时候,同时也会生成一个私钥。</li></ul><p>您也可以使用记事本直接打开证书文件。如果显示的是规则的数字和字母，则表示该证书文件是文本格式。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">—–BEGIN CERTIFICATE—–<br>MIIE5zCCA8+gAwIBAgIQN+whYc2BgzAogau0dc3PtzANBgkqh......<br>—–END CERTIFICATE—–<br></code></pre></td></tr></table></figure><blockquote><ul><li>如果存在“<code>——BEGIN CERTIFICATE——</code>”，则说明这是一个证书文件。</li><li>如果存在“<code>—–BEGIN RSA PRIVATE KEY—–</code>”，则说明这是一个私钥文件。</li></ul></blockquote><hr><h3 id="x509"><a class="markdownIt-Anchor" href="#x509"></a> X.509</h3><p>  <code>X.509</code>是公钥证书的格式标准, 被广泛用于<code>TLS/SSL</code>安全<br>目前常用的<code>HTTPS</code> 证书就是<code>X.509</code>标准。遵从<code>X.509</code>格式标准的证书一般为 <code>DER</code>/<code>PEM</code> 。一般<code>x.509</code>证书如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----BEGIN CERTIFICATE-----<br>MIID1zCCAr+gAwIBAgIUQEhKFTIzoC0cXU0+o+EmHiubxAowDQYJKoZIhvcNAQEL<br>BQAwezELMAkGA1UEBhMCQ04xETAPBgNVBAgMCEhhbmd6aG91MREwDwYDVQQHDAhI<br>YW5nemhvdTELMAkGA1UECgwCVFkxCzAJBgNVBAsMAllNMQswCQYDVQQDDAJteTEf<br>MB0GCSqGSIb3DQEJARYQeGhqd3k1MjBAMTYzLmNvbTAeFw0yMzA2MjYxMzE3MTFa<br>Fw0yNjAzMjIxMzE3MTFaMHsxCzAJBgNVBAYTAkNOMREwDwYDVQQIDAhIYW5nemhv<br>dTERMA8GA1UEBwwISGFuZ3pob3UxCzAJBgNVBAoMAlRZMQswCQYDVQQLDAJZTTEL<br>MAkGA1UEAwwCbXkxHzAdBgkqhkiG9w0BCQEWEHhoand5NTIwQDE2My5jb20wggEi<br>MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDF6hLg2b5N46OPWlFBeJVML0w2<br>SG75OEliO/kxj6jqEvLmty8Fqnlk+y6UZiUipFnPoHcGFQ7Pi5+SuRzjVRFJcHub<br>zP1yfPzsyvLzOhW3C2ZfAIap5twdMZfKHevU7go080ccjsR2O6maVlFsHquFQMhz<br>EsQceMQSH0GcNJHJ3PJpAifBUxsny41Tzq6RZj33pl6UIJ7c2+8cD4tLylvK0JLA<br>JFQCaMU1pnBlzrSJS9d0vn2nCtiKukDFMPyOu2Xm2IyqqusVgYxszpplGcpukfgm<br>eO77eQCxTlvZtNfOsb0d2+v92Kwio+QPr3YYzCDGfcgdX2lwenBcc+PrZ+q7AgMB<br>AAGjUzBRMB0GA1UdDgQWBBQCslPjHxcpgihg67S5TWY1VhTOjTAfBgNVHSMEGDAW<br>gBQCslPjHxcpgihg67S5TWY1VhTOjTAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3<br>DQEBCwUAA4IBAQBpWblM2Ewr0hC5nfXa7JCspWcCCffQJ3IzzLhuGt4ac59ec/iU<br>i1O1wjyMFeyMm6bAxLFD0THh04DKLq8SP9DBin2DsXedIjQqJ/xTXya16fk/4MD5<br>24HHRHTfsIX4TryAKDvi+OTipO3muV79sPi73KEFEZz7Va9khkZ6NqfdtanogqW0<br>bXD+lJZr88NXuSpm2OVVTmjh+rYXXMgIUQP2ws7TdtLqjwIsUer+gQ7w8omDes86<br>mXHK8yF6JAjiX6Jj/vSQJMhzWywHOFGO2zVEq6oa8VjVQ2sPTHLupejWr06QbZFz<br>3H8jen2pHEL8rxAOP3dywFO9NPWgyk0FZFdc<br>-----END CERTIFICATE-----<br></code></pre></td></tr></table></figure><p>这是一个典型的<code>PEM</code>格式编码, <code>PEM</code>格式是基于<code>DER</code>格式进行<code>base64</code>转换得到, 转换规则如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs PEM">-----BEGIN CERTIFICATE-----<br>Base64(DER编码)<br>-----END CERTIFICATE-----<br></code></pre></td></tr></table></figure><p>我们可以通过<code>ASN.1</code>语言对<code>X.509</code> 证书进行描述，使用的<code>DER</code>编码, <code>ASN.1</code> 语法描述结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs ANS.1">Certificate  ::=  SEQUENCE  &#123;<br>    tbsCertificate       TBSCertificate,<br>    signatureAlgorithm   AlgorithmIdentifier,<br>    signatureValue       BIT STRING<br>&#125;<br><br>TBSCertificate  ::=  SEQUENCE  &#123;<br>    version         [0]  EXPLICIT Version DEFAULT v1,<br>    serialNumber         CertificateSerialNumber,<br>    signature            AlgorithmIdentifier,<br>    issuer               Name,<br>    validity             Validity,<br>    subject              Name,<br>    subjectPublicKeyInfo SubjectPublicKeyInfo,<br>    issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,<br>                            -- If present, version MUST be v2 or v3<br><br>    subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,<br>                            -- If present, version MUST be v2 or v3<br>    extensions      [3]  EXPLICIT Extensions OPTIONAL<br>                            -- If present, version MUST be v3<br>&#125;<br><br>Version  ::=  INTEGER  &#123;  v1(0), v2(1), v3(2)  &#125;<br><br>CertificateSerialNumber  ::=  INTEGER<br><br>Validity ::= SEQUENCE &#123;<br>    notBefore      Time,<br>    notAfter       Time<br>&#125;<br><br>Time ::= CHOICE &#123;<br>    utcTime        UTCTime,<br>    generalTime    GeneralizedTime<br>&#125;<br><br>UniqueIdentifier  ::=  BIT STRING<br><br>SubjectPublicKeyInfo  ::=  SEQUENCE  &#123;<br>    algorithm            AlgorithmIdentifier,<br>    subjectPublicKey     BIT STRING<br>&#125;<br><br>Extensions  ::=  SEQUENCE SIZE (1..MAX) OF Extension<br><br>Extension  ::=  SEQUENCE  &#123;<br>    extnID      OBJECT IDENTIFIER,<br>    critical    BOOLEAN DEFAULT FALSE,<br>    extnValue   OCTET STRING<br>                -- contains the DER encoding of an ASN.1 value<br>                -- corresponding to the extension type identified<br>                -- by extnID<br>&#125;<br></code></pre></td></tr></table></figure><p>通过<code>openssl</code>如下命令解析一下该证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl x509 -<span class="hljs-keyword">in</span> ca.crt -text -noout<br></code></pre></td></tr></table></figure><p>得到证书的结构如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash">Certificate:<br>    Data:<br>        Version: 3 (0x2)<br>        Serial Number:<br>            40:48:4a:15:32:33:a0:2d:1c:5d:4d:3e:a3:e1:26:1e:2b:9b:c4:0a<br>        Signature Algorithm: sha256WithRSAEncryption<br>        Issuer: C = CN, ST = Hangzhou, L = Hangzhou, O = TY, OU = YM, CN = my, emailAddress = etcflywy@126.com<br>        Validity<br>            Not Before: Jun 26 13:17:11 2023 GMT<br>            Not After : Mar 22 13:17:11 2026 GMT<br>        Subject: C = CN, ST = Hangzhou, L = Hangzhou, O = TY, OU = YM, CN = my, emailAddress = xhjwy520@163.com<br>        Subject Public Key Info:<br>            Public Key Algorithm: rsaEncryption<br>                RSA Public-Key: (2048 bit)<br>                Modulus:<br>                    00:c5:ea:12:e0:d9:be:4d:e3:a3:8f:5a:51:41:78:<br>                    95:4c:2f:4c:36:48:6e:f9:38:49:62:3b:f9:31:8f:<br>                    a8:ea:12:f2:e6:b7:2f:05:aa:79:64:fb:2e:94:66:<br>                    25:22:a4:59:cf:a0:77:06:15:0e:cf:8b:9f:92:b9:<br>                    1c:e3:55:11:49:70:7b:9b:cc:fd:72:7c:<span class="hljs-built_in">fc</span>:ec:ca:<br>                    f2:f3:3a:15:b7:0b:66:5f:00:86:a9:e6:dc:1d:31:<br>                    97:ca:1d:eb:d4:ee:0a:34:f3:47:1c:8e:c4:76:3b:<br>                    a9:9a:56:51:6c:1e:ab:85:40:c8:73:12:c4:1c:78:<br>                    c4:12:1f:41:9c:34:91:c9:dc:f2:69:02:27:c1:53:<br>                    1b:27:cb:8d:53:ce:ae:91:66:3d:f7:a6:5e:94:20:<br>                    9e:dc:db:ef:1c:0f:8b:4b:ca:5b:ca:d0:92:c0:24:<br>                    54:02:68:c5:35:a6:70:65:ce:b4:89:4b:d7:74:be:<br>                    7d:a7:0a:d8:8a:ba:40:c5:30:<span class="hljs-built_in">fc</span>:8e:bb:65:e6:d8:<br>                    8c:aa:aa:eb:15:81:8c:6c:ce:9a:65:19:ca:6e:91:<br>                    f8:26:78:ee:fb:79:00:b1:4e:5b:d9:b4:d7:ce:b1:<br>                    bd:1d:db:eb:fd:d8:ac:22:a3:e4:0f:af:76:18:cc:<br>                    20:c6:7d:c8:1d:5f:69:70:7a:70:5c:73:e3:eb:67:<br>                    ea:bb<br>                Exponent: 65537 (0x10001)<br>        X509v3 extensions:<br>            X509v3 Subject Key Identifier:<br>                02:B2:53:E3:1F:17:29:82:28:60:EB:B4:B9:4D:66:35:56:14:CE:8D<br>            X509v3 Authority Key Identifier:<br>                keyid:02:B2:53:E3:1F:17:29:82:28:60:EB:B4:B9:4D:66:35:56:14:CE:8D<br><br>            X509v3 Basic Constraints: critical<br>                CA:TRUE<br>    Signature Algorithm: sha256WithRSAEncryption<br>         69:59:b9:4c:d8:4c:2b:d2:10:b9:9d:f5:da:ec:90:ac:a5:67:<br>         02:09:f7:d0:27:72:33:cc:b8:6e:1a:de:1a:73:9f:5e:73:f8:<br>         94:8b:53:b5:c2:3c:8c:15:ec:8c:9b:a6:c0:c4:b1:43:d1:31:<br>         e1:d3:80:ca:2e:af:12:3f:d0:c1:8a:7d:83:b1:77:9d:22:34:<br>         2a:27:<span class="hljs-built_in">fc</span>:53:5f:26:b5:e9:f9:3f:e0:c0:f9:db:81:c7:44:74:<br>         <span class="hljs-built_in">df</span>:b0:85:f8:4e:bc:80:28:3b:e2:f8:e4:e2:a4:ed:e6:b9:5e:<br>         fd:b0:f8:bb:dc:a1:05:11:9c:fb:55:af:64:86:46:7a:36:a7:<br>         <span class="hljs-built_in">dd</span>:b5:a9:e8:82:a5:b4:6d:70:fe:94:96:6b:f3:c3:57:b9:2a:<br>         66:d8:e5:55:4e:68:e1:fa:b6:17:5c:c8:08:51:03:f6:c2:ce:<br>         d3:76:d2:ea:8f:02:2c:51:ea:fe:81:0e:f0:f2:89:83:7a:cf:<br>         3a:99:71:ca:f3:21:7a:24:08:e2:5f:a2:63:fe:f4:90:24:c8:<br>         73:5b:2c:07:38:51:8e:db:35:44:ab:aa:1a:f1:58:d5:43:6b:<br>         0f:4c:72:ee:a5:e8:d6:af:4e:90:6d:91:73:dc:7f:23:7a:7d:<br>         a9:1c:42:<span class="hljs-built_in">fc</span>:af:10:0e:3f:77:72:c0:53:bd:34:f5:a0:ca:4d:<br>         05:64:57:5c<br></code></pre></td></tr></table></figure><p>主要包含信息有:</p><ul><li><code>Version</code>: 版本</li><li><code>Serial Number</code>: 证书的序列号(需要唯一, 用于后期<code>CRL</code>证书吊销提供依据)</li><li><code>Signature Algorithm</code>: 证书签名算法</li><li><code>Issuer</code>: 证书的认证组织信息(通俗的说证书是谁发布的, 谁公证的)</li><li><code>Validity</code>: 证书的有效期限</li><li><code>Subject</code>: 证书的拥有者(谁向<code>CA</code>请求的证书)</li><li><code>Subject Public Key Info</code>: 证书的公钥信息</li><li><code>Signature Algorithm</code>: 由<code>CA</code>认证的签名信息</li></ul><p>证书由<code>CA</code>组织颁发或者其他授信组织颁发, 并依次形成一条完整的信任链, 值得注意, 当证书超过有效期, 应该将该证书丢弃不再使用。接下来在说说<code>X.509</code>证书的常用编码规范<code>DER</code>。</p><hr><h4 id="der编码"><a class="markdownIt-Anchor" href="#der编码"></a> DER编码</h4><p>  <code>ASN.1</code> 支持多种编码格式, <code>DER</code>全称 <code>Distinguished Encoding Rules</code>。 它是对 <code>Basic Encoding Rules</code> (<code>BER</code>) 格式加以严格规范化而成的一种变体。目前, <code>DER</code>编码被广泛用于<code>X.509</code>证书中, <code>DER</code>格式的证书通常会进一步转换成 <code>PEM</code> 格式，这一过程采用 <code>Base64</code> 编码将二进制字节转化为一连串的字母、数字、“<code>+</code>”和“<code>/</code>”符号，并在头尾加入“<code>-----BEGIN CERTIFICATE-----</code>”与“<code>-----END CERTIFICATE-----</code>”两行文字以示分隔。 相对于<code>DER</code>而言，<code>PEM</code> 格式可以方便复制与粘贴。</p><h3 id="格式"><a class="markdownIt-Anchor" href="#格式"></a> 格式</h3><p>  <code>DER</code>采用<code>type-length-value</code>的编码格式, 简称<code>TLV</code>格式, 也就是说，如果按顺序读取 <code>DER</code> 编码的每个字节，首先读取到的是类型信息, 类型信息在<code>ASN.1</code>中称为标签(<code>Tag</code>)。标签后面跟着标签数据的长度, 标签长度可以是单个字节或者多个字节，长度域后面紧跟具体的数据域, 格式如下:</p><p><img src="https://etcfly.top/Images/picture/crypt/CERT/der_tlv%E6%A0%BC%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt="der_tlv格式.png"></p><p>当然, 当使用一些复杂的数据类型时(如<code>SET</code>, <code>SEQUENCE</code>类型), 允许<code>TLV</code>结构的嵌套, 类似于<code>C/C++</code>中结构体嵌套。</p><p><img src="https://etcfly.top/Images/picture/crypt/CERT/der_tlv%E5%B5%8C%E5%A5%97%E6%A0%BC%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt="der_tlv嵌套格式.png"></p><p>接下来我们分别讲解各部分内容。</p><hr><h5 id="标签tag"><a class="markdownIt-Anchor" href="#标签tag"></a> 标签Tag</h5><p>  标签(<code>Tag</code>)用于描述<code>TLV</code>结构中<code>Value</code>具体的数据类型, 通常占用<code>1Byte</code>长度, 如果使用多个字节还可以编码任意大小的标签，但通常没有这个必要。 通用的标签如下表, 由 <code>ASN.1</code> 核心规范定义，在所有 <code>ASN.1</code> 模块中都有着相同的含义。此外还有一些无关紧要的通用标签，这里略去不做描述:</p><p><strong>常见的标签</strong>:</p><table><thead><tr><th style="text-align:center">Tag(dec)</th><th style="text-align:center">Tag(hex)</th><th style="text-align:left">type</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:center"><code>2</code></td><td style="text-align:center"><code>02</code></td><td style="text-align:left"><code>INTEGER</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>3</code></td><td style="text-align:center"><code>03</code></td><td style="text-align:left"><code>BIT STRING</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>4</code></td><td style="text-align:center"><code>04</code></td><td style="text-align:left"><code>OCTET STRING</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>5</code></td><td style="text-align:center"><code>05</code></td><td style="text-align:left"><code>NULL</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>6</code></td><td style="text-align:center"><code>06</code></td><td style="text-align:left"><code>OBJECT IDENTIFIER</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>12</code></td><td style="text-align:center"><code>0C</code></td><td style="text-align:left"><code>UTF8String</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>16</code></td><td style="text-align:center"><code>10</code>（和 <code>30</code>）<code>*</code></td><td style="text-align:left"><code>SEQUENCE</code> 和 <code>SEQUENCE OF</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>17</code></td><td style="text-align:center"><code>11</code>（和 <code>31</code>）<code>*</code></td><td style="text-align:left"><code>SET</code> 和 <code>SET OF</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>19</code></td><td style="text-align:center"><code>13</code></td><td style="text-align:left"><code>PrintableString</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>22</code></td><td style="text-align:center"><code>16</code></td><td style="text-align:left"><code>IA5String</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>23</code></td><td style="text-align:center"><code>17</code></td><td style="text-align:left"><code>UTCTime</code></td><td style="text-align:left"></td></tr><tr><td style="text-align:center"><code>24</code></td><td style="text-align:center"><code>18</code></td><td style="text-align:left"><code>GeneralizedTime</code></td><td style="text-align:left"></td></tr></tbody></table><ul><li><code>INTEGER</code></li></ul><blockquote><p>就是老生常谈的整数。 可以是正数，也可以是负数。 <code>ASN.1</code> 的 <code>INTEGER</code> 类型最为特别之处在于大小不限。 <code>int64</code> 不够大？ 小事一桩。 这对于表示 <code>RSA</code> 模数之类远超 <code>int64</code> 范围的整数（比如 <code>22048</code>）尤为有用。 严格说来 <code>DER</code> 格式的整数范围是有上限的，但上限极高：任何 <code>DER</code> 字段的长度必须能够用 <code>126</code> 个字节来表示。 因此，<code>DER</code> 能表示的最大的 <code>INTEGER</code> 数值是 <code>256(2^1008)−1</code>。真正无限大的 <code>INTEGER</code> 必须用 <code>BER</code> 编码，因为 <code>BER</code> 对字段长度没有限制。</p></blockquote><ul><li><code>BIT STRING</code></li></ul><blockquote><p>字符串类型, 表示一段任意的二进制位</p></blockquote><ul><li><code>OCTET STRING</code></li></ul><blockquote><p>字符串类型, 表示一段任意的字节, 这两种类型可以存放无特殊结构的数据。比如密码学中的 <code>nonce</code> 和散列值</p></blockquote><ul><li><code>UTF8String</code></li><li><code>PrintableString</code></li></ul><blockquote><p>属于字符串类型, 只能存储 <code>ASCII</code> 中的部分字符，包括字母、数字、空格以及一些特定的符号：’<code>()</code> <code>+</code> <code>,</code> <code>-</code> <code>.</code> <code>/</code> <code>:</code> <code>=</code> <code>?</code>。 注意其中不包括 <code>*</code> 和 <code>@</code>。</p></blockquote><ul><li><code>IA5String</code></li></ul><blockquote><p>字符串类型, <code>IA5String</code> 源自 <code>International Alphabet No.5</code>，限制较为宽松，所有 <code>ASCII</code> 字符几乎都能使用，在证书中常用于邮箱地址、<code>DNS</code> 域名、网址之类的字段。 需要注意的是 <code>IA5</code> 编码中有部分数值的含义与 <code>US-ASCII</code> 并不相同。</p></blockquote><ul><li><code>NULL</code></li></ul><blockquote><p>只有一个值<code>NULL</code></p></blockquote><ul><li><code>OBJECT IDENTIFIER</code></li></ul><blockquote><p><code>Object identifier (OID)</code> 是一种全球唯一的层状标识符，由一串整数组成。 它可以用来标识任何东西，但通常用于指代标准、算法、证书扩展、组织机构或政策文件。 例如 <code>1.2.840.113549</code> 表示的是 <code>RSA</code> 安全公司， 因此该公司有权分配以这一串数字开头的 <code>OID</code>，比如 <code>RFC 8017</code> 定义的 <code>1.2.840.113549.1.1.11</code> 表示 <code>sha256WithRSAEncryption</code>。</p></blockquote><ul><li><code>SEQUENCE</code></li></ul><blockquote><p>由不同类型的值组成一个有序的集合</p></blockquote><ul><li><code>SEQUENCE OF</code></li></ul><blockquote><p>由相同类型的值组成一个有序的集合</p></blockquote><ul><li><code>SET</code></li></ul><blockquote><p>无序集合(不同类型的值)</p></blockquote><ul><li><code>SET OF</code></li></ul><blockquote><p>无序集合(相同类型的值)</p></blockquote><ul><li><code>UTCTime</code></li></ul><blockquote><p><code>UTCTime</code>属于时间类型, 采用 <code>YYMMDDhhmm[ss]</code> 的格式表示日期和时间，末尾还可以加上时区，或者加上“<code>Z</code>”表示协调世界时（<code>UTC</code>）。 例如，<code>UTCTime</code> 的 <code>820102120000Z</code> 和 <code>820102070000-0500</code> 表示同一时刻：<code>1982</code> 年 <code>1</code> 月 <code>2</code> 日纽约（<code>UTC−5</code>）的早晨七点，即协调世界时的正午十二点。</p></blockquote><ul><li><code>GeneralizedTime</code></li></ul><blockquote><p>属于时间类型, <code>GeneralizedTime</code>相对于<code>UTCTime</code>,在其基础上将 <code>YY</code> 改成了四位年份 <code>YYYY</code>。 二者最后都可以加上时区，或者加一个 <code>Z</code> 表示协调世界时（<code>UTC</code>）。</p></blockquote><hr><p>  值得注意的是, 这些通用的标签值都小于<code>31</code>(<code>0X1F</code>), 其实这是有意而为一, 在<code>ASN.1</code>中, 标签中高三位有着特殊的含义。通过第 <code>7</code> 位和第 <code>8</code> 位可以把标签分为四类: <strong>通用标签</strong>、<strong>程序内部标签</strong>、<strong>特定语境标签</strong> 和 <strong>私有标签</strong>。 标签类别可通过第 <code>7</code> 位和第 <code>8</code> 位区分。</p><p><strong>Tag种类</strong>:</p><p><img src="https://etcfly.top/Images/picture/crypt/CERT/Tag%E6%A0%BC%E5%BC%8F%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt="Tag格式图.png"></p><ul><li>第<code>5</code>位指示类型是单一类型还是复合类型<ul><li><code>0</code>: 单一类型(如<code>INTEGER</code>)</li><li><code>1</code>: 复合类型(如<code>SEQUENCE OF</code>和<code>SET OF</code>)</li></ul></li></ul><hr><h5 id="length"><a class="markdownIt-Anchor" href="#length"></a> Length</h5><p>  长度字段用于描述数据域的具体长度, 其可以是单字节或多字节。具体编码为:</p><ul><li>如果最高位(第<code>8b</code>)为<code>1</code>, 表示长度域编码为多字节, 那么剩余<code>7bits</code>指示具体长度域的字节数。如<code>0x85</code>长度域字节数为:<code>0x85 &amp; 0X7F = 0x05</code></li></ul><blockquote><p>如<code>TLV</code>数据为<code>02 82 01 02 05 ....</code>, <code>02</code>表示类型<code>INTEGER</code>, <code>0x82</code>最高位为<code>1</code>, 表示长度域为多字节, 字节长度为<code>0x82 &amp; 0X7F = 0X02</code>, 那么接下来<code>01 02</code>表示数据长度为<code>0x01*256 + 0x02 = 258</code>, 则接下来<code>258</code>字节为具体数据。</p></blockquote><ul><li>如果最高位(第<code>8b</code>)为<code>0</code>, 表示长度域编码为单字节。</li></ul><blockquote><p>如<code>TLV</code>数据为<code>02 03 01 02 05</code>, <code>02</code>表示类型<code>INTEGER</code>, <code>03</code>最高位为<code>0</code>, 表示单字节描述长度域长度为<code>0x7F &amp; 0X03 = 0x03</code>, <code>01 02 05</code>表示具体数据</p></blockquote><hr><h5 id="value"><a class="markdownIt-Anchor" href="#value"></a> Value</h5><p>  <code>Value</code>是具体的值, 值得注意的是, <code>Value</code>可以是单一数据类型的值, 也可以是复合类型的值, 如果是复合数据类型的值, 其内部可以再次嵌套一个<code>TLV</code>结构。</p><hr><h3 id="证书解析"><a class="markdownIt-Anchor" href="#证书解析"></a> 证书解析</h3><p>  通过上面的学习, 我们大致了解了一个<code>DER</code>证书的数据结构, 接下来我们来看一个<code>DER</code>文件，具体如何生成一个<code>DER</code>文件, 请参考 &lt;&lt;<code>openssl</code>基础&gt;&gt; 一节:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs hex">╭─etcfly@etcfly-pc ~/Desktop/TLS/cert<br>╰─$ xxd -c 16 -g 1  rsacert.der<br>00000000: 30 82 02 10 30 82 01 79 02 14 2f 58 55 26 e7 58  0...0..y../XU&amp;.X<br>00000010: 7d 7e 36 77 9a 40 c5 80 b0 95 76 0c 76 e1 30 0d  &#125;~6w.@....v.v.0.<br>00000020: 06 09 2a 86 48 86 f7 0d 01 01 0b 05 00 30 47 31  ..*.H........0G1<br>00000030: 0b 30 09 06 03 55 04 06 13 02 43 4e 31 0b 30 09  .0...U....CN1.0.<br>00000040: 06 03 55 04 08 0c 02 5a 4a 31 11 30 0f 06 03 55  ..U....ZJ1.0...U<br>00000050: 04 07 0c 08 48 61 6e 67 7a 68 6f 75 31 18 30 16  ....Hangzhou1.0.<br>00000060: 06 03 55 04 0a 0c 0f 49 4f 54 20 54 65 73 74 20  ..U....IOT Test<br>00000070: 53 45 52 56 45 52 30 1e 17 0d 32 33 30 37 30 37  SERVER0...230707<br>00000080: 30 35 35 32 35 35 5a 17 0d 33 33 30 37 30 34 30  055255Z..3307040<br>00000090: 35 35 32 35 35 5a 30 47 31 0b 30 09 06 03 55 04  55255Z0G1.0...U.<br>000000a0: 06 13 02 43 4e 31 0b 30 09 06 03 55 04 08 0c 02  ...CN1.0...U....<br>000000b0: 5a 4a 31 11 30 0f 06 03 55 04 07 0c 08 48 61 6e  ZJ1.0...U....Han<br>000000c0: 67 7a 68 6f 75 31 18 30 16 06 03 55 04 0a 0c 0f  gzhou1.0...U....<br>000000d0: 49 4f 54 20 54 65 73 74 20 53 45 52 56 45 52 30  IOT Test SERVER0<br>000000e0: 81 9f 30 0d 06 09 2a 86 48 86 f7 0d 01 01 01 05  ..0...*.H.......<br>000000f0: 00 03 81 8d 00 30 81 89 02 81 81 00 b9 7b 6d 17  .....0.......&#123;m.<br>00000100: 64 bd 72 6b 9a f1 ac 6e be e9 ed 91 8e f5 05 b6  d.rk...n........<br>00000110: f9 7e d0 e5 a2 cc 4b d8 af 50 a1 f6 fa 79 ae 46  .~....K..P...y.F<br>00000120: 65 2b e3 bc be 04 cd cf ea a4 db 57 1a bc d7 6e  e+.........W...n<br>00000130: ad c6 a7 6b df 62 f4 ea cb c7 ca 59 bf 9d ee d6  ...k.b.....Y....<br>00000140: 27 af 4e c1 a7 60 b8 76 41 8c 4e 37 32 88 aa ef  &#x27;.N..`.vA.N72...<br>00000150: 02 18 0c 92 45 90 05 f7 65 56 07 b7 fe e1 03 24  ....E...eV.....$<br>00000160: 74 b8 d1 13 82 d8 d2 f9 06 6d 84 19 96 c5 e7 c0  t........m......<br>00000170: 3a 61 1e b8 e5 95 81 34 c8 e3 32 c5 02 03 01 00  :a.....4..2.....<br>00000180: 01 30 0d 06 09 2a 86 48 86 f7 0d 01 01 0b 05 00  .0...*.H........<br>00000190: 03 81 81 00 8d 86 3e 8e 67 53 8f ca 18 f0 06 f6  ......&gt;.gS......<br>000001a0: 08 c8 c3 88 3c b9 3c d6 6f ee 4d 36 f9 7d ba 75  ....&lt;.&lt;.o.M6.&#125;.u<br>000001b0: c9 ee 91 f7 9c d4 25 c7 4c 20 b3 67 cb 4e a0 bb  ......%.L .g.N..<br>000001c0: f1 1a 97 46 62 7f a0 92 e9 01 68 b0 46 16 a9 be  ...Fb.....h.F...<br>000001d0: e6 ce 37 9e 7e 10 d6 a8 20 af ed 34 ee 6c 30 81  ..7.~... ..4.l0.<br>000001e0: bf b1 2f 3b 0f 70 62 9a 44 b1 7e 67 4d f5 93 26  ../;.pb.D.~gM..&amp;<br>000001f0: 76 af b6 01 9d e0 c5 b0 9f a1 0c 1c 7b ce 9a b0  v...........&#123;...<br>00000200: 88 e6 b1 db b8 cb ba 58 0a e9 16 0d 1e 5b 69 ae  .......X.....[i.<br>00000210: 5f f5 7d 94                                      _.&#125;.<br></code></pre></td></tr></table></figure><p>如上是一个<code>1024bit</code>证书, 我们可以先通过<code>openssl</code>对其进行解析来了解一下具体结构。具体命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl asn1parse -<span class="hljs-keyword">in</span> rsacert.der -inform der<br></code></pre></td></tr></table></figure><p>最终解析输出结果如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─etcfly@etcfly-pc ~/Desktop/TLS/cert<br>╰─$ openssl asn1parse -<span class="hljs-keyword">in</span> rsacert.der -inform der                                                        1 ↵<br>    0:d=0  hl=4 l= 528 cons: SEQUENCE<br>    4:d=1  hl=4 l= 377 cons: SEQUENCE<br>    8:d=2  hl=2 l=  20 prim: INTEGER           :2F585526E7587D7E36779A40C580B095760C76E1<br>   30:d=2  hl=2 l=  13 cons: SEQUENCE<br>   32:d=3  hl=2 l=   9 prim: OBJECT            :sha256WithRSAEncryption<br>   43:d=3  hl=2 l=   0 prim: NULL<br>   45:d=2  hl=2 l=  71 cons: SEQUENCE<br>   47:d=3  hl=2 l=  11 cons: SET<br>   49:d=4  hl=2 l=   9 cons: SEQUENCE<br>   51:d=5  hl=2 l=   3 prim: OBJECT            :countryName<br>   56:d=5  hl=2 l=   2 prim: PRINTABLESTRING   :CN<br>   60:d=3  hl=2 l=  11 cons: SET<br>   62:d=4  hl=2 l=   9 cons: SEQUENCE<br>   64:d=5  hl=2 l=   3 prim: OBJECT            :stateOrProvinceName<br>   69:d=5  hl=2 l=   2 prim: UTF8STRING        :ZJ<br>   73:d=3  hl=2 l=  17 cons: SET<br>   75:d=4  hl=2 l=  15 cons: SEQUENCE<br>   77:d=5  hl=2 l=   3 prim: OBJECT            :localityName<br>   82:d=5  hl=2 l=   8 prim: UTF8STRING        :Hangzhou<br>   92:d=3  hl=2 l=  24 cons: SET<br>   94:d=4  hl=2 l=  22 cons: SEQUENCE<br>   96:d=5  hl=2 l=   3 prim: OBJECT            :organizationName<br>  101:d=5  hl=2 l=  15 prim: UTF8STRING        :IOT Test SERVER<br>  118:d=2  hl=2 l=  30 cons: SEQUENCE<br>  120:d=3  hl=2 l=  13 prim: UTCTIME           :230707055255Z<br>  135:d=3  hl=2 l=  13 prim: UTCTIME           :330704055255Z<br>  150:d=2  hl=2 l=  71 cons: SEQUENCE<br>  152:d=3  hl=2 l=  11 cons: SET<br>  154:d=4  hl=2 l=   9 cons: SEQUENCE<br>  156:d=5  hl=2 l=   3 prim: OBJECT            :countryName<br>  161:d=5  hl=2 l=   2 prim: PRINTABLESTRING   :CN<br>  165:d=3  hl=2 l=  11 cons: SET<br>  167:d=4  hl=2 l=   9 cons: SEQUENCE<br>  169:d=5  hl=2 l=   3 prim: OBJECT            :stateOrProvinceName<br>  174:d=5  hl=2 l=   2 prim: UTF8STRING        :ZJ<br>  178:d=3  hl=2 l=  17 cons: SET<br>  180:d=4  hl=2 l=  15 cons: SEQUENCE<br>  182:d=5  hl=2 l=   3 prim: OBJECT            :localityName<br>  187:d=5  hl=2 l=   8 prim: UTF8STRING        :Hangzhou<br>  197:d=3  hl=2 l=  24 cons: SET<br>  199:d=4  hl=2 l=  22 cons: SEQUENCE<br>  201:d=5  hl=2 l=   3 prim: OBJECT            :organizationName<br>  206:d=5  hl=2 l=  15 prim: UTF8STRING        :IOT Test SERVER<br>  223:d=2  hl=3 l= 159 cons: SEQUENCE<br>  226:d=3  hl=2 l=  13 cons: SEQUENCE<br>  228:d=4  hl=2 l=   9 prim: OBJECT            :rsaEncryption<br>  239:d=4  hl=2 l=   0 prim: NULL<br>  241:d=3  hl=3 l= 141 prim: BIT STRING<br>  385:d=1  hl=2 l=  13 cons: SEQUENCE<br>  387:d=2  hl=2 l=   9 prim: OBJECT            :sha256WithRSAEncryption<br>  398:d=2  hl=2 l=   0 prim: NULL<br>  400:d=1  hl=3 l= 129 prim: BIT STRING<br></code></pre></td></tr></table></figure><p>整理一下结构如下:</p><p><img src="https://etcfly.top/Images/picture/crypt/CERT/der%E8%A7%A3%E6%9E%90%E5%9B%BE.png" srcset="/img/loading.gif" lazyload alt="der解析图.png"></p><p>我们可以将二者对应起来。可能你还是很迷糊, 那我们来手动解析一下:</p><ul><li>首先来看一下开始的四字节: <code>30 82 02 10</code>, <code>30</code>表示标签类型为<code>SEQUENCE</code>, <code>82</code>表示长度域为多字节, 且值为<code>2</code>, 于是<code>02 10</code>两字节描述<code>Value</code>的长度等于<code>0x2*256+0x10</code>为<code>528</code></li><li>由于前一个类型为<code>SEQUENCE</code>, 说明这是一个复合类型, 因此<code>Value</code>也是<code>TLV</code>结构。第<code>4-8</code>字节内容为<code>30 82 01 79</code>, <code>30</code>表示<code>SEQUENCE</code>, <code>82</code>表示长度域为<code>2Byte</code>, <code>01 79</code>表示<code>Value</code>长度为<code>0x01*256+0x79=377</code>。</li><li>同理, 继续解析<code>9-30</code>字节, <code>02 14 2f 58 55 26 e7 58 7d 7e 36 77 9a 40 c5 80 b0 95 76 0c 76 e1</code>, <code>02</code>表示<code>INTEGER</code>类型, <code>14</code>由于小于<code>0x80</code>, 因此<code>Value</code>数据长度为<code>0x14</code>字节, 内容为<code>2f 58 55 26 e7 58 7d 7e 36 77 9a 40 c5 80 b0 95 76 0c 76 e1</code>, 这其实表示证书的<code>Serial Number</code>, 可以和上图进行一个比对。</li></ul><p>如下是我们通过<code>openssl</code>解析该证书的到的结果:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─etcfly@etcfly-pc ~/Desktop/TLS/cert<br>╰─$ openssl x509 -<span class="hljs-keyword">in</span> rsacert.der -inform der -text -noout<br>Certificate:<br>    Data:<br>        Version: 1 (0x0)<br>        Serial Number:<br>            2f:58:55:26:e7:58:7d:7e:36:77:9a:40:c5:80:b0:95:76:0c:76:e1<br>        Signature Algorithm: sha256WithRSAEncryption<br>        Issuer: C = CN, ST = ZJ, L = Hangzhou, O = IOT Test SERVER<br>        Validity<br>            Not Before: Jul  7 05:52:55 2023 GMT<br>            Not After : Jul  4 05:52:55 2033 GMT<br>        Subject: C = CN, ST = ZJ, L = Hangzhou, O = IOT Test SERVER<br>        Subject Public Key Info:<br>            Public Key Algorithm: rsaEncryption<br>                RSA Public-Key: (1024 bit)<br>                Modulus:<br>                    00:b9:7b:6d:17:64:bd:72:6b:9a:f1:ac:6e:be:e9:<br>                    ed:91:8e:f5:05:b6:f9:7e:d0:e5:a2:cc:4b:d8:af:<br>                    50:a1:f6:fa:79:ae:46:65:2b:e3:bc:be:04:<span class="hljs-built_in">cd</span>:cf:<br>                    ea:a4:db:57:1a:bc:d7:6e:ad:c6:a7:6b:<span class="hljs-built_in">df</span>:62:f4:<br>                    ea:cb:c7:ca:59:bf:9d:ee:d6:27:af:4e:c1:a7:60:<br>                    b8:76:41:8c:4e:37:32:88:aa:ef:02:18:0c:92:45:<br>                    90:05:f7:65:56:07:b7:fe:e1:03:24:74:b8:d1:13:<br>                    82:d8:d2:f9:06:6d:84:19:96:c5:e7:c0:3a:61:1e:<br>                    b8:e5:95:81:34:c8:e3:32:c5<br>                Exponent: 65537 (0x10001)<br>    Signature Algorithm: sha256WithRSAEncryption<br>         8d:86:3e:8e:67:53:8f:ca:18:f0:06:f6:08:c8:c3:88:3c:b9:<br>         3c:d6:6f:ee:4d:36:f9:7d:ba:75:c9:ee:91:f7:9c:d4:25:c7:<br>         4c:20:b3:67:cb:4e:a0:bb:f1:1a:97:46:62:7f:a0:92:e9:01:<br>         68:b0:46:16:a9:be:e6:ce:37:9e:7e:10:d6:a8:20:af:ed:34:<br>         ee:6c:30:81:bf:b1:2f:3b:0f:70:62:9a:44:b1:7e:67:4d:f5:<br>         93:26:76:af:b6:01:9d:e0:c5:b0:9f:a1:0c:1c:7b:ce:9a:b0:<br>         88:e6:b1:db:b8:cb:ba:58:0a:e9:16:0d:1e:5b:69:ae:5f:f5:<br>         7d:94<br></code></pre></td></tr></table></figure><p>可以看到<code>Serial Number</code>和我们解析的数据恰好对应上, 说明我们的解析是正确的。关于其他部分可自行解析，这里不做阐述。推荐一个<code>ASN.1</code>在线解析网站: <a target="_blank" rel="noopener" href="https://lapo.it/asn1js/#">ASN.1 JavaScript decoder</a></p><hr><h3 id="csr格式"><a class="markdownIt-Anchor" href="#csr格式"></a> CSR格式</h3><p>  我们知道, 日常我们进行公钥加密时是需要将公钥提供给客户端, 然后客户端使用公钥来加密对称加密的共享密钥, 从而完成密钥的配送, 为了证明服务端公钥的身份, 又需要将公钥给可信的<code>CA</code>组织进行认证从而生成证书, 然后将证书提供给客户端避免证书错误或者篡改, 那服务端如何提交证书申请呢？这就是<code>CSR</code>文件的用途。</p><p>  <code>CSR</code>文件全称<code>Certificate Request</code>, 由客户端生成并提交给<code>CA</code>组织, <code>CA</code>组织使用自己的公钥对<code>CSR</code>提交的公钥进行签名生成证书并返回给服务端以此完成一次证书的签发。让我们来看看<code>CSR</code>文件内容是什么样的?</p><p><code>csr</code>文件使用命令输出结果如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">-----BEGIN CERTIFICATE REQUEST-----<br>MIICkTCCAXkCAQAwTDELMAkGA1UEBhMCQ04xDTALBgNVBAgMBFRFU1QxCzAJBgNV<br>BAcMAkNBMSEwHwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwggEiMA0G<br>CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQD4hBjMWjElJTZb5Sy4P/<span class="hljs-number">2</span>ZATwb4LaA<br>/<span class="hljs-number">25</span>G9c0H5FKRnJxG/XP/<span class="hljs-number">7</span>dY9o6NHuumhJcZcI6kZ/en+Qt0L1Vmui7tJWz6JTsU8<br>I9OZfhQhW3428CO0OSZu4NJjn+<span class="hljs-number">2</span>S3lJBdey+RMRqO7+/<span class="hljs-number">4</span>cCNiF9OfYRmFUwogGhu<br>ebaCLFDBvidt4vmYU4dfWelW2ofBq4YDVYGSx1lbHFkYzgDr6oLHEfsZT/<span class="hljs-number">10</span>TACs<br>qgxGe783/<span class="hljs-number">8</span>gW9q3nkhW6xs4fT9brJKYMx60ChsWi/<span class="hljs-number">3</span>PyDUKppc+K2MTUoCclexxY<br>Siqxi8Mzh4FTvFwXAKgRmTmy6rJFfz1eNrMRAryYx7pu1W0HEoZ+<span class="hljs-number">1</span>w05AgMBAAGg<br>ADANBgkqhkiG9w0BAQsFAAOCAQEAqxzk7fL/<span class="hljs-number">6l</span>NJeI99R2G1O4DPaWq7MfDhCWVZ<br>T8eGRlgHOB4AGxxRWfp9sRPaT7V+OnHjvzvnBZFPO3dnThQxfooWWOOMpVV+OmhP<br>oRVEzP6TZO9LHVK4g0DaEWBV0NZMJ7BTw+dGFe+I73ED1AjjIiyZ9zw4Z8rn98wA<br>r0OCbgmL/wSEtqdpWGo8RjhXFLRIPoDUIHEVh7c3iHAMsNhO59gtAvqkz5oA+Xeq<br>R9gQQU/Q6mU/xTmXf/Isvq5nyZUqNRyqADL0Wtk1EtRHvKufFoQRaDZvZpl3+<span class="hljs-number">9</span>iu<br><span class="hljs-number">2</span>Y5nneF02i/CpXI40VogSz+<span class="hljs-number">1</span>cyqIimf76tcFla5c8lT5UcvlOw==<br>-----END CERTIFICATE REQUEST-----<br></code></pre></td></tr></table></figure><p>这同样是一个使用<code>PEM</code>编码的文件, 以<code>-----BEGIN CERTIFICATE REQUEST-----</code>和<code>-----END CERTIFICATE REQUEST-----</code>开始和结束, 通过命令来解析<code>csr</code>文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openssl req -<span class="hljs-keyword">in</span> err.csr -text -noout<br></code></pre></td></tr></table></figure><p>如下是一个<code>2048 bits</code>的<code>RSA</code>公钥解析输出内容:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">Certificate Request:<br>    Data:<br>        Version: 1 (0x0)<br>        Subject: C = AU, ST = Some-State, O = Internet Widgits Pty Ltd<br>        Subject Public Key Info:<br>            Public Key Algorithm: rsaEncryption<br>                RSA Public-Key: (2048 bit)<br>                Modulus:<br>                    00:ce:49:85:02:c2:e5:19:29:02:d3:0b:3a:d5:bc:<br>                    fd:43:00:7e:c1:72:5b:d2:59:d6:84:59:1d:45:42:<br>                    26:1e:ab:b9:d7:91:e7:54:02:92:1c:ce:d2:ac:b2:<br>                    61:4f:ed:31:e7:ac:32:e4:26:78:46:b7:5d:ce:2c:<br>                    89:79:30:26:50:cb:f2:84:cc:30:e5:9a:de:4c:3e:<br>                    15:23:55:74:8d:ea:ba:ca:<span class="hljs-built_in">dd</span>:bb:a5:1d:95:07:2a:<br>                    6f:ed:61:70:0a:01:ea:76:cc:d1:18:f6:44:80:69:<br>                    2e:89:ec:da:04:f8:8b:ac:a1:69:28:fa:7f:c2:99:<br>                    fa:58:af:24:7f:73:26:cf:c7:82:55:59:42:c3:2d:<br>                    81:d3:d4:de:37:86:6d:44:31:7c:f4:e1:da:d1:44:<br>                    49:98:ea:43:db:ec:5b:45:0e:73:2f:de:24:12:d5:<br>                    46:7b:35:a6:15:e6:b0:b9:6e:62:bf:62:36:2a:7f:<br>                    f1:67:c0:31:27:ac:19:22:30:bc:52:44:7b:09:a9:<br>                    16:ef:d9:47:6a:0e:b8:eb:c4:2e:87:6a:8b:<span class="hljs-built_in">fc</span>:30:<br>                    e1:99:7b:a9:47:56:61:5a:5f:36:87:2c:ba:6f:ab:<br>                    fd:1e:a3:d4:8a:88:c0:2a:82:83:56:3e:6b:26:20:<br>                    11:76:fd:f0:75:0f:7b:8e:dc:22:89:85:7d:91:<span class="hljs-built_in">fc</span>:<br>                    07:9f<br>                Exponent: 65537 (0x10001)<br>        Attributes:<br>            a0:00<br>    Signature Algorithm: sha256WithRSAEncryption<br>         38:b0:0f:a5:bc:52:18:63:3a:e9:3e:4f:bb:fb:8b:4c:50:76:<br>         09:c6:4d:ef:13:c0:9f:08:23:1b:9e:c1:aa:78:30:62:94:2a:<br>         4c:0c:90:a3:46:45:14:a5:a1:bb:05:3d:1c:1a:a1:e6:d3:f0:<br>         e4:c5:ee:aa:e4:f2:95:d4:82:c6:48:aa:e0:9a:0d:98:79:c9:<br>         7e:9d:0f:d6:e1:b2:c7:ad:42:de:32:ab:27:20:f7:92:2e:59:<br>         81:62:fe:83:c4:de:d3:f5:7a:c8:d6:d9:f8:eb:86:ba:94:82:<br>         47:c8:f7:7e:36:19:9b:6f:7a:08:58:06:17:04:71:0a:3f:e3:<br>         72:ba:0e:c3:0f:fa:74:10:69:f9:be:49:61:b2:66:e3:51:21:<br>         f6:63:52:2d:7b:d4:f7:ba:97:53:0f:18:6e:37:1f:46:57:50:<br>         <span class="hljs-built_in">df</span>:82:5e:39:86:78:e6:a8:e7:28:29:c6:a0:b8:cc:7a:6d:e7:<br>         34:d6:6a:16:34:9a:52:bd:<span class="hljs-built_in">df</span>:04:96:46:4c:51:9e:b3:88:bb:<br>         9f:a7:2d:5a:d5:c0:ec:5c:a2:fb:b2:<span class="hljs-built_in">df</span>:38:2f:c3:95:d4:f1:<br>         cb:82:d2:be:c2:f7:f9:0c:ae:64:ca:fb:11:57:cb:37:c2:7e:<br>         f1:72:3b:99:ce:6e:a6:27:ca:6b:0a:2c:5e:8a:99:1b:77:f5:<br>         35:74:ee:ab<br></code></pre></td></tr></table></figure><p>从文件结构来看, <code>CSR</code>包含了:</p><ul><li><code>Version</code>: 版本</li><li><code>Subject</code>: 证书申请者信息</li><li><code>RSA Public-Key</code>: 申请者<code>RSA</code>公钥</li><li><code>Signature Algorithm</code>: 签名算法</li><li>申请者使用私钥对公钥进行签名信息</li></ul><p>通过申请者对公钥进行数字签名, 避免由于申请提交过程中由于异常导致信息损坏而签发无效证书。其实<code>CSR</code>本身也遵从<code>ASN.1</code>编码, 解码如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─etcfly@etcfly-pc ~/Desktop/TLS/tls<br>╰─$ openssl asn1parse -<span class="hljs-keyword">in</span> err.csr<br>    0:d=0  hl=4 l= 650 cons: SEQUENCE<br>    4:d=1  hl=4 l= 370 cons: SEQUENCE<br>    8:d=2  hl=2 l=   1 prim: INTEGER           :00<br>   11:d=2  hl=2 l=  69 cons: SEQUENCE<br>   13:d=3  hl=2 l=  11 cons: SET<br>   15:d=4  hl=2 l=   9 cons: SEQUENCE<br>   17:d=5  hl=2 l=   3 prim: OBJECT            :countryName<br>   22:d=5  hl=2 l=   2 prim: PRINTABLESTRING   :AU<br>   26:d=3  hl=2 l=  19 cons: SET<br>   28:d=4  hl=2 l=  17 cons: SEQUENCE<br>   30:d=5  hl=2 l=   3 prim: OBJECT            :stateOrProvinceName<br>   35:d=5  hl=2 l=  10 prim: UTF8STRING        :Some-State<br>   47:d=3  hl=2 l=  33 cons: SET<br>   49:d=4  hl=2 l=  31 cons: SEQUENCE<br>   51:d=5  hl=2 l=   3 prim: OBJECT            :organizationName<br>   56:d=5  hl=2 l=  24 prim: UTF8STRING        :Internet Widgits Pty Ltd<br>   82:d=2  hl=4 l= 290 cons: SEQUENCE<br>   86:d=3  hl=2 l=  13 cons: SEQUENCE<br>   88:d=4  hl=2 l=   9 prim: OBJECT            :rsaEncryption<br>   99:d=4  hl=2 l=   0 prim: NULL<br>  101:d=3  hl=4 l= 271 prim: BIT STRING<br>  376:d=2  hl=2 l=   0 cons: cont [ 0 ]<br>  378:d=1  hl=2 l=  13 cons: SEQUENCE<br>  380:d=2  hl=2 l=   9 prim: OBJECT            :sha256WithRSAEncryption<br>  391:d=2  hl=2 l=   0 prim: NULL<br>  393:d=1  hl=4 l= 257 prim: BIT STRING<br></code></pre></td></tr></table></figure><hr><h3 id="crl格式"><a class="markdownIt-Anchor" href="#crl格式"></a> CRL格式</h3><p>  说完了<code>CSR</code>申请, 那最后来说说<code>CRL</code>吊销文件, 试想一下这样一个场景, 当<code>CA</code>向我们返回一个证书后, 我们在使用证书的过程中私钥丢失或者泄漏了, 这时候这个证书就是不安全的证书，这时候所有使用公钥加密的数据都存在泄漏的风险, 所有需要对该证书进行作废处理。这就是这节所说的证书的吊销。</p><p>  <code>CRL</code>文件用于描述<code>X.509</code>证书的吊销信息, 如果一个证书被吊销, 那么客户端就不能在使用该证书来进行密钥交换, 吊销的流程也很简答, 服务端密钥泄漏后, 重新向<code>CA</code>申请证书吊销, <code>CA</code>通过之前的存档信息找到之前服务端的证书序号(<code>serial number</code>), 然后重新使用其私钥进行签名生成<code>CRL</code>文件, 客户端定期去特定的<code>URL</code>地址更新<code>CRL</code>文件, 如果发现证书序号在<code>CRL</code>列表, 将直接丢弃证书。</p><p>  使用<code>openssl</code>可以手动生成一个<code>crl</code>证书, 具体可参考 “openssl基础” 一节, 这里已经生成了一个<code>ca.crl</code>文件, 我们来看看文件的内容:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----BEGIN X509 CRL-----<br>MIIBzjCBtwIBATANBgkqhkiG9w0BAQQFADBMMQswCQYDVQQGEwJDTjENMAsGA1UE<br>CAwEVEVTVDELMAkGA1UEBwwCQ0ExITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMg<br>UHR5IEx0ZBcNMjMwNzExMDIzMDU5WhcNMjUwNjIyMDIzMDU5WjAnMCUCFHaE62Pf<br>dDeWOmNrpk2EjF/gde7IFw0yMzA3MTEwMjMwMzVaoA4wDDAKBgNVHRQEAwIBAjAN<br>BgkqhkiG9w0BAQQFAAOCAQEAm8ndokKlMyaUp4c8eqRxVnU9CCxnSSF56PTfLPac<br>wYYc98bUahP0zx7KB0NS33/MMCpPkX6DnU/XOXwNhuypklV4lrqMGq3EMWOcLBqt<br>hCkutW7iVHVLGRbx0Nh2MVwnx3fJAR1nUcsYWIZxoXdNgU1m18g6rZY9j/fQQfmE<br>yBrcrFfTDwTaZZCdDI9EIVd5ku5mljh7MJtYqo3TxGgtVe4r7t7jfeWMvmcheMyt<br>1UcQg+Ygcosfwsn++/kJ/MamXClfvqzPpzDnkYaKIHBneAN/hShe5Cl4elt33wSO<br>r7UkJHlzfZuHtMgdwlGScwHRTT7Vq4CmMQ2zk0qW3120sw==<br>-----END X509 CRL-----<br></code></pre></td></tr></table></figure><p>可以看出<code>CRL</code>文件同样是<code>PEM</code>编码, 通过<code>openssl</code>解析:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─etcfly@etcfly-pc ~/Desktop/TLS/tls<br>╰─$ openssl crl -<span class="hljs-keyword">in</span> ca.crl -text -noout<br>Certificate Revocation List (CRL):<br>        Version 2 (0x1)<br>        Signature Algorithm: md5WithRSAEncryption<br>        Issuer: C = CN, ST = TEST, L = CA, O = Internet Widgits Pty Ltd<br>        Last Update: Jul 11 02:30:59 2023 GMT<br>        Next Update: Jun 22 02:30:59 2025 GMT<br>        CRL extensions:<br>            X509v3 CRL Number:<br>                2<br>Revoked Certificates:<br>    Serial Number: 7684EB63DF7437963A636BA64D848C5FE075EEC8<br>        Revocation Date: Jul 11 02:30:35 2023 GMT<br>    Signature Algorithm: md5WithRSAEncryption<br>         9b:c9:<span class="hljs-built_in">dd</span>:a2:42:a5:33:26:94:a7:87:3c:7a:a4:71:56:75:3d:<br>         08:2c:67:49:21:79:e8:f4:<span class="hljs-built_in">df</span>:2c:f6:9c:c1:86:1c:f7:c6:d4:<br>         6a:13:f4:cf:1e:ca:07:43:52:<span class="hljs-built_in">df</span>:7f:cc:30:2a:4f:91:7e:83:<br>         9d:4f:d7:39:7c:0d:86:ec:a9:92:55:78:96:ba:8c:1a:ad:c4:<br>         31:63:9c:2c:1a:ad:84:29:2e:b5:6e:e2:54:75:4b:19:16:f1:<br>         d0:d8:76:31:5c:27:c7:77:c9:01:1d:67:51:cb:18:58:86:71:<br>         a1:77:4d:81:4d:66:d7:c8:3a:ad:96:3d:8f:f7:d0:41:f9:84:<br>         c8:1a:dc:ac:57:d3:0f:04:da:65:90:9d:0c:8f:44:21:57:79:<br>         92:ee:66:96:38:7b:30:9b:58:aa:8d:d3:c4:68:2d:55:ee:2b:<br>         ee:de:e3:7d:e5:8c:be:67:21:78:cc:ad:d5:47:10:83:e6:20:<br>         72:8b:1f:c2:c9:fe:fb:f9:09:<span class="hljs-built_in">fc</span>:c6:a6:5c:29:5f:be:ac:cf:<br>         a7:30:e7:91:86:8a:20:70:67:78:03:7f:85:28:5e:e4:29:78:<br>         7a:5b:77:<span class="hljs-built_in">df</span>:04:8e:af:b5:24:24:79:73:7d:9b:87:b4:c8:1d:<br>         c2:51:92:73:01:d1:4d:3e:d5:ab:80:a6:31:0d:b3:93:4a:96:<br>         <span class="hljs-built_in">df</span>:5d:b4:b3<br></code></pre></td></tr></table></figure><p>主要包含如下信息:</p><ul><li><code>CRL</code>文件签名的<code>CA</code>信息</li><li><code>Revoked Certificates</code>： 被吊销的证书, <code>7684EB63DF7437963A636BA64D848C5FE075EEC8</code>是被吊销的证书编号。</li><li><code>Signature Algorithm</code>: <code>ca</code>使用的数字签名算法</li><li>具体文件的数字签名值以保证<code>CRL</code>可信而不是不法分子发布</li></ul><p><code>CRL</code>作为<code>x.509</code>公钥证书标准的一部分, 同样采用<code>ASN.1</code>编码标准, 解析如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">╭─etcfly@etcfly-pc ~/Desktop/TLS/tls<br>╰─$ openssl asn1parse -<span class="hljs-keyword">in</span> ca.crl                                                                                                            130 ↵<br>    0:d=0  hl=4 l= 462 cons: SEQUENCE<br>    4:d=1  hl=3 l= 183 cons: SEQUENCE<br>    7:d=2  hl=2 l=   1 prim: INTEGER           :01<br>   10:d=2  hl=2 l=  13 cons: SEQUENCE<br>   12:d=3  hl=2 l=   9 prim: OBJECT            :md5WithRSAEncryption<br>   23:d=3  hl=2 l=   0 prim: NULL<br>   25:d=2  hl=2 l=  76 cons: SEQUENCE<br>   27:d=3  hl=2 l=  11 cons: SET<br>   29:d=4  hl=2 l=   9 cons: SEQUENCE<br>   31:d=5  hl=2 l=   3 prim: OBJECT            :countryName<br>   36:d=5  hl=2 l=   2 prim: PRINTABLESTRING   :CN<br>   40:d=3  hl=2 l=  13 cons: SET<br>   42:d=4  hl=2 l=  11 cons: SEQUENCE<br>   44:d=5  hl=2 l=   3 prim: OBJECT            :stateOrProvinceName<br>   49:d=5  hl=2 l=   4 prim: UTF8STRING        :TEST<br>   55:d=3  hl=2 l=  11 cons: SET<br>   57:d=4  hl=2 l=   9 cons: SEQUENCE<br>   59:d=5  hl=2 l=   3 prim: OBJECT            :localityName<br>   64:d=5  hl=2 l=   2 prim: UTF8STRING        :CA<br>   68:d=3  hl=2 l=  33 cons: SET<br>   70:d=4  hl=2 l=  31 cons: SEQUENCE<br>   72:d=5  hl=2 l=   3 prim: OBJECT            :organizationName<br>   77:d=5  hl=2 l=  24 prim: UTF8STRING        :Internet Widgits Pty Ltd<br>  103:d=2  hl=2 l=  13 prim: UTCTIME           :230711023059Z<br>  118:d=2  hl=2 l=  13 prim: UTCTIME           :250622023059Z<br>  133:d=2  hl=2 l=  39 cons: SEQUENCE<br>  135:d=3  hl=2 l=  37 cons: SEQUENCE<br>  137:d=4  hl=2 l=  20 prim: INTEGER           :7684EB63DF7437963A636BA64D848C5FE075EEC8<br>  159:d=4  hl=2 l=  13 prim: UTCTIME           :230711023035Z<br>  174:d=2  hl=2 l=  14 cons: cont [ 0 ]<br>  176:d=3  hl=2 l=  12 cons: SEQUENCE<br>  178:d=4  hl=2 l=  10 cons: SEQUENCE<br>  180:d=5  hl=2 l=   3 prim: OBJECT            :X509v3 CRL Number<br>  185:d=5  hl=2 l=   3 prim: OCTET STRING      [HEX DUMP]:020102<br>  190:d=1  hl=2 l=  13 cons: SEQUENCE<br>  192:d=2  hl=2 l=   9 prim: OBJECT            :md5WithRSAEncryption<br>  203:d=2  hl=2 l=   0 prim: NULL<br>  205:d=1  hl=4 l= 257 prim: BIT STRING<br></code></pre></td></tr></table></figure><p><code>PKI（Public Key Infrastructure）</code>即公钥基础设施技术为自动管理密钥和证书，保证网上数据信息传输的机密性、真实性、完整性和不可否认性提供了重要支撑。<code>PKI</code>采用证书进行公钥管理，通过第三方的可信任机构，把用户的公钥和用户的其它标识信息捆绑在一起，从而在网上验证用户的身份。通过以上的讲解, 我们对整个<code>pki</code>结构有了一个清楚的认识, 包括</p><ul><li>公钥密码技术（<code>Public Key Cryptography</code>）</li><li>证书认证机构（<code>CA</code>）</li><li>数字证书（<code>Digital Certificate</code>）</li></ul><p>至此关于证书的讲解基本上比较完整, 过程中有遗漏或不足的地方欢迎指正。</p><hr><h3 id="参考资料"><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h3><ul><li><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc5280#page-116">RFC 5280</a></li><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/ASN.1">ASN.1</a></li><li><a target="_blank" rel="noopener" href="https://lapo.it/asn1js/#">ASN.1 JavaScript decoder</a></li><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/">A Warm Welcome to ASN.1 and DER</a></li><li><a target="_blank" rel="noopener" href="https://luca.ntop.org/Teaching/Appunti/asn1.html">A Layman’s Guide to a Subset of ASN.1, BER, and DER</a></li><li><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/intl/zh-cn/ccm_faq/ccm_01_0054.html">主流数字证书有哪些格式？</a></li><li><a target="_blank" rel="noopener" href="https://linianhui.github.io/information-security/05-x.509/#encoding-format">X.509 公钥证书的格式标准</a></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" class="category-chain-item">密码学</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E5%8E%9F%E5%88%9B/">#原创</a> <a href="/tags/%E8%AF%81%E4%B9%A6%E6%A0%BC%E5%BC%8F-x509-ASN-1/">#证书格式 - x509 - ASN.1</a></div></div><div class="license-box my-3"><div class="license-title"><div>证书的类型和格式</div><div>http://example.com/2023/07/18/chipher/cert-x509-asn1/213008/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>EtcFly</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年7月18日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年3月5日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/07/18/chipher/base-openssl/214013/" title="openssl基础"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">openssl基础</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/06/18/chipher/rand-chipher/210155/" title="随机数和密码技术"><span class="hidden-mobile">随机数和密码技术</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",(function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.14.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.14.1/waline.min.js",(function(){var i=Object.assign({serverURL:"https://etcfly.top:14000/",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://unpkg.com/@waline/emojis@1.1.0/qq"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://github.com/EtcFly" target="_blank" rel="nofollow noopener"><span>Copyright</span></a> <i class="iconfont icon-copyright"></i> <a href="https://etcfly.top:14100/share/yqTLFDlP/%E4%BB%97%E5%89%91%E8%B5%B0%E5%A4%A9%E6%B6%AF" target="_blank" rel="nofollow noopener"><span>2018-2024 EtcFly</span></a><div style="font-size:.85rem"><span>总访问量 <span style="color:#000" id="PVstatic">0</span> 次&nbsp</span> <span>总访客数 <span style="color:#000" id="UVstatic">0</span> 人&nbsp</span> <span>当前在线 <span style="color:#000" id="ACTstatic">0</span> 人&nbsp</span><script src="https://etcfly.top:14200/statistics" defer></script></div><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="js/duration.js"></script></div></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener"></a> </span><span><a href="http://beian.miit.gov.cn/2023000858" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" alt="police-icon"> <span>浙ICP备2023000858号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/jquery.min.js"></script><script src="/live2d-widget/autoload.js"></script><script src="/js/star.js"></script><script src="/js/ribbon.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>