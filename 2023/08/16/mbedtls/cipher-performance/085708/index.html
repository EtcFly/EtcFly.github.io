<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="EtcFly"><meta name="keywords" content=""><meta name="description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介   MbedTLS是ARM开源的一款低资源占用高效加解密库,实现了AES, RSA, Hash, MD5等基础算法, 被广泛用于嵌入式系统中。 本文所有测试基于:  ubuntu18.04 Intel(R) Core(TM) i3-"><meta property="og:type" content="article"><meta property="og:title" content="mbedtls算法性能测试"><meta property="og:url" content="http://example.com/2023/08/16/mbedtls/cipher-performance/085708/"><meta property="og:site_name" content="仗剑走天涯"><meta property="og:description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介   MbedTLS是ARM开源的一款低资源占用高效加解密库,实现了AES, RSA, Hash, MD5等基础算法, 被广泛用于嵌入式系统中。 本文所有测试基于:  ubuntu18.04 Intel(R) Core(TM) i3-"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/chipher.png"><meta property="article:published_time" content="2023-08-16T08:57:08.000Z"><meta property="article:modified_time" content="2024-03-05T03:41:03.000Z"><meta property="article:author" content="EtcFly"><meta property="article:tag" content="原创"><meta property="article:tag" content="TLS"><meta property="article:tag" content="mbedtls"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/img/chipher.png"><title>mbedtls算法性能测试 仗剑走天涯</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/fluid-extention.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:4},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"3AEufnWAJdp8cFODp1DXvrQU-MdYXbMMI",app_key:"mGJiL6xVvYv21ygqfynJoCyO",server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Strive For Dream</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="mbedtls算法性能测试"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-16 08:57" pubdate>2023年8月16日 早上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 48k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 400 分钟 </span><span id="vvdpost_container_page_pvuv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="vvdpost_value_page_pv">0</span> 次&nbsp&nbsp <i class="iconfont icon-users" aria-hidden="true"></i> <span id="vvdpost_value_page_uv">0</span> 人</span><script>console.log(window.location.pathname);var httpRequest=new XMLHttpRequest;httpRequest.open("POST","https://etcfly.top:14200/poststats",!0),httpRequest.setRequestHeader("Content-type","application/json"),httpRequest.send(JSON.stringify(window.location.pathname)),httpRequest.onreadystatechange=function(){if(4==httpRequest.readyState&&200==httpRequest.status){var e=httpRequest.responseText,t=JSON.parse(e);console.log(t.pv);var o=document.querySelector("#vvdpost_container_page_pvuv");if(console.log(o),o){var n=document.querySelector("#vvdpost_value_page_pv");console.log(n);var s=document.querySelector("#vvdpost_value_page_uv");console.log(s),s&&s&&(n.innerText=t.pv,s.innerText=t.uv,o.style.display="inline")}}}</script></div></div></div></div></div></div><script async src="https://etcfly.top:14100/script.js" data-website-id="1a5c096d-21e5-4556-99b0-28c810c9c868"></script></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">mbedtls算法性能测试</h1><p class="note note-info">本文最后更新于：2024年3月5日 凌晨</p><div class="markdown-body"><div class="note note-success"><p>版权归作者所有, 转载请保留该部分声明。<br>本文作者：EtcFly<br>原文地址：<a target="_blank" rel="noopener" href="https://etcfly.top">https://etcfly.top</a></p></div><hr><h3 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h3><p>  <code>MbedTLS</code>是<code>ARM</code>开源的一款低资源占用高效加解密库,实现了<code>AES</code>, <code>RSA</code>, <code>Hash</code>, <code>MD5</code>等基础算法, 被广泛用于嵌入式系统中。</p><p>本文所有测试基于:</p><ul><li><code>ubuntu18.04</code></li><li><code>Intel(R) Core(TM) i3-4150 CPU @ 3.50GHz</code></li></ul><hr><h3 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h3><p>  <code>MbedTls</code>库主要是根目录下的<code>library</code>, <code>include</code>, <code>library</code>存放源码, <code>include</code>是库的头文件。指定配置文件通过自定义头文件, 这里定义配置头文件为<code>config.h</code>, 通过定义<code>Makefile</code>, 如:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Makefile">%.o : %.c<br>    gcc -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span> <span class="hljs-variable">$(LIB_INC)</span> <span class="hljs-variable">$(APP_INC)</span> -m32 -DMBEDTLS_CONFIG_FILE=\<span class="hljs-string">&quot;config.h\&quot; -g</span><br></code></pre></td></tr></table></figure><hr><h3 id="对称加密"><a class="markdownIt-Anchor" href="#对称加密"></a> 对称加密</h3><p>  <code>mbedtls</code>中关于对称加密有<code>AES.c</code>, 需要开启宏<code>MBEDTLS_AES_C</code></p><h4 id="aes"><a class="markdownIt-Anchor" href="#aes"></a> AES</h4><h5 id="字节码加密算法"><a class="markdownIt-Anchor" href="#字节码加密算法"></a> 字节码加密算法</h5><h6 id="ecb"><a class="markdownIt-Anchor" href="#ecb"></a> ECB</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><br>mbedtls_aes_init(&amp;aes_ctx); <span class="hljs-comment">//初始化</span><br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<span class="hljs-comment">//设置密匙</span><br>mbedtls_aes_crypt_ecb(&amp;aes_ctx, MBEDTLS_AES_ENCRYPT, plain, cipher); <span class="hljs-comment">//加密</span><br>mbedtls_aes_setkey_dec(&amp;aes_ctx, key, <span class="hljs-number">128</span>); <span class="hljs-comment">//设置解密密匙</span><br>mbedtls_aes_crypt_ecb(&amp;aes_ctx, MBEDTLS_AES_DECRYPT, cipher, dec_plain);<span class="hljs-comment">//解密</span><br>mbedtls_aes_free(&amp;aes_ctx); <span class="hljs-comment">//清零</span><br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>8.63s</code></td><td style="text-align:center"><code>8.801s</code></td></tr></tbody></table><hr><h6 id="cbc"><a class="markdownIt-Anchor" href="#cbc"></a> CBC</h6><p>  要想使用<code>CBC</code>模式, 需要开宏<code>MBEDTLS_CIPHER_MODE_CBC</code>, <strong>加密内容必须是16字节整数倍。</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv2[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//初始iv</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv3[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//解密iv</span><br><br>mbedtls_aes_init(&amp;aes_ctx);<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_cbc(&amp;aes_ctx, MBEDTLS_AES_ENCRYPT, <span class="hljs-number">16</span>, iv2, plain, cipher); <span class="hljs-comment">//加密, 加密过程中iv2会被修改, 因此解密不能用iv2, 应该备份之前的iv2</span><br><br>mbedtls_aes_setkey_dec(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_cbc(&amp;aes_ctx, MBEDTLS_AES_DECRYPT, <span class="hljs-number">16</span>, iv3, cipher,  dec_plain);<br>mbedtls_aes_free(&amp;aes_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>11.364s</code></td><td style="text-align:center"><code>11.522s</code></td></tr></tbody></table><hr><h5 id="流加密算法"><a class="markdownIt-Anchor" href="#流加密算法"></a> 流加密算法</h5><p>  流加密相对于字节码加密相比, 个别分组的错乱和丢失不影响后续加密, 同时支持并行解密。</p><hr><h6 id="cfb"><a class="markdownIt-Anchor" href="#cfb"></a> CFB</h6><p>  使用<code>CFB</code>需要开启宏<code>MBEDTLS_CIPHER_MODE_CFB</code></p><p><strong>CFB128</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv2[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//初始iv</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv3[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//解密iv</span><br><span class="hljs-type">size_t</span> iv_offset = <span class="hljs-number">0</span>; <span class="hljs-comment">//如果是多次加密, 这个返回流密码后期加密的iv</span><br><br>mbedtls_aes_init(&amp;aes_ctx);<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_cfb128(&amp;aes_ctx, MBEDTLS_AES_ENCRYPT, <span class="hljs-number">16</span>, &amp;iv_offset, iv2, plain, cipher); <span class="hljs-comment">//加密, 加密过程中iv2会被修改, 因此解密不能用iv2, 应该备份之前的iv2</span><br><br>iv_offset = <span class="hljs-number">0</span>;<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<span class="hljs-comment">//这里是加密</span><br>mbedtls_aes_crypt_cfb128(&amp;aes_ctx, MBEDTLS_AES_DECRYPT, <span class="hljs-number">16</span>, &amp;iv_offset, iv3, cipher,  dec_plain);<br>mbedtls_aes_free(&amp;aes_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>11.219s</code></td><td style="text-align:center"><code>11.182s</code></td></tr></tbody></table><p><strong>CFB8</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv2[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//初始iv</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv3[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//解密iv</span><br><span class="hljs-type">size_t</span> iv_offset = <span class="hljs-number">0</span>; <span class="hljs-comment">//如果是多次加密, 这个返回流密码后期加密的iv</span><br><br>mbedtls_aes_init(&amp;aes_ctx);<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_cfb8(&amp;aes_ctx, MBEDTLS_AES_ENCRYPT, <span class="hljs-number">16</span>, iv2, plain, cipher); <span class="hljs-comment">//加密, 加密过程中iv2会被修改, 因此解密不能用iv2, 应该备份之前的iv2</span><br><br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<span class="hljs-comment">//这里是加密</span><br>mbedtls_aes_crypt_cfb8(&amp;aes_ctx, MBEDTLS_AES_DECRYPT, <span class="hljs-number">16</span>, iv3, cipher,  dec_plain);<br>mbedtls_aes_free(&amp;aes_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>139.445s</code></td><td style="text-align:center"><code>137.123s</code></td></tr></tbody></table><p>之所以<code>cfb8</code>时间远超<code>cfb128</code>, 是因为<code>cfb8</code>是每一个字节作为一个分组进行流加密, 而<code>cfb128</code>是每<code>16Byte</code>作为一个分组加密。</p><hr><h6 id="ofb"><a class="markdownIt-Anchor" href="#ofb"></a> OFB</h6><p>  使用<code>CFB</code>需要开启宏<code>MBEDTLS_CIPHER_MODE_OFB</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv2[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//初始iv</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv3[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>&#125;;<span class="hljs-comment">//解密iv</span><br><span class="hljs-type">size_t</span> iv_offset = <span class="hljs-number">0</span>; <span class="hljs-comment">//如果是多次加密, 这个返回流密码后期加密的iv</span><br><br>mbedtls_aes_init(&amp;aes_ctx);<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_ofb(&amp;aes_ctx,  <span class="hljs-number">16</span>, &amp;iv_offset, iv2, plain, cipher); <span class="hljs-comment">//加密, 加密过程中iv2会被修改, 因此解密不能用iv2, 应该备份之前的iv2</span><br><br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<span class="hljs-comment">//这里是加密</span><br>mbedtls_aes_crypt_ofb(&amp;aes_ctx, <span class="hljs-number">16</span>, &amp;iv_offset, iv3, cipher,  dec_plain);<br>mbedtls_aes_free(&amp;aes_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>10.718s</code></td><td style="text-align:center"><code>10.736s</code></td></tr></tbody></table><hr><h6 id="ctr"><a class="markdownIt-Anchor" href="#ctr"></a> CTR</h6><p>需要开启宏<code>MBEDTLS_CIPHER_MODE_CTR</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_aes_context aes_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">16</span>] =&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">0</span>&#125;; <span class="hljs-comment">//密匙</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plain[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;helloworld&quot;</span>;  <span class="hljs-comment">//明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dec_plain[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//解密明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> cipher[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">//密文</span><br><br><span class="hljs-type">size_t</span> l_nc_off = <span class="hljs-number">0</span>; <span class="hljs-comment">//分组偏移量</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> l_nonce_counter[<span class="hljs-number">16</span>]=&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;;<span class="hljs-comment">//下次计数值</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> l_stream_count[<span class="hljs-number">16</span>]; <span class="hljs-comment">//临时变量</span><br><br>mbedtls_aes_init(&amp;aes_ctx);<br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_ctr(&amp;aes_ctx, <span class="hljs-number">16</span>, &amp;l_nc_off, l_nonce_counter, l_stream_count, plain, cipher);<span class="hljs-comment">//加密</span><br><br><br><span class="hljs-type">size_t</span> l_nc_off1 = <span class="hljs-number">0</span>;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> l_nonce_counter1[<span class="hljs-number">16</span>]=&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;;<span class="hljs-comment">//起始计数值(加密后存放下次计数值)</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> l_stream_count1[<span class="hljs-number">16</span>];<span class="hljs-comment">//临时值</span><br><br>mbedtls_aes_setkey_enc(&amp;aes_ctx, key, <span class="hljs-number">128</span>);<br>mbedtls_aes_crypt_ctr(&amp;aes_ctx, <span class="hljs-number">16</span>, &amp;l_nc_off1, l_nonce_counter1, l_stream_count1, cipher,  dec_plain);<span class="hljs-comment">//解码</span><br>mbedtls_aes_free(&amp;ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>10.962s</code></td><td style="text-align:center"><code>10.932s</code></td></tr></tbody></table><hr><h4 id="des"><a class="markdownIt-Anchor" href="#des"></a> DES</h4><p>  <code>DES</code>是一种<code>56bits</code>位密钥的加密, 另外有<code>8bits</code>校验位, 现在已经不安全, 这里只做测试。要使用<code>DES</code>, 需要开启宏<code>MBEDTLS_DES_C</code></p><h5 id="ecb模式"><a class="markdownIt-Anchor" href="#ecb模式"></a> ECB模式</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_des_context ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> des_key[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<span class="hljs-comment">//密钥</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in[<span class="hljs-number">8</span>] = &#123;<span class="hljs-string">&quot;hellowor&quot;</span>&#125;; <span class="hljs-comment">// 明文消息</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in_chipher[<span class="hljs-number">8</span>];<span class="hljs-comment">//加密后的密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">8</span>];<span class="hljs-comment">//解密后的明文</span><br><br>mbedtls_des_init(&amp;ctx);<br>mbedtls_des_key_set_parity(des_key);<span class="hljs-comment">//设置des_key中校验位</span><br>mbedtls_des_setkey_enc(&amp;ctx, des_key);<span class="hljs-comment">//</span><br><span class="hljs-type">int</span> ret = mbedtls_des_crypt_ecb(&amp;ctx,  in, in_chipher);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret: %d\r\n&quot;</span>, ret);<br><br>mbedtls_des_setkey_dec(&amp;ctx, des_key);<br>ret = mbedtls_des_crypt_ecb(&amp;ctx, in_chipher,  out);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret: %d\r\n&quot;</span>, ret);<br><br>mbedtls_des_free(&amp;ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>24.35s</code></td><td style="text-align:center"><code>24.98s</code></td></tr></tbody></table><p>可见, <code>DES</code>加解码效率都较低。</p><hr><h5 id="cbc模式"><a class="markdownIt-Anchor" href="#cbc模式"></a> CBC模式</h5><p>  要想使用<code>cbc</code>模式, 需要开启宏<code>MBEDTLS_CIPHER_MODE_CBC</code>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_des_context ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> des_key[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<span class="hljs-comment">//密钥</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in[<span class="hljs-number">8</span>] = &#123;<span class="hljs-string">&quot;hellowor&quot;</span>&#125;; <span class="hljs-comment">// 明文消息</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in_chipher[<span class="hljs-number">8</span>];<span class="hljs-comment">//加密后的密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">8</span>];<span class="hljs-comment">//解密后的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> iv[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> iv1[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><br>mbedtls_des_init(&amp;ctx);<br>mbedtls_des_key_set_parity(des_key);<span class="hljs-comment">//设置des_key中校验位</span><br>mbedtls_des_setkey_enc(&amp;ctx, des_key);<span class="hljs-comment">//</span><br><span class="hljs-type">int</span> ret = mbedtls_des_crypt_cbc(&amp;ctx,  MBEDTLS_DES_ENCRYPT, <span class="hljs-number">8</span>, iv, &amp;in[<span class="hljs-number">0</span>], &amp;in_chipher[<span class="hljs-number">0</span>]);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret: %d\r\n&quot;</span>, ret);<br><br>mbedtls_des_setkey_dec(&amp;ctx, des_key);<br>ret = mbedtls_des_crypt_cbc(&amp;ctx,  MBEDTLS_DES_DECRYPT, <span class="hljs-number">8</span>, iv1, in_chipher, out);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret: %d\r\n&quot;</span>, ret);<br>mbedtls_des_free(&amp;ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>27.837s</code></td><td style="text-align:center"><code>28.231s</code></td></tr></tbody></table><hr><h4 id="3des"><a class="markdownIt-Anchor" href="#3des"></a> 3DES</h4><h5 id="ecb模式-2"><a class="markdownIt-Anchor" href="#ecb模式-2"></a> ECB模式</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_des3_context ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> des_key[<span class="hljs-number">24</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<span class="hljs-comment">//密钥</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in[<span class="hljs-number">8</span>] = &#123;<span class="hljs-string">&quot;hellowor&quot;</span>&#125;; <span class="hljs-comment">// 明文消息</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in_chipher[<span class="hljs-number">8</span>];<span class="hljs-comment">//加密后的密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">8</span>];<span class="hljs-comment">//解密后的明文</span><br><br>mbedtls_des3_init(&amp;ctx);<br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">0</span>]);<br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">8</span>]);<br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">16</span>]);<br><br>mbedtls_des3_set3key_enc(&amp;ctx, des_key);<br>mbedtls_des3_crypt_ecb(&amp;ctx, in, in_chipher);<br><br>mbedtls_des3_set3key_dec(&amp;ctx, des_key);<br>mbedtls_des3_crypt_ecb(&amp;ctx, in_chipher, out);<br><br>mbedtls_des3_free(&amp;ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>56.889s</code></td><td style="text-align:center"><code>56.885s</code></td></tr></tbody></table><hr><h5 id="cbc模式-2"><a class="markdownIt-Anchor" href="#cbc模式-2"></a> CBC模式</h5><p>  <code>CBC</code>模式需要开启宏<code>MBEDTLS_CIPHER_MODE_CBC</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_des3_context ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> des_key[<span class="hljs-number">24</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>,<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<span class="hljs-comment">//密钥</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in[<span class="hljs-number">8</span>] = &#123;<span class="hljs-string">&quot;hellowor&quot;</span>&#125;; <span class="hljs-comment">// 明文消息</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> in_chipher[<span class="hljs-number">8</span>];<span class="hljs-comment">//加密后的密文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">8</span>];<span class="hljs-comment">//解密后的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> iv[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> iv1[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><br>mbedtls_des3_init(&amp;ctx);<br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">0</span>]);<span class="hljs-comment">//设置密钥奇偶校验</span><br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">8</span>]);<br>mbedtls_des_key_set_parity(&amp;des_key[<span class="hljs-number">16</span>]);<br><br>mbedtls_des3_set3key_enc(&amp;ctx, des_key);<span class="hljs-comment">//设置加密key</span><br>mbedtls_des3_crypt_cbc(&amp;ctx,  MBEDTLS_DES_ENCRYPT, <span class="hljs-number">8</span>, iv, in, in_chipher);<br><br>mbedtls_des3_set3key_dec(&amp;ctx, des_key);<br>mbedtls_des3_crypt_cbc(&amp;ctx,  MBEDTLS_DES_DECRYPT, <span class="hljs-number">8</span>, iv1, in_chipher, out);<br><br>mbedtls_des3_free(&amp;ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>60.950s</code></td><td style="text-align:center"><code>61.215s</code></td></tr></tbody></table><hr><h4 id="chacha20"><a class="markdownIt-Anchor" href="#chacha20"></a> chacha20</h4><p>  由于<code>AES</code>加密的复杂性, 当加密密钥位数越高, 其要求设备的算力就越强, 如何平衡高强度的密码安全和快速的加密是密码学家厄待解决的, 于是<code>chacha20</code>来了。</p><p><strong>加密</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">chacha20_enc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> ret;<br>    mbedtls_chacha20_context ctx;<br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">32</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> nonce[<span class="hljs-number">12</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;;<br><br>    mbedtls_chacha20_init(&amp;ctx);<br>    ret  = mbedtls_chacha20_setkey(&amp;ctx, key);<br>    ret |= mbedtls_chacha20_starts(&amp;ctx, nonce, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">aes_time_t</span> i=<span class="hljs-number">0</span>; i&lt;MAX_ENC_DATA_SIZE; i+=<span class="hljs-number">100</span>)<br>    &#123;<br>        ret |= mbedtls_chacha20_update(&amp;ctx, <span class="hljs-number">100</span>, &amp;in[i], &amp;in_chipher[i]);<br>        <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;chacha20 enc failr\r\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    mbedtls_chacha20_free(&amp;ctx);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>解密</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">chacha20_dec</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> ret;<br>    mbedtls_chacha20_context ctx;<br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[<span class="hljs-number">32</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>&#125;;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> nonce[<span class="hljs-number">12</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;;<br><br>    mbedtls_chacha20_init(&amp;ctx);<br>    ret  = mbedtls_chacha20_setkey(&amp;ctx, key);<br>    ret |= mbedtls_chacha20_starts(&amp;ctx, nonce, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">aes_time_t</span> i=<span class="hljs-number">0</span>; i&lt;MAX_ENC_DATA_SIZE; i+=<span class="hljs-number">100</span>)<br>    &#123;<br>        ret |= mbedtls_chacha20_update(&amp;ctx, <span class="hljs-number">100</span>, &amp;in_chipher[i], &amp;out[i]);<br>        <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;chacha20 enc failr\r\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    mbedtls_chacha20_free(&amp;ctx);<br>&#125;<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>28.590s</code></td><td style="text-align:center"><code>28.418s</code></td></tr></tbody></table><p>有的人会说比上面<code>AES</code>加密要慢, 实际上上面<code>AES</code>都是<code>128b</code>的密钥, <code>chacha20</code>是<code>256bits</code>密钥, 其次, 一般<code>chacha20</code>相对于<code>AES256</code>加解密速度要快。因此一般路由和<code>VPN</code>代理很多都采用<code>chacha20</code>来争取更高的吞吐量。</p><hr><h4 id="gcm模式"><a class="markdownIt-Anchor" href="#gcm模式"></a> GCM模式</h4><p>  <code>GCM ( Galois/Counter Mode)</code> 指的是该对称加密采用<code>Counter</code>模式，并带有<code>GMAC</code>消息认证码。因此该模式不仅提供了加密功能, 也可以用于消息的认证。使用<code>GCM</code>功能需要开启宏:</p><ul><li><code>MBEDTLS_GCM_C</code></li><li><code>MBEDTLS_CIPHER_C</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ENCODE_LEN (100u)</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> enc_key[<span class="hljs-number">32</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span> ,<span class="hljs-number">9</span>, <span class="hljs-number">0xa</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">245</span>, <span class="hljs-number">100</span>, <span class="hljs-number">190</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">90</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[MAX_ENCODE_LEN] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 要加密的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Chipher[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> decoder[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> auth[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> tag[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,&#125;; <span class="hljs-comment">// 4&lt;=len&lt;=16</span><br>mbedtls_gcm_context gcm_ctx;<br><br>mbedtls_gcm_init(&amp;gcm_ctx);<br><span class="hljs-type">int</span> ret = mbedtls_gcm_setkey(&amp;gcm_ctx, MBEDTLS_CIPHER_ID_AES, enc_key, <span class="hljs-number">256</span>);<span class="hljs-comment">//256Bit key</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br>ret = mbedtls_gcm_crypt_and_tag(&amp;gcm_ctx, MBEDTLS_GCM_ENCRYPT, MAX_ENCODE_LEN, iv, <span class="hljs-keyword">sizeof</span>(iv),<br>					auth, <span class="hljs-keyword">sizeof</span>(auth), plaintext, Chipher,  <span class="hljs-keyword">sizeof</span>(tag), tag);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br>mbedtls_gcm_free(&amp;gcm_ctx);<br><br>mbedtls_gcm_init(&amp;gcm_ctx);<br>ret = mbedtls_gcm_setkey(&amp;gcm_ctx, MBEDTLS_CIPHER_ID_AES, enc_key, <span class="hljs-number">256</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br>ret = mbedtls_gcm_crypt_and_tag(&amp;gcm_ctx, MBEDTLS_GCM_DECRYPT, MAX_ENCODE_LEN, iv, <span class="hljs-keyword">sizeof</span>(iv),<br>					auth, <span class="hljs-keyword">sizeof</span>(auth), Chipher, decoder,  <span class="hljs-keyword">sizeof</span>(tag), tag);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d info:%s\r\n&quot;</span>, ret, decoder);<br><br>mbedtls_gcm_free(&amp;gcm_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>31. 69s</code></td><td style="text-align:center"><code>31. 60s</code></td></tr></tbody></table><hr><h4 id="ccm模式"><a class="markdownIt-Anchor" href="#ccm模式"></a> CCM模式</h4><p>  <code>CCM</code>和<code>GCM</code>类似都是认证加密算法, 要想使用<code>CCM</code>功能, 需要开启:</p><ul><li><code>MBEDTLS_CCM_C</code></li><li><code>MBEDTLS_CIPHER_C</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ENCODE_LEN (100u)</span><br>mbedtls_ccm_context ccm_ctx;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> enc_key[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span> ,<span class="hljs-number">9</span>, <span class="hljs-number">0xa</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> iv[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">245</span>, <span class="hljs-number">100</span>, <span class="hljs-number">190</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">90</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[MAX_ENCODE_LEN] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 要加密的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Chipher[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> decoder[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> auth[<span class="hljs-number">300</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> tag[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,&#125;; <span class="hljs-comment">// 4&lt;=len&lt;=16</span><br><br>mbedtls_ccm_init(&amp;ccm_ctx);<br><span class="hljs-type">int</span> ret = mbedtls_ccm_setkey(&amp;ccm_ctx, MBEDTLS_CIPHER_ID_AES, enc_key, <span class="hljs-number">128</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_ccm_encrypt_and_tag(&amp;ccm_ctx, MAX_ENCODE_LEN, iv, <span class="hljs-keyword">sizeof</span>(iv),<br>					auth, <span class="hljs-keyword">sizeof</span>(auth), plaintext, Chipher, tag, <span class="hljs-keyword">sizeof</span>(tag));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br><br>mbedtls_ccm_free(&amp;ccm_ctx);<br><br>mbedtls_ccm_init(&amp;ccm_ctx);<br>ret = mbedtls_ccm_setkey(&amp;ccm_ctx, MBEDTLS_CIPHER_ID_AES, enc_key, <span class="hljs-number">128</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br>ret = mbedtls_ccm_auth_decrypt(&amp;ccm_ctx, MAX_ENCODE_LEN, iv, <span class="hljs-keyword">sizeof</span>(iv),<br>					auth, <span class="hljs-keyword">sizeof</span>(auth), Chipher, decoder, tag, <span class="hljs-keyword">sizeof</span>(tag));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d %s\r\n&quot;</span>, ret, decoder);<br><br>mbedtls_ccm_free(&amp;ccm_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>25.402s</code></td><td style="text-align:center"><code>26.694s</code></td></tr></tbody></table><hr><h4 id="chacha20-ploy"><a class="markdownIt-Anchor" href="#chacha20-ploy"></a> chacha20-ploy</h4><p>  <code>chacha20</code>一款流加密算法, 并不提供<code>MAC</code>相关功能, 而<code>chacha20-ploy</code>则包含了认证和加密功能。需要开启的宏有:</p><ul><li><code>MBEDTLS_CHACHAPOLY_C</code></li><li><code>MBEDTLS_POLY1305_C</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ENCODE_LEN (100u)</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> enc_key[<span class="hljs-number">32</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">98</span>, <span class="hljs-number">100</span>, <span class="hljs-number">23</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> none[<span class="hljs-number">12</span>] = &#123;<span class="hljs-number">245</span>, <span class="hljs-number">100</span>, <span class="hljs-number">190</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">90</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[MAX_ENCODE_LEN] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 要加密的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Chipher[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> decoder[MAX_ENCODE_LEN];<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> auth[<span class="hljs-number">300</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> tag[<span class="hljs-number">16</span>] = &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,&#125;; <span class="hljs-comment">// 4&lt;=len&lt;=16</span><br>mbedtls_chachapoly_context chacha_ctx;<br><br><span class="hljs-comment">//加密</span><br>mbedtls_chachapoly_init(&amp;chacha_ctx);<br><span class="hljs-type">int</span> ret = mbedtls_chachapoly_setkey(&amp;chacha_ctx, enc_key);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_chachapoly_encrypt_and_tag(&amp;chacha_ctx, MAX_ENCODE_LEN, none, auth, <span class="hljs-keyword">sizeof</span>(auth), plaintext, Chipher, tag);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br><br>mbedtls_chachapoly_free(&amp;chacha_ctx);<br><br><span class="hljs-comment">//解密</span><br>mbedtls_chachapoly_init(&amp;chacha_ctx);<br>ret = mbedtls_chachapoly_setkey(&amp;chacha_ctx, enc_key);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_chachapoly_auth_decrypt(&amp;chacha_ctx, MAX_ENCODE_LEN, none, auth, <span class="hljs-keyword">sizeof</span>(auth), tag, Chipher, decoder);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d %s\r\n&quot;</span>, ret, decoder);<br><br>mbedtls_chachapoly_free(&amp;chacha_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>33.885s</code></td><td style="text-align:center"><code>33.863s</code></td></tr></tbody></table><p>从上述<code>GCM</code>和本次测试结果来看, <code>chacha-poly</code>并不占优势, 这里测试平台是<code>ubuntu-18.04</code>, <code>cpu</code>是<code>Intel(R) Core(TM) i3-4150 CPU @ 3.50GHz</code>, 其支持<code>AES</code>硬件级加密指令集<code>AES-NI</code>, 但是相关资料表明, <code>chacha20</code>更适合<code>ARM</code>架构平台, 并且效率是<code>GCM</code>的三倍之多, 具体大家可以自行测试。</p><hr><h3 id="非对称加密"><a class="markdownIt-Anchor" href="#非对称加密"></a> 非对称加密</h3><h4 id="rsa"><a class="markdownIt-Anchor" href="#rsa"></a> RSA</h4><p>  <code>RSA</code>加密由于其非对称特性通常被用于交换通讯双方密钥, 通常服务端提供加密的公钥, 设备端采用公钥加密对称加密的共享密钥, 由于公钥加密的消息只能私钥解码, 从而保证了密钥的安全交换。</p><p>  对于一些较短的明文, 为了安全, 还需要填充数据保证加密的强度(具体可参考:<a target="_blank" rel="noopener" href="https://etcfly.top/2023/06/18/chipher/aes/rsa/204920/">对称加密和非对称加密</a>)。填充标准有:<code>PKCS#1 V1.5</code>和<code>PKCS#1 V2.1</code>(<code>OAEP</code>), 目前已经证明, <code>PKCS#1 V1.5</code>已经不安全。</p><h5 id="密钥生成"><a class="markdownIt-Anchor" href="#密钥生成"></a> 密钥生成</h5><p>  非对称加密首先需要生成密钥, 密钥的生成是一件非常耗费时间的事情, 因此通常在服务端生成, 密钥生成以后保存起来可以后期使用。要想使用<code>RSA</code>模块, 需要开启宏:</p><ul><li><code>MBEDTLS_RSA_C</code></li><li><code>MBEDTLS_OID_C</code></li><li><code>MBEDTLS_BIGNUM_C</code></li></ul><p><code>mbedtls</code>密钥生成如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CHIPHER_LEN 3072 <span class="hljs-comment">//公钥位数(bits)</span></span><br><br>mbedtls_rsa_context ctx;<br>mbedtls_ctr_drbg_context ctrl_drbg;<br><br>mbedtls_rsa_init(&amp;ctx);<br>mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<span class="hljs-comment">//初始化随机数</span><br>mbedtls_rsa_gen_key(&amp;ctx, mbedtls_ctr_drbg_random, &amp;ctrl_drbg, MAX_CHIPHER_LEN, <span class="hljs-number">65537</span>);<span class="hljs-comment">//产生密钥对(耗时较长)</span><br><br>mbedtls_rsa_free(&amp;ctx);<br>mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br></code></pre></td></tr></table></figure><p>此时生成的密钥保存在<code>ctx</code>中, 可以通过如下方式导出:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CHIPHER_LEN 3072 <span class="hljs-comment">//公钥位数(bits)</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_N_LEN MAX_CHIPHER_LEN/8</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> N[MAX_N_LEN], P[MAX_N_LEN/<span class="hljs-number">2</span>], Q[MAX_N_LEN/<span class="hljs-number">2</span>], D[MAX_N_LEN], E[MAX_N_LEN];<br><br>ret = mbedtls_rsa_export_raw(&amp;ctx,<br>                            N, MAX_N_LEN,<br>                            P, MAX_N_LEN/<span class="hljs-number">2</span>,<br>                            Q, MAX_N_LEN/<span class="hljs-number">2</span>,<br>                            D, MAX_N_LEN,<br>                            E, MAX_N_LEN);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;export raw result:%d\r\n&quot;</span>, ret);<br></code></pre></td></tr></table></figure><p>导出的<code>(E, N)</code>组成公钥, <code>(D, N)</code>组成私钥, 保存做后期加解密使用。这里输出结果为:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> N[] = &#123;<br><span class="hljs-number">0XB4</span>, <span class="hljs-number">0XEA</span>, <span class="hljs-number">0X33</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X15</span>, <span class="hljs-number">0X94</span>, <span class="hljs-number">0XAC</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0X6F</span>, <span class="hljs-number">0X73</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0X69</span>, <span class="hljs-number">0X32</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X5B</span>, <span class="hljs-number">0XDA</span>,<br><span class="hljs-number">0X01</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X2A</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0X09</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XDB</span>, <span class="hljs-number">0XE8</span>, <span class="hljs-number">0X20</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0X10</span>, <span class="hljs-number">0X3D</span>,<br><span class="hljs-number">0X2E</span>, <span class="hljs-number">0XCF</span>, <span class="hljs-number">0X0B</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0X47</span>, <span class="hljs-number">0X36</span>, <span class="hljs-number">0XCC</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0X7D</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0XEB</span>, <span class="hljs-number">0X02</span>, <span class="hljs-number">0X4A</span>,<br><span class="hljs-number">0X4E</span>, <span class="hljs-number">0X10</span>, <span class="hljs-number">0X91</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0XDD</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0XF9</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0X87</span>, <span class="hljs-number">0X69</span>, <span class="hljs-number">0X3F</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0X6A</span>,<br><span class="hljs-number">0X2C</span>, <span class="hljs-number">0X6E</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0X47</span>, <span class="hljs-number">0X85</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0X20</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0X8C</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0X88</span>, <span class="hljs-number">0X12</span>,<br><span class="hljs-number">0X38</span>, <span class="hljs-number">0X4B</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X64</span>, <span class="hljs-number">0X5F</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0XD8</span>, <span class="hljs-number">0X32</span>, <span class="hljs-number">0X23</span>, <span class="hljs-number">0X05</span>, <span class="hljs-number">0XEA</span>, <span class="hljs-number">0X65</span>, <span class="hljs-number">0XDC</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0X22</span>,<br><span class="hljs-number">0X37</span>, <span class="hljs-number">0X5C</span>, <span class="hljs-number">0XA2</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0XA2</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X17</span>, <span class="hljs-number">0XD2</span>, <span class="hljs-number">0X99</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X7E</span>, <span class="hljs-number">0X78</span>, <span class="hljs-number">0XBB</span>,<br><span class="hljs-number">0X34</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0XF1</span>, <span class="hljs-number">0X80</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0X29</span>, <span class="hljs-number">0XD5</span>, <span class="hljs-number">0X8A</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0X3B</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0X75</span>, <span class="hljs-number">0X73</span>, <span class="hljs-number">0X6B</span>, <span class="hljs-number">0XC8</span>,<br><span class="hljs-number">0X3B</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0X0B</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0X5C</span>, <span class="hljs-number">0X37</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0X54</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0XD4</span>, <span class="hljs-number">0XF2</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0X9A</span>, <span class="hljs-number">0XDA</span>, <span class="hljs-number">0X2A</span>,<br><span class="hljs-number">0X63</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0XB2</span>, <span class="hljs-number">0XFB</span>, <span class="hljs-number">0X3B</span>, <span class="hljs-number">0X0A</span>, <span class="hljs-number">0XCF</span>, <span class="hljs-number">0XB1</span>, <span class="hljs-number">0X89</span>, <span class="hljs-number">0X10</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0XE2</span>, <span class="hljs-number">0X39</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0X4E</span>,<br><span class="hljs-number">0X8C</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0X05</span>, <span class="hljs-number">0XBB</span>, <span class="hljs-number">0XB2</span>, <span class="hljs-number">0X64</span>, <span class="hljs-number">0X86</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0X7E</span>, <span class="hljs-number">0X59</span>, <span class="hljs-number">0X3A</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X91</span>,<br><span class="hljs-number">0XE6</span>, <span class="hljs-number">0X75</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0XBF</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0XAB</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0XEF</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0XF2</span>, <span class="hljs-number">0X9C</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X6B</span>,<br><span class="hljs-number">0XE3</span>, <span class="hljs-number">0X01</span>, <span class="hljs-number">0XBF</span>, <span class="hljs-number">0X66</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X65</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0X9C</span>, <span class="hljs-number">0XBA</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0X92</span>, <span class="hljs-number">0XA0</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0X2C</span>,<br><span class="hljs-number">0X18</span>, <span class="hljs-number">0XFA</span>, <span class="hljs-number">0X9D</span>, <span class="hljs-number">0XC1</span>, <span class="hljs-number">0X78</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0XB8</span>, <span class="hljs-number">0X8A</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0XFC</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0X23</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0X74</span>,<br><span class="hljs-number">0XC2</span>, <span class="hljs-number">0XC3</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X26</span>, <span class="hljs-number">0XC3</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0X65</span>, <span class="hljs-number">0XED</span>, <span class="hljs-number">0XCF</span>, <span class="hljs-number">0XCA</span>, <span class="hljs-number">0XA5</span>, <span class="hljs-number">0XA8</span>, <span class="hljs-number">0XA9</span>,<br><span class="hljs-number">0XAD</span>, <span class="hljs-number">0X8B</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0XE1</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X2E</span>, <span class="hljs-number">0X25</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0XF5</span>, <span class="hljs-number">0XD1</span>,<br><span class="hljs-number">0X83</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0XDA</span>, <span class="hljs-number">0X15</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0X12</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0XB3</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X2A</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X93</span>, <span class="hljs-number">0XAD</span>, <span class="hljs-number">0X5A</span>,<br><span class="hljs-number">0X4A</span>, <span class="hljs-number">0X21</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X8F</span>, <span class="hljs-number">0X74</span>, <span class="hljs-number">0XCD</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0X44</span>, <span class="hljs-number">0X41</span>, <span class="hljs-number">0X90</span>, <span class="hljs-number">0X59</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0XD1</span>, <span class="hljs-number">0XF2</span>, <span class="hljs-number">0X09</span>, <span class="hljs-number">0X5C</span>,<br><span class="hljs-number">0X93</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0XC2</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0X90</span>, <span class="hljs-number">0X5C</span>, <span class="hljs-number">0X21</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0XC8</span>, <span class="hljs-number">0X43</span>, <span class="hljs-number">0X7C</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0X72</span>,<br><span class="hljs-number">0X06</span>, <span class="hljs-number">0XA2</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0X14</span>, <span class="hljs-number">0XF9</span>, <span class="hljs-number">0X66</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0X1F</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0X79</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0XE2</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0XBE</span>,<br><span class="hljs-number">0XB0</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X1D</span>, <span class="hljs-number">0X29</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X54</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0XBF</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0XAB</span>, <span class="hljs-number">0XEE</span>, <span class="hljs-number">0X8B</span>, <span class="hljs-number">0X07</span>, <span class="hljs-number">0X71</span>,<br><span class="hljs-number">0XC2</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0X3A</span>, <span class="hljs-number">0X14</span>, <span class="hljs-number">0XE1</span>, <span class="hljs-number">0X01</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0X71</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X2B</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0X12</span>, <span class="hljs-number">0X3F</span>, <span class="hljs-number">0X13</span>,<br><span class="hljs-number">0X0F</span>, <span class="hljs-number">0X38</span>, <span class="hljs-number">0X63</span>, <span class="hljs-number">0X95</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0X08</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0XE9</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0X45</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0XA6</span>, <span class="hljs-number">0X2E</span>,<br><span class="hljs-number">0X53</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0X3D</span>, <span class="hljs-number">0X5E</span>, <span class="hljs-number">0XD3</span>, <span class="hljs-number">0XA6</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0X4D</span>, <span class="hljs-number">0XE0</span>, <span class="hljs-number">0XF8</span>, <span class="hljs-number">0X2C</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0X9D</span>, <span class="hljs-number">0XD9</span>,<br>&#125;;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> D[] = &#123;<br><span class="hljs-number">0X0C</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X5A</span>, <span class="hljs-number">0X5F</span>, <span class="hljs-number">0XA5</span>, <span class="hljs-number">0X6A</span>, <span class="hljs-number">0X32</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0X3B</span>, <span class="hljs-number">0XAD</span>, <span class="hljs-number">0X6E</span>, <span class="hljs-number">0X91</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0XB3</span>,<br><span class="hljs-number">0X8C</span>, <span class="hljs-number">0X94</span>, <span class="hljs-number">0X4D</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0X24</span>, <span class="hljs-number">0X4E</span>, <span class="hljs-number">0X3A</span>, <span class="hljs-number">0XB5</span>, <span class="hljs-number">0X03</span>, <span class="hljs-number">0XB5</span>, <span class="hljs-number">0X93</span>, <span class="hljs-number">0XCC</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X4A</span>, <span class="hljs-number">0XD6</span>, <span class="hljs-number">0XF2</span>,<br><span class="hljs-number">0X2A</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0XC1</span>, <span class="hljs-number">0XB7</span>, <span class="hljs-number">0XF5</span>, <span class="hljs-number">0X08</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X65</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0XD2</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X7C</span>, <span class="hljs-number">0X9E</span>, <span class="hljs-number">0X9A</span>, <span class="hljs-number">0XDB</span>,<br><span class="hljs-number">0XF6</span>, <span class="hljs-number">0X5B</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0XA5</span>, <span class="hljs-number">0X50</span>, <span class="hljs-number">0XD8</span>, <span class="hljs-number">0X65</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0XC4</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0X89</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X67</span>, <span class="hljs-number">0XA6</span>, <span class="hljs-number">0XD0</span>,<br><span class="hljs-number">0X1D</span>, <span class="hljs-number">0X89</span>, <span class="hljs-number">0XA3</span>, <span class="hljs-number">0XD5</span>, <span class="hljs-number">0XCB</span>, <span class="hljs-number">0X13</span>, <span class="hljs-number">0X9A</span>, <span class="hljs-number">0X7F</span>, <span class="hljs-number">0XD1</span>, <span class="hljs-number">0X8A</span>, <span class="hljs-number">0X80</span>, <span class="hljs-number">0X21</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X4E</span>,<br><span class="hljs-number">0XBA</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0XA8</span>, <span class="hljs-number">0XFB</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0XD6</span>, <span class="hljs-number">0XFD</span>, <span class="hljs-number">0X18</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0XBE</span>, <span class="hljs-number">0X6B</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0XF5</span>, <span class="hljs-number">0X6B</span>,<br><span class="hljs-number">0X07</span>, <span class="hljs-number">0X54</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0X99</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0X4B</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0X90</span>, <span class="hljs-number">0XBA</span>, <span class="hljs-number">0X7D</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0XFF</span>, <span class="hljs-number">0XA7</span>,<br><span class="hljs-number">0XE8</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0X11</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X21</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0X01</span>, <span class="hljs-number">0XED</span>, <span class="hljs-number">0X67</span>, <span class="hljs-number">0XDA</span>, <span class="hljs-number">0XA1</span>, <span class="hljs-number">0XE8</span>, <span class="hljs-number">0X10</span>,<br><span class="hljs-number">0XD0</span>, <span class="hljs-number">0XAD</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0X49</span>, <span class="hljs-number">0X41</span>, <span class="hljs-number">0XED</span>, <span class="hljs-number">0X41</span>, <span class="hljs-number">0X51</span>, <span class="hljs-number">0X7E</span>, <span class="hljs-number">0X48</span>, <span class="hljs-number">0X35</span>, <span class="hljs-number">0XD3</span>, <span class="hljs-number">0XF1</span>, <span class="hljs-number">0X9D</span>, <span class="hljs-number">0XCF</span>, <span class="hljs-number">0X0C</span>,<br><span class="hljs-number">0X21</span>, <span class="hljs-number">0X6F</span>, <span class="hljs-number">0X7B</span>, <span class="hljs-number">0XB2</span>, <span class="hljs-number">0XF4</span>, <span class="hljs-number">0X48</span>, <span class="hljs-number">0XB6</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0X39</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0XA1</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0X98</span>, <span class="hljs-number">0XFF</span>, <span class="hljs-number">0X04</span>,<br><span class="hljs-number">0XC1</span>, <span class="hljs-number">0XEB</span>, <span class="hljs-number">0X4E</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0XE1</span>, <span class="hljs-number">0X37</span>, <span class="hljs-number">0X0D</span>, <span class="hljs-number">0X26</span>, <span class="hljs-number">0XEE</span>, <span class="hljs-number">0XD5</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X75</span>, <span class="hljs-number">0XB9</span>, <span class="hljs-number">0X9E</span>,<br><span class="hljs-number">0X24</span>, <span class="hljs-number">0X97</span>, <span class="hljs-number">0XFC</span>, <span class="hljs-number">0XB7</span>, <span class="hljs-number">0X32</span>, <span class="hljs-number">0X73</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X1B</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0X5A</span>, <span class="hljs-number">0X3F</span>, <span class="hljs-number">0X78</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0XD4</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0XF8</span>,<br><span class="hljs-number">0X58</span>, <span class="hljs-number">0X5F</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0X66</span>, <span class="hljs-number">0X7F</span>, <span class="hljs-number">0X58</span>, <span class="hljs-number">0X29</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0X84</span>, <span class="hljs-number">0X74</span>, <span class="hljs-number">0XEF</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0XF2</span>, <span class="hljs-number">0XB7</span>,<br><span class="hljs-number">0X63</span>, <span class="hljs-number">0XB3</span>, <span class="hljs-number">0X25</span>, <span class="hljs-number">0X54</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0X5B</span>, <span class="hljs-number">0XE2</span>, <span class="hljs-number">0XB0</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0X12</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XD9</span>, <span class="hljs-number">0X88</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0XDC</span>,<br><span class="hljs-number">0X8D</span>, <span class="hljs-number">0X19</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0X6B</span>, <span class="hljs-number">0XC5</span>, <span class="hljs-number">0X40</span>, <span class="hljs-number">0X17</span>, <span class="hljs-number">0XC1</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0X87</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0X38</span>,<br><span class="hljs-number">0XF5</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XD3</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0XFA</span>, <span class="hljs-number">0XA2</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0X73</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0X29</span>, <span class="hljs-number">0X12</span>, <span class="hljs-number">0X9C</span>, <span class="hljs-number">0X74</span>, <span class="hljs-number">0X85</span>, <span class="hljs-number">0XD1</span>,<br><span class="hljs-number">0XAD</span>, <span class="hljs-number">0XE0</span>, <span class="hljs-number">0X2F</span>, <span class="hljs-number">0X87</span>, <span class="hljs-number">0X25</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0X28</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0X66</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X59</span>, <span class="hljs-number">0X16</span>, <span class="hljs-number">0X95</span>, <span class="hljs-number">0X95</span>,<br><span class="hljs-number">0X96</span>, <span class="hljs-number">0X6F</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0XE1</span>, <span class="hljs-number">0X4E</span>, <span class="hljs-number">0XCC</span>, <span class="hljs-number">0X7D</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0X64</span>, <span class="hljs-number">0X45</span>, <span class="hljs-number">0X2A</span>, <span class="hljs-number">0XAB</span>, <span class="hljs-number">0X46</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0X69</span>,<br><span class="hljs-number">0X8C</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0X64</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X69</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0X48</span>, <span class="hljs-number">0XA3</span>, <span class="hljs-number">0XA8</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0XB3</span>, <span class="hljs-number">0XDB</span>, <span class="hljs-number">0X09</span>, <span class="hljs-number">0XB0</span>,<br><span class="hljs-number">0X09</span>, <span class="hljs-number">0X20</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X08</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X4C</span>, <span class="hljs-number">0X7F</span>, <span class="hljs-number">0XBF</span>, <span class="hljs-number">0XA5</span>, <span class="hljs-number">0XDA</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0X39</span>, <span class="hljs-number">0XCB</span>, <span class="hljs-number">0X0D</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0X47</span>,<br><span class="hljs-number">0XCA</span>, <span class="hljs-number">0XC4</span>, <span class="hljs-number">0XE3</span>, <span class="hljs-number">0XCD</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0XB7</span>, <span class="hljs-number">0XA1</span>, <span class="hljs-number">0X5E</span>, <span class="hljs-number">0X5A</span>, <span class="hljs-number">0X93</span>, <span class="hljs-number">0XD3</span>, <span class="hljs-number">0X2F</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0X8F</span>,<br><span class="hljs-number">0X37</span>, <span class="hljs-number">0X6A</span>, <span class="hljs-number">0XD5</span>, <span class="hljs-number">0XDB</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0X19</span>, <span class="hljs-number">0X8C</span>, <span class="hljs-number">0XBE</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0X06</span>, <span class="hljs-number">0X2E</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0X07</span>,<br><span class="hljs-number">0X7E</span>, <span class="hljs-number">0X7B</span>, <span class="hljs-number">0X28</span>, <span class="hljs-number">0X1C</span>, <span class="hljs-number">0X99</span>, <span class="hljs-number">0XE8</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0XE3</span>, <span class="hljs-number">0XE9</span>, <span class="hljs-number">0X2A</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0X71</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0X37</span>, <span class="hljs-number">0XD2</span>,<br><span class="hljs-number">0XC8</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0X91</span>, <span class="hljs-number">0X7D</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0X5B</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0XA9</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0X4D</span>, <span class="hljs-number">0XC8</span>, <span class="hljs-number">0X37</span>, <span class="hljs-number">0X45</span>, <span class="hljs-number">0X15</span>,<br>&#125;;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> E[] = &#123;<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>,<br><span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X01</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X01</span>,<br>&#125;;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> P[] = &#123;<br><span class="hljs-number">0XE8</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X71</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0X89</span>, <span class="hljs-number">0X4B</span>, <span class="hljs-number">0XD3</span>, <span class="hljs-number">0X8D</span>, <span class="hljs-number">0X53</span>, <span class="hljs-number">0X95</span>, <span class="hljs-number">0XFB</span>, <span class="hljs-number">0XEB</span>, <span class="hljs-number">0X2C</span>, <span class="hljs-number">0X44</span>,<br><span class="hljs-number">0X86</span>, <span class="hljs-number">0XCA</span>, <span class="hljs-number">0X02</span>, <span class="hljs-number">0X1E</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X2B</span>, <span class="hljs-number">0X6E</span>, <span class="hljs-number">0XBC</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0X19</span>, <span class="hljs-number">0XDD</span>, <span class="hljs-number">0X23</span>, <span class="hljs-number">0XC3</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X66</span>,<br><span class="hljs-number">0X21</span>, <span class="hljs-number">0X42</span>, <span class="hljs-number">0X99</span>, <span class="hljs-number">0XB5</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X02</span>, <span class="hljs-number">0X50</span>, <span class="hljs-number">0XA8</span>, <span class="hljs-number">0X26</span>, <span class="hljs-number">0X75</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0X40</span>, <span class="hljs-number">0X7F</span>, <span class="hljs-number">0XCD</span>, <span class="hljs-number">0XD1</span>,<br><span class="hljs-number">0X99</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0XA1</span>, <span class="hljs-number">0X47</span>, <span class="hljs-number">0X08</span>, <span class="hljs-number">0X4C</span>, <span class="hljs-number">0X4B</span>, <span class="hljs-number">0X9F</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X33</span>, <span class="hljs-number">0X46</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0X6F</span>, <span class="hljs-number">0X3D</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0XED</span>,<br><span class="hljs-number">0X11</span>, <span class="hljs-number">0XC1</span>, <span class="hljs-number">0X66</span>, <span class="hljs-number">0XF9</span>, <span class="hljs-number">0X8B</span>, <span class="hljs-number">0X09</span>, <span class="hljs-number">0XE0</span>, <span class="hljs-number">0X67</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0XA6</span>, <span class="hljs-number">0XC3</span>, <span class="hljs-number">0X49</span>, <span class="hljs-number">0XF8</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0X28</span>, <span class="hljs-number">0XAE</span>,<br><span class="hljs-number">0XDE</span>, <span class="hljs-number">0XC3</span>, <span class="hljs-number">0X58</span>, <span class="hljs-number">0X48</span>, <span class="hljs-number">0X13</span>, <span class="hljs-number">0X76</span>, <span class="hljs-number">0X5F</span>, <span class="hljs-number">0XF3</span>, <span class="hljs-number">0XA5</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0XD6</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0XA1</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0XA0</span>, <span class="hljs-number">0XA7</span>,<br><span class="hljs-number">0XE2</span>, <span class="hljs-number">0X11</span>, <span class="hljs-number">0X74</span>, <span class="hljs-number">0XB6</span>, <span class="hljs-number">0X14</span>, <span class="hljs-number">0X95</span>, <span class="hljs-number">0XFB</span>, <span class="hljs-number">0XBA</span>, <span class="hljs-number">0XFC</span>, <span class="hljs-number">0X4E</span>, <span class="hljs-number">0XAB</span>, <span class="hljs-number">0X92</span>, <span class="hljs-number">0X24</span>, <span class="hljs-number">0X0D</span>, <span class="hljs-number">0X10</span>, <span class="hljs-number">0XCE</span>,<br><span class="hljs-number">0XBD</span>, <span class="hljs-number">0X36</span>, <span class="hljs-number">0X59</span>, <span class="hljs-number">0X00</span>, <span class="hljs-number">0X9F</span>, <span class="hljs-number">0X6A</span>, <span class="hljs-number">0X3D</span>, <span class="hljs-number">0X28</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0X30</span>, <span class="hljs-number">0X07</span>, <span class="hljs-number">0X3E</span>, <span class="hljs-number">0XFE</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X62</span>,<br><span class="hljs-number">0XB1</span>, <span class="hljs-number">0X52</span>, <span class="hljs-number">0XB8</span>, <span class="hljs-number">0X9E</span>, <span class="hljs-number">0XEF</span>, <span class="hljs-number">0XFC</span>, <span class="hljs-number">0X63</span>, <span class="hljs-number">0X0E</span>, <span class="hljs-number">0X35</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0XF1</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0X13</span>, <span class="hljs-number">0XE5</span>, <span class="hljs-number">0X78</span>,<br><span class="hljs-number">0X16</span>, <span class="hljs-number">0X16</span>, <span class="hljs-number">0XA0</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0XFF</span>, <span class="hljs-number">0XA6</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X07</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0XB8</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0X54</span>,<br><span class="hljs-number">0X9A</span>, <span class="hljs-number">0XE0</span>, <span class="hljs-number">0X2C</span>, <span class="hljs-number">0XA3</span>, <span class="hljs-number">0XE5</span>, <span class="hljs-number">0XF5</span>, <span class="hljs-number">0XCA</span>, <span class="hljs-number">0X87</span>, <span class="hljs-number">0X70</span>, <span class="hljs-number">0X7F</span>, <span class="hljs-number">0X3B</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0XB9</span>, <span class="hljs-number">0X56</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0XDA</span>,<br><span class="hljs-number">0X9F</span>, <span class="hljs-number">0X62</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X49</span>, <span class="hljs-number">0X3A</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0XEB</span>, <span class="hljs-number">0XEE</span>, <span class="hljs-number">0XF4</span>, <span class="hljs-number">0X4E</span>, <span class="hljs-number">0XFC</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0X9D</span>,<br>&#125;;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Q[] = &#123;<br><span class="hljs-number">0XC7</span>, <span class="hljs-number">0X47</span>, <span class="hljs-number">0X6F</span>, <span class="hljs-number">0X27</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0X01</span>, <span class="hljs-number">0XDC</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0X3A</span>, <span class="hljs-number">0XEE</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0X80</span>, <span class="hljs-number">0X80</span>, <span class="hljs-number">0XB4</span>, <span class="hljs-number">0X5A</span>,<br><span class="hljs-number">0X0A</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0X78</span>, <span class="hljs-number">0X71</span>, <span class="hljs-number">0X1B</span>, <span class="hljs-number">0X3B</span>, <span class="hljs-number">0X19</span>, <span class="hljs-number">0X8E</span>, <span class="hljs-number">0X72</span>, <span class="hljs-number">0X0D</span>, <span class="hljs-number">0XE4</span>, <span class="hljs-number">0XBD</span>, <span class="hljs-number">0X92</span>, <span class="hljs-number">0X89</span>, <span class="hljs-number">0XCB</span>, <span class="hljs-number">0X3F</span>,<br><span class="hljs-number">0XD4</span>, <span class="hljs-number">0X18</span>, <span class="hljs-number">0XCA</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0X57</span>, <span class="hljs-number">0X43</span>, <span class="hljs-number">0XFE</span>, <span class="hljs-number">0XD7</span>, <span class="hljs-number">0X46</span>, <span class="hljs-number">0X90</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0XA9</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X54</span>, <span class="hljs-number">0X1D</span>, <span class="hljs-number">0X69</span>,<br><span class="hljs-number">0XFE</span>, <span class="hljs-number">0X8A</span>, <span class="hljs-number">0X05</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0XE7</span>, <span class="hljs-number">0XB2</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0X38</span>, <span class="hljs-number">0XC0</span>, <span class="hljs-number">0XEC</span>, <span class="hljs-number">0X88</span>, <span class="hljs-number">0XC6</span>, <span class="hljs-number">0X93</span>, <span class="hljs-number">0X6D</span>, <span class="hljs-number">0X95</span>,<br><span class="hljs-number">0X43</span>, <span class="hljs-number">0XEE</span>, <span class="hljs-number">0XA9</span>, <span class="hljs-number">0XA0</span>, <span class="hljs-number">0X0F</span>, <span class="hljs-number">0X63</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0X50</span>, <span class="hljs-number">0X47</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0X92</span>, <span class="hljs-number">0XF6</span>, <span class="hljs-number">0XDD</span>, <span class="hljs-number">0XFA</span>, <span class="hljs-number">0XF5</span>,<br><span class="hljs-number">0X9A</span>, <span class="hljs-number">0X12</span>, <span class="hljs-number">0XDC</span>, <span class="hljs-number">0XFD</span>, <span class="hljs-number">0XFE</span>, <span class="hljs-number">0XAC</span>, <span class="hljs-number">0X2D</span>, <span class="hljs-number">0X60</span>, <span class="hljs-number">0X8B</span>, <span class="hljs-number">0X22</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0XA4</span>, <span class="hljs-number">0X7C</span>, <span class="hljs-number">0XA9</span>, <span class="hljs-number">0XE6</span>, <span class="hljs-number">0X23</span>,<br><span class="hljs-number">0X7C</span>, <span class="hljs-number">0X0C</span>, <span class="hljs-number">0X8C</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X48</span>, <span class="hljs-number">0X90</span>, <span class="hljs-number">0X31</span>, <span class="hljs-number">0XCD</span>, <span class="hljs-number">0XAE</span>, <span class="hljs-number">0X7A</span>, <span class="hljs-number">0XA0</span>, <span class="hljs-number">0X4D</span>, <span class="hljs-number">0X26</span>, <span class="hljs-number">0X78</span>, <span class="hljs-number">0XC5</span>, <span class="hljs-number">0X38</span>,<br><span class="hljs-number">0XBE</span>, <span class="hljs-number">0XE0</span>, <span class="hljs-number">0X09</span>, <span class="hljs-number">0X1D</span>, <span class="hljs-number">0X34</span>, <span class="hljs-number">0XA7</span>, <span class="hljs-number">0X82</span>, <span class="hljs-number">0XB3</span>, <span class="hljs-number">0XC2</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0X10</span>, <span class="hljs-number">0X50</span>, <span class="hljs-number">0X19</span>, <span class="hljs-number">0X55</span>, <span class="hljs-number">0X81</span>, <span class="hljs-number">0XB5</span>,<br><span class="hljs-number">0X08</span>, <span class="hljs-number">0XC9</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0X96</span>, <span class="hljs-number">0XA3</span>, <span class="hljs-number">0XD0</span>, <span class="hljs-number">0XA9</span>, <span class="hljs-number">0X50</span>, <span class="hljs-number">0X92</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X83</span>, <span class="hljs-number">0XC7</span>, <span class="hljs-number">0X3C</span>, <span class="hljs-number">0X2E</span>, <span class="hljs-number">0XC1</span>, <span class="hljs-number">0XC5</span>,<br><span class="hljs-number">0XB3</span>, <span class="hljs-number">0X4C</span>, <span class="hljs-number">0XDF</span>, <span class="hljs-number">0X4F</span>, <span class="hljs-number">0X68</span>, <span class="hljs-number">0XEB</span>, <span class="hljs-number">0X7C</span>, <span class="hljs-number">0XD4</span>, <span class="hljs-number">0X46</span>, <span class="hljs-number">0X14</span>, <span class="hljs-number">0X45</span>, <span class="hljs-number">0X1D</span>, <span class="hljs-number">0X2F</span>, <span class="hljs-number">0XF7</span>, <span class="hljs-number">0XFE</span>, <span class="hljs-number">0XEA</span>,<br><span class="hljs-number">0XAA</span>, <span class="hljs-number">0X5D</span>, <span class="hljs-number">0X77</span>, <span class="hljs-number">0X9F</span>, <span class="hljs-number">0X6E</span>, <span class="hljs-number">0X7C</span>, <span class="hljs-number">0XE5</span>, <span class="hljs-number">0X5B</span>, <span class="hljs-number">0X67</span>, <span class="hljs-number">0X2F</span>, <span class="hljs-number">0XAA</span>, <span class="hljs-number">0X29</span>, <span class="hljs-number">0X2A</span>, <span class="hljs-number">0XD9</span>, <span class="hljs-number">0X33</span>, <span class="hljs-number">0X5E</span>,<br><span class="hljs-number">0X5A</span>, <span class="hljs-number">0XAF</span>, <span class="hljs-number">0XFA</span>, <span class="hljs-number">0X4B</span>, <span class="hljs-number">0X06</span>, <span class="hljs-number">0XDA</span>, <span class="hljs-number">0XE5</span>, <span class="hljs-number">0XB6</span>, <span class="hljs-number">0XF0</span>, <span class="hljs-number">0XCE</span>, <span class="hljs-number">0XDE</span>, <span class="hljs-number">0X95</span>, <span class="hljs-number">0X1A</span>, <span class="hljs-number">0X9B</span>, <span class="hljs-number">0X1A</span>, <span class="hljs-number">0X6D</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><p>我们将<code>(E, N)</code>组成的公钥提供给客户端, 自己保存<code>(D, N)</code>组成的私钥。</p><h5 id="加解密"><a class="markdownIt-Anchor" href="#加解密"></a> 加解密</h5><p>如下是加解密步骤:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CHIPHER_LEN 3072</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_N_LEN MAX_CHIPHER_LEN/8</span><br><br>mbedtls_rsa_context ctx;<br>mbedtls_ctr_drbg_context ctrl_drbg;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 要加密的明文</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ciphertext[MAX_CHIPHER_LEN / <span class="hljs-number">8</span>];     <span class="hljs-comment">// 要加密的明文</span><br><br><span class="hljs-type">size_t</span> plaintext_len = <span class="hljs-built_in">strlen</span>((<span class="hljs-type">char</span> *)plaintext);<br><br><span class="hljs-built_in">memset</span>(ciphertext, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(ciphertext));<br>mbedtls_rsa_init(&amp;ctx);<br>mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br><span class="hljs-comment">//mbedtls_rsa_set_padding(&amp;ctx, MBEDTLS_RSA_PKCS_V21, MBEDTLS_MD_MD5);</span><br><span class="hljs-comment">// 导入公钥</span><br><span class="hljs-type">int</span> ret = mbedtls_rsa_import_raw(&amp;ctx, NN, <span class="hljs-keyword">sizeof</span>(NN), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, EE, <span class="hljs-keyword">sizeof</span>(EE));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa PUB import ret:%d \r\n&quot;</span>,  ret);<br>ret = mbedtls_rsa_complete(&amp;ctx); <span class="hljs-comment">//密钥导入后必须调用mbedtls_rsa_complete</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;complete %d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_rsa_check_pubkey(&amp;ctx); <span class="hljs-comment">//检查是否包含公钥</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pubkey check %d\r\n&quot;</span>, ret);<br><br><span class="hljs-comment">// 使用公钥加密明文</span><br>ret = mbedtls_rsa_pkcs1_encrypt(&amp;ctx, mbedtls_ctr_drbg_random, &amp;ctrl_drbg, plaintext_len, plaintext, ciphertext);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa encrypt ret:%d %d\r\n&quot;</span>,  ret, <span class="hljs-built_in">strlen</span>(ciphertext));<br>mbedtls_rsa_free(&amp;ctx);<br><br><span class="hljs-comment">// 解密动作</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> decrypted[MAX_CHIPHER_LEN / <span class="hljs-number">8</span>];<br><span class="hljs-type">size_t</span> decrypted_len;<br>mbedtls_rsa_init(&amp;ctx);<br><span class="hljs-comment">//导入解密私钥</span><br>ret = mbedtls_rsa_import_raw(&amp;ctx, NN, <span class="hljs-keyword">sizeof</span>(NN), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, DD, <span class="hljs-keyword">sizeof</span>(DD), EE, <span class="hljs-keyword">sizeof</span>(EE));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa PRIV import ret:%d \r\n&quot;</span>,  ret);<br><br>ret = mbedtls_rsa_complete(&amp;ctx);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;complete %d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_rsa_check_pubkey(&amp;ctx); <span class="hljs-comment">//检查是否包含公钥</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pubkey check %d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_rsa_check_privkey(&amp;ctx);<span class="hljs-comment">//检查是否包含私钥</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;prvikey check %d\r\n&quot;</span>, ret);<br><br><span class="hljs-comment">// 使用私钥解密密文</span><br>ret = mbedtls_rsa_pkcs1_decrypt(&amp;ctx, mbedtls_ctr_drbg_random, &amp;ctrl_drbg, &amp;decrypted_len, ciphertext, decrypted, <span class="hljs-keyword">sizeof</span>(decrypted));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa decrypt ret:%d %s:%u\r\n&quot;</span>,  ret, decrypted, decrypted_len);<br><br>mbedtls_rsa_free(&amp;ctx);<br>mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br></code></pre></td></tr></table></figure><p>上述的案例中, 默认使用<code>PKCS#1 V1.5</code>版本填充, 可以手动选择<code>PKCS#1 V2.1</code>版本的<code>OAEP</code>填充, 接口如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">mbedtls_rsa_set_padding(&amp;ctx, MBEDTLS_RSA_PKCS_V21, MBEDTLS_MD_MD5);<br></code></pre></td></tr></table></figure><p>注意如果设置填充以后, 加解密都需要设置<code>OAEP</code>填充. 同时需要开启宏</p><ul><li><code>MBEDTLS_PKCS1_V21</code></li><li><code>MBEDTLS_MD_CAN_MD5</code></li><li><code>MBEDTLS_MD5_C</code></li></ul><p>注意:</p><ul><li><code>RSA</code>加密, 每次加密的输出是固定长度输出, 和密钥长度相等。但是由于明文填充的缘故, 每次加密的明文少于密钥长度。<ul><li><code>pkcs#1 v1.5</code> 加密内容为密钥长度-3</li><li><code>pkcs#1 v2.1</code> 加密内容为密钥长度-摘要长度*2-2</li></ul></li></ul><p>如下: 采用<code>md5</code>做摘要, 摘要长度为<code>16</code>, 则<code>3072bits</code>密钥最长单次加密内容为: <code>3072/8 - 16*2 -2 = 340Byte</code></p><p>测试<code>100000</code>个数据加密和解密时间</p><table><thead><tr><th style="text-align:center">加密时间</th><th style="text-align:center">解密时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>0.915s</code></td><td style="text-align:center"><code>421.105s</code></td></tr></tbody></table><p>可见, 非对称加密算法的加密效率是很低的, 对称加密的数据量是非对称的<code>9000</code>倍, 但加解密时间消耗只需要<code>11s</code>左右。</p><p>主要涉及接口有:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">mbedtls_rsa_init</span><span class="hljs-params">(mbedtls_rsa_context *ctx)</span> <span class="hljs-comment">//模块初始化</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_set_padding</span><span class="hljs-params">(mbedtls_rsa_context *ctx, <span class="hljs-type">int</span> padding,</span><br><span class="hljs-params">                            <span class="hljs-type">mbedtls_md_type_t</span> hash_id)</span><span class="hljs-comment">//RSA填充</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_get_padding_mode</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//获取填充模式</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_get_md_alg</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//获取填充摘要算法</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_import</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                       <span class="hljs-type">const</span> mbedtls_mpi *N,</span><br><span class="hljs-params">                       <span class="hljs-type">const</span> mbedtls_mpi *P, <span class="hljs-type">const</span> mbedtls_mpi *Q,</span><br><span class="hljs-params">                       <span class="hljs-type">const</span> mbedtls_mpi *D, <span class="hljs-type">const</span> mbedtls_mpi *E)</span>;<span class="hljs-comment">//导入密钥</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_import_raw</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">const</span> *N, <span class="hljs-type">size_t</span> N_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">const</span> *P, <span class="hljs-type">size_t</span> P_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">const</span> *Q, <span class="hljs-type">size_t</span> Q_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">const</span> *D, <span class="hljs-type">size_t</span> D_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-type">const</span> *E, <span class="hljs-type">size_t</span> E_len)</span>;<span class="hljs-comment">//导出密钥</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_complete</span><span class="hljs-params">(mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//导入密钥完成</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_export</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                       mbedtls_mpi *N, mbedtls_mpi *P, mbedtls_mpi *Q,</span><br><span class="hljs-params">                       mbedtls_mpi *D, mbedtls_mpi *E)</span>;<span class="hljs-comment">//密钥导出</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_export_raw</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *N, <span class="hljs-type">size_t</span> N_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *P, <span class="hljs-type">size_t</span> P_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *Q, <span class="hljs-type">size_t</span> Q_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *D, <span class="hljs-type">size_t</span> D_len,</span><br><span class="hljs-params">                           <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *E, <span class="hljs-type">size_t</span> E_len)</span>;<span class="hljs-comment">//密钥导出</span><br><span class="hljs-type">size_t</span> <span class="hljs-title function_">mbedtls_rsa_get_len</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//获取密钥长度</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_gen_key</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                        <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                        <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> nbits, <span class="hljs-type">int</span> exponent)</span>;<span class="hljs-comment">//产生密钥对</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_check_pubkey</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//检查公钥</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_check_privkey</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *ctx)</span>;<span class="hljs-comment">//检查私钥</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_check_pub_priv</span><span class="hljs-params">(<span class="hljs-type">const</span> mbedtls_rsa_context *pub,</span><br><span class="hljs-params">                               <span class="hljs-type">const</span> mbedtls_rsa_context *prv)</span>;<span class="hljs-comment">//检查公钥和私钥是否匹配</span><br></code></pre></td></tr></table></figure><p>加解密:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_public</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                       <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                       <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_private</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                        <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                        <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                        <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_pkcs1_encrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                              <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                              <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                              <span class="hljs-type">size_t</span> ilen,</span><br><span class="hljs-params">                              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output)</span>; <span class="hljs-comment">//通用加密接口</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_rsaes_pkcs1_v15_encrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                                        <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                                        <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                                        <span class="hljs-type">size_t</span> ilen,</span><br><span class="hljs-params">                                        <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                                        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_rsaes_oaep_encrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                                   <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                                   <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                                   <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *label, <span class="hljs-type">size_t</span> label_len,</span><br><span class="hljs-params">                                   <span class="hljs-type">size_t</span> ilen,</span><br><span class="hljs-params">                                   <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                                   <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_pkcs1_decrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                              <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                              <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                              <span class="hljs-type">size_t</span> *olen,</span><br><span class="hljs-params">                              <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output,</span><br><span class="hljs-params">                              <span class="hljs-type">size_t</span> output_max_len)</span>;<span class="hljs-comment">////通用解密接口</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_rsaes_pkcs1_v15_decrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                                        <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                                        <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                                        <span class="hljs-type">size_t</span> *olen,</span><br><span class="hljs-params">                                        <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                                        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output,</span><br><span class="hljs-params">                                        <span class="hljs-type">size_t</span> output_max_len)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">mbedtls_rsa_rsaes_oaep_decrypt</span><span class="hljs-params">(mbedtls_rsa_context *ctx,</span><br><span class="hljs-params">                                   <span class="hljs-type">int</span> (*f_rng)(<span class="hljs-type">void</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">size_t</span>),</span><br><span class="hljs-params">                                   <span class="hljs-type">void</span> *p_rng,</span><br><span class="hljs-params">                                   <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *label, <span class="hljs-type">size_t</span> label_len,</span><br><span class="hljs-params">                                   <span class="hljs-type">size_t</span> *olen,</span><br><span class="hljs-params">                                   <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input,</span><br><span class="hljs-params">                                   <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output,</span><br><span class="hljs-params">                                   <span class="hljs-type">size_t</span> output_max_len)</span>;<br></code></pre></td></tr></table></figure><hr><h5 id="数字签名和验签"><a class="markdownIt-Anchor" href="#数字签名和验签"></a> 数字签名和验签</h5><p>  <code>RSA</code>除了用于交换密钥, 也广泛用于身份认证(数字证书)。和加密类似, <code>PKCS#1 V1.5</code>存在风险, <code>PKCS#1 V2.1</code>引入<code>PSS</code>填充。需要开启的宏有:</p><ul><li><code>MBEDTLS_RSA_C</code></li><li><code>MBEDTLS_OID_C</code></li><li><code>MBEDTLS_BIGNUM_C</code></li></ul><p>是否开启<code>PSS</code>机制, 开启宏:</p><ul><li><code>MBEDTLS_PKCS1_V21</code> | <code>MBEDTLS_PKCS1_V15</code></li><li><code>MBEDTLS_MD_CAN_MD5</code></li><li><code>MBEDTLS_MD5_C</code></li></ul><p><strong>私钥签名</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">rsa_sign_priv</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *out)</span><br>&#123;<br>    mbedtls_rsa_context ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 要加密的明文</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> sign[MAX_CHIPHER_LEN / <span class="hljs-number">8</span>];     <span class="hljs-comment">// 签名内容</span><br>    <span class="hljs-type">size_t</span> plaintext_len = <span class="hljs-keyword">sizeof</span>(plaintext);<br><br>    mbedtls_rsa_init(&amp;ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br>     <span class="hljs-type">int</span> ret = mbedtls_rsa_set_padding(&amp;ctx, MBEDTLS_RSA_PKCS_V21, MBEDTLS_MD_MD5);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;set pading %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_import_raw(&amp;ctx, NN, <span class="hljs-keyword">sizeof</span>(NN), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, DD, <span class="hljs-keyword">sizeof</span>(DD), EE, <span class="hljs-keyword">sizeof</span>(EE));<span class="hljs-comment">//导入私钥</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa PUB import ret:%d modBit:%u\r\n&quot;</span>,  ret, mbedtls_rsa_get_len(&amp;ctx));<br>    ret = mbedtls_rsa_complete(&amp;ctx); <span class="hljs-comment">//密钥导入后必须调用mbedtls_rsa_complete</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;complete %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_check_privkey(&amp;ctx); <span class="hljs-comment">//检查是否包含公钥</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pubkey check %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_pkcs1_sign(&amp;ctx, mbedtls_ctr_drbg_random, &amp;ctrl_drbg, MBEDTLS_MD_MD5, plaintext_len, plaintext, sign); <span class="hljs-comment">//对plaintext进行签名, plaintext_len必须和MBEDTLS_MD_MD5摘要长度相等</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d \r\n&quot;</span>, ret);<br><br>    show_message(<span class="hljs-string">&quot;sign:\r\n&quot;</span>, sign, <span class="hljs-keyword">sizeof</span>(sign));<br>    mbedtls_rsa_free(&amp;ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br><br>    <span class="hljs-built_in">memcpy</span>(out, sign, <span class="hljs-keyword">sizeof</span>(sign));<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>公钥验签</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">rsa_sign_pub</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *sign)</span><br>&#123;<br>    mbedtls_rsa_context ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;Hello, World!&quot;</span>;     <span class="hljs-comment">// 原消息的摘要</span><br>    <span class="hljs-type">size_t</span> plaintext_len = <span class="hljs-keyword">sizeof</span>(plaintext);<br><br>    mbedtls_rsa_init(&amp;ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br>    <span class="hljs-type">int</span> ret = mbedtls_rsa_set_padding(&amp;ctx, MBEDTLS_RSA_PKCS_V21, MBEDTLS_MD_MD5);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;set pading %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_import_raw(&amp;ctx, NN, <span class="hljs-keyword">sizeof</span>(NN), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, EE, <span class="hljs-keyword">sizeof</span>(EE)); <span class="hljs-comment">//导入公钥</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;rsa PUB import ret:%d modBit:%u\r\n&quot;</span>,  ret, mbedtls_rsa_get_len(&amp;ctx));<br>    ret = mbedtls_rsa_complete(&amp;ctx); <span class="hljs-comment">//密钥导入后必须调用mbedtls_rsa_complete</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;complete %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_check_pubkey(&amp;ctx); <span class="hljs-comment">//检查是否包含公钥</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pubkey check %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_rsa_pkcs1_verify(&amp;ctx, MBEDTLS_MD_MD5, plaintext_len, plaintext, sign); <span class="hljs-comment">//公钥对消息进行验签</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sign result ret:%d \r\n&quot;</span>, ret);<br><br>    mbedtls_rsa_free(&amp;ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="dh密钥交互"><a class="markdownIt-Anchor" href="#dh密钥交互"></a> DH密钥交互</h4><p>需要开启的宏有:</p><ul><li><code>MBEDTLS_PEM_PARSE_C</code></li><li><code>MBEDTLS_DHM_C</code></li></ul><p>如下模拟服务端和客户端密钥交互:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> dhm_para[]  = &#123;<br><span class="hljs-string">&quot;-----BEGIN DH PARAMETERS-----\n\</span><br><span class="hljs-string">MIIBCAKCAQEAxO323LJ8bSJfCZxIPATzufW+e6zNQD/+J8NW+IlHd30OHweePy3c\</span><br><span class="hljs-string">PbZVccGtBYP4ogyfd33F83y9dqRop+zcTpYpr26B7RrImwxcMDvgSwaVpwBylUzJ\</span><br><span class="hljs-string">STc4KBWVARLwStVl6YliKxP+rz5XWkABjKpgD1bTCzaKmJAyLCXG6AAuHGjQ17Vn\</span><br><span class="hljs-string">QFiRrkPG2KZN5d25cjp1CPYrKwX4qKvDisyM/UY7M1MRc5hZSauToGJcZKkjPNGw\</span><br><span class="hljs-string">2t1RGaY6cOCos2D/lUAwEcWSnaIObTyd6YRp+KtTZ3SksfO09zp2WBtr9DRQad2x\</span><br><span class="hljs-string">nxnujIfhF/p2RxyCFRfKRogDRFYngnc9QwIBAg==\</span><br><span class="hljs-string">-----END DH PARAMETERS-----\n&quot;</span><br>&#125;;<br><br>    mbedtls_dhm_context client_ctx;<br>    mbedtls_dhm_context server_ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> server_key[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> client_key[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">size_t</span> server_key_size;<br>    <span class="hljs-type">size_t</span> client_key_size;<br><br>    <span class="hljs-built_in">memset</span>(server_key, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(server_key));<br>    <span class="hljs-built_in">memset</span>(client_key, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(client_key));<br><br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    <span class="hljs-comment">//for server</span><br>    mbedtls_dhm_init(&amp;server_ctx);<br>    <span class="hljs-type">int</span> ret = mbedtls_dhm_parse_dhm(&amp;server_ctx, dhm_para, <span class="hljs-keyword">sizeof</span>(dhm_para));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out_server_public[<span class="hljs-number">256</span>];<br>    ret = mbedtls_dhm_make_public(&amp;server_ctx, <span class="hljs-number">256</span>, out_server_public, <span class="hljs-keyword">sizeof</span>(out_server_public), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//for client</span><br>    mbedtls_dhm_init(&amp;client_ctx);<br>    ret = mbedtls_dhm_parse_dhm(&amp;client_ctx, dhm_para, <span class="hljs-keyword">sizeof</span>(dhm_para));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out_client_public[<span class="hljs-number">256</span>];<br>    ret = mbedtls_dhm_make_public(&amp;client_ctx, <span class="hljs-number">256</span>, out_client_public, <span class="hljs-keyword">sizeof</span>(out_client_public), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//计算共享密钥</span><br>    <span class="hljs-comment">//for server</span><br>    ret = mbedtls_dhm_read_public(&amp;server_ctx, out_client_public, <span class="hljs-keyword">sizeof</span>(out_client_public));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server read public: %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_dhm_calc_secret(&amp;server_ctx, server_key, <span class="hljs-keyword">sizeof</span>(server_key), &amp;server_key_size, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;calc server key:%d size:%d\r\n&quot;</span>, ret, server_key_size);<br><br>    show_message(<span class="hljs-string">&quot;server key:\r\n&quot;</span>, server_key, server_key_size);<br><br>    <span class="hljs-comment">//for client</span><br>    ret = mbedtls_dhm_read_public(&amp;client_ctx, out_server_public, <span class="hljs-keyword">sizeof</span>(out_server_public));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client read public: %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_dhm_calc_secret(&amp;client_ctx, client_key, <span class="hljs-keyword">sizeof</span>(client_key), &amp;client_key_size, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;calc client key:%d size:%d\r\n&quot;</span>, ret, client_key_size);<br><br>    show_message(<span class="hljs-string">&quot;client key:\r\n&quot;</span>, client_key, client_key_size);<br><br>    <span class="hljs-type">int</span> is_equal = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (client_key_size != server_key_size || <span class="hljs-built_in">memcmp</span>(client_key, server_key, client_key_size) != <span class="hljs-number">0</span>)<br>    &#123;<br>    	is_equal = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server/client key %s\r\n&quot;</span>, is_equal ? <span class="hljs-string">&quot;EQUAL&quot;</span> : <span class="hljs-string">&quot;NOT EQUAL&quot;</span>);<br><br>    mbedtls_dhm_free(&amp;server_ctx);<br>    mbedtls_dhm_free(&amp;client_ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br></code></pre></td></tr></table></figure><p>由于<code>DH</code>算法的<code>G</code>和<code>P</code>是固定参数, 因此可以设置默认值:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">dhm_chipher_exchange_set_default_test</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_dhm_context client_ctx;<br>    mbedtls_dhm_context server_ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> server_key[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> client_key[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">size_t</span> server_key_size;<br>    <span class="hljs-type">size_t</span> client_key_size;<br><br>    <span class="hljs-built_in">memset</span>(server_key, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(server_key));<br>    <span class="hljs-built_in">memset</span>(client_key, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(client_key));<br><br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    mbedtls_mpi G, P;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> g_buff[] = MBEDTLS_DHM_RFC3526_MODP_2048_G_BIN;<span class="hljs-comment">//设置默认的`G/P`</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> p_buff[] = MBEDTLS_DHM_RFC3526_MODP_2048_P_BIN;<br>    <span class="hljs-type">int</span> ret = mbedtls_mpi_read_binary(&amp;G,  g_buff, <span class="hljs-keyword">sizeof</span>(g_buff));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;get G ret: %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_mpi_read_binary(&amp;P,  p_buff, <span class="hljs-keyword">sizeof</span>(p_buff));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;get P ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//for server</span><br>    mbedtls_dhm_init(&amp;server_ctx);<br><br>    ret = mbedtls_dhm_set_group(&amp;server_ctx, &amp;P, &amp;G);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;set server key: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out_server_public[<span class="hljs-number">256</span>];<br>    ret = mbedtls_dhm_make_public(&amp;server_ctx, <span class="hljs-number">256</span>, out_server_public, <span class="hljs-keyword">sizeof</span>(out_server_public), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server ret: %d\r\n&quot;</span>, ret);<br><br><br>    <span class="hljs-comment">//for client</span><br>    mbedtls_dhm_init(&amp;client_ctx);<br>    ret = mbedtls_dhm_set_group(&amp;client_ctx, &amp;P, &amp;G);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;set client key: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out_client_public[<span class="hljs-number">256</span>];<br>    ret = mbedtls_dhm_make_public(&amp;client_ctx, <span class="hljs-number">256</span>, out_client_public, <span class="hljs-keyword">sizeof</span>(out_client_public), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client ret: %d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//计算共享密钥</span><br>    <span class="hljs-comment">//for server</span><br>    ret = mbedtls_dhm_read_public(&amp;server_ctx, out_client_public, <span class="hljs-keyword">sizeof</span>(out_client_public));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server read public: %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_dhm_calc_secret(&amp;server_ctx, server_key, <span class="hljs-keyword">sizeof</span>(server_key), &amp;server_key_size, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;calc server key:%d size:%d\r\n&quot;</span>, ret, server_key_size);<br><br>    show_message(<span class="hljs-string">&quot;server key:\r\n&quot;</span>, server_key, server_key_size);<br><br>    <span class="hljs-comment">//for client</span><br>    ret = mbedtls_dhm_read_public(&amp;client_ctx, out_server_public, <span class="hljs-keyword">sizeof</span>(out_server_public));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client read public: %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_dhm_calc_secret(&amp;client_ctx, client_key, <span class="hljs-keyword">sizeof</span>(client_key), &amp;client_key_size, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;calc client key:%d size:%d\r\n&quot;</span>, ret, client_key_size);<br><br>    show_message(<span class="hljs-string">&quot;client key:\r\n&quot;</span>, client_key, client_key_size);<br><br>    <span class="hljs-type">int</span> is_equal = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (client_key_size != server_key_size || <span class="hljs-built_in">memcmp</span>(client_key, server_key, client_key_size) != <span class="hljs-number">0</span>)<br>    &#123;<br>    	is_equal = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server/client key %s\r\n&quot;</span>, is_equal ? <span class="hljs-string">&quot;EQUAL&quot;</span> : <span class="hljs-string">&quot;NOT EQUAL&quot;</span>);<br><br>    mbedtls_dhm_free(&amp;server_ctx);<br>    mbedtls_dhm_free(&amp;client_ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="ecc加密"><a class="markdownIt-Anchor" href="#ecc加密"></a> ECC加密</h4><p>  <code>ECC</code>全称(<code>Elliptic Curve Cryptography</code>), 是一种基于椭圆曲线数学的公开密钥加密算法, 相对于<code>RSA</code>加密, 其相同加密强度下密钥更短(<code>160b</code>椭圆曲线相当于<code>RSA</code> <code>2048b</code>), 加解密速度快等优点。</p><h5 id="ecdh密钥交换"><a class="markdownIt-Anchor" href="#ecdh密钥交换"></a> ECDH密钥交换</h5><p>需要开启的宏有:</p><ul><li><code>MBEDTLS_ECDH_C</code></li><li><code>MBEDTLS_ECP_C</code></li><li><code>MBEDTLS_ECP_DP_SECP256K1_ENABLED</code></li></ul><p>测试代码如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">ecdh_key_exchange_test</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_ecdh_context server_ctx;<br>    mbedtls_ecdh_context client_ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br><br>    <span class="hljs-type">size_t</span> client_key_pair_len;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> client_key_pair_key[<span class="hljs-number">100</span>];<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *pclient_key_pair = client_key_pair_key;<br><br>    <span class="hljs-type">size_t</span> server_share_key_len;<br>    <span class="hljs-type">size_t</span> client_share_key_len;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> server_share_key[<span class="hljs-number">1000</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> client_share_key[<span class="hljs-number">1000</span>];<br><br>    <span class="hljs-type">size_t</span> server_public_len;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> server_public_key[<span class="hljs-number">500</span>];<br><br><br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    <span class="hljs-comment">//for client gen key-pair</span><br>    mbedtls_ecdh_init(&amp;client_ctx);<br><br>    <span class="hljs-type">int</span> ret = mbedtls_ecdh_setup(&amp;client_ctx, MBEDTLS_ECP_DP_SECP256K1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;setup %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_ecdh_make_params(&amp;client_ctx, &amp;client_key_pair_len, client_key_pair_key, <span class="hljs-keyword">sizeof</span>(client_key_pair_key), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;make client ecdh para:%d outlen:%d\r\n&quot;</span>, ret, client_key_pair_len);<br><br>    <span class="hljs-comment">//for server import client key-pair</span><br>    mbedtls_ecdh_init(&amp;server_ctx);<br><br>    ret = mbedtls_ecdh_setup(&amp;server_ctx, MBEDTLS_ECP_DP_SECP256K1);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;setup %d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_ecdh_read_params(&amp;server_ctx, &amp;pclient_key_pair, &amp;pclient_key_pair[client_key_pair_len]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server import client public key:%d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_ecdh_make_public(&amp;server_ctx, &amp;server_public_len, server_public_key, <span class="hljs-keyword">sizeof</span>(server_public_key), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;make server ecdh public:%d outlen:%d\r\n&quot;</span>, ret, server_public_len);<br><br>    <span class="hljs-comment">//for client import server public share key</span><br>    ret = mbedtls_ecdh_read_public(&amp;client_ctx, server_public_key, server_public_len);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;client import server public key:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//calc key</span><br>    <span class="hljs-comment">//for server</span><br>    ret = mbedtls_ecdh_calc_secret(&amp;server_ctx, &amp;server_share_key_len, server_share_key, <span class="hljs-keyword">sizeof</span>(server_share_key), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server share key calc:%d len:%d\r\n&quot;</span>, ret, server_share_key_len);<br><br>    <span class="hljs-comment">//for client</span><br>    ret = mbedtls_ecdh_calc_secret(&amp;client_ctx, &amp;client_share_key_len, client_share_key, <span class="hljs-keyword">sizeof</span>(client_share_key), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server share key calc:%d len:%d\r\n&quot;</span>, ret, client_share_key_len);<br><br>    <span class="hljs-type">int</span> is_equal = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (client_share_key_len != server_share_key_len || <span class="hljs-built_in">memcmp</span>(client_share_key, server_share_key, server_share_key_len) != <span class="hljs-number">0</span>)<br>    &#123;<br>    	is_equal = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;server/client key %s\r\n&quot;</span>, is_equal ? <span class="hljs-string">&quot;EQUAL&quot;</span> : <span class="hljs-string">&quot;NOT EQUAL&quot;</span>);<br><br>    mbedtls_ecdh_free(&amp;server_ctx);<br>    mbedtls_ecdh_free(&amp;client_ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h5 id="ecdsa签名"><a class="markdownIt-Anchor" href="#ecdsa签名"></a> ECDSA签名</h5><p>需要开启的宏有:</p><ul><li><code>MBEDTLS_ECDSA_C</code></li><li><code>MBEDTLS_ECP_DP_SECP521R1_ENABLED</code></li><li><code>MBEDTLS_ASN1_WRITE_C</code></li></ul><p><strong>方法1</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">ecdsa_key_sign_and_verify</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_ecdsa_context ecdsa_ctx;<br>    mbedtls_ecdsa_context ecdsa_dec_ctx;<br><br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    mbedtls_mpi r, s;<br><br>    mbedtls_ecdsa_init(&amp;ecdsa_ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    <span class="hljs-type">int</span> ret = mbedtls_ecdsa_genkey(&amp;ecdsa_ctx, MBEDTLS_ECP_DP_SECP521R1, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;gen key:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> message[] = &#123;<span class="hljs-string">&quot;helloworld&quot;</span>&#125;;<br><br>    <span class="hljs-comment">//sign</span><br>    mbedtls_mpi_init(&amp;r);<br>    mbedtls_mpi_init(&amp;s);<br>    ret = mbedtls_ecdsa_sign(&amp;ecdsa_ctx.private_grp, &amp;r, &amp;s, &amp;ecdsa_ctx.private_d, message, <span class="hljs-keyword">sizeof</span>(message), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ecdsa sign:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-comment">//verfy</span><br>    ecdsa_dec_ctx.private_grp = ecdsa_ctx.private_grp;<br>    ecdsa_dec_ctx.private_Q = ecdsa_ctx.private_Q;<br>    ret = mbedtls_ecdsa_verify(&amp;ecdsa_dec_ctx.private_grp, message, <span class="hljs-keyword">sizeof</span>(message), &amp;ecdsa_dec_ctx.private_Q, &amp;r, &amp;s);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ecdsa verify:%d\r\n&quot;</span>, ret);<br><br>    mbedtls_ecdsa_free(&amp;ecdsa_ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>方法2</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">ecdsa_key_sign_and_verify2</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_ecdsa_context ecdsa_ctx;<br>    mbedtls_ecdsa_context ecdsa_dec_ctx;<br><br>    mbedtls_ctr_drbg_context ctrl_drbg;<br><br>    mbedtls_ecdsa_init(&amp;ecdsa_ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    <span class="hljs-type">int</span> ret = mbedtls_ecdsa_genkey(&amp;ecdsa_ctx, MBEDTLS_ECP_DP_SECP521R1, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;gen key:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> hash[] = &#123;<span class="hljs-string">&quot;helloworld&quot;</span>&#125;;<br><br>    <span class="hljs-comment">//sign</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out_sig[<span class="hljs-number">1000</span>] = &#123;<span class="hljs-number">0</span>,<span class="hljs-number">0</span> &#125;;<br>    <span class="hljs-type">size_t</span> out_sig_len;<br>    <span class="hljs-built_in">memset</span>(out_sig, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>((out_sig)));<br>    ret = mbedtls_ecdsa_write_signature(&amp;ecdsa_ctx, MBEDTLS_MD_MD5, hash, <span class="hljs-keyword">sizeof</span>(hash), out_sig, <span class="hljs-keyword">sizeof</span>(out_sig), &amp;out_sig_len, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ecdsa sign2:%d len:%d\r\n&quot;</span>, ret, out_sig_len);<br><br>    <span class="hljs-comment">//verfy</span><br>    <span class="hljs-type">const</span> mbedtls_ecp_keypair keypair = &#123;<br>    	.private_grp = ecdsa_ctx.private_grp,<br>    	.private_Q = ecdsa_ctx.private_Q,<br>    &#125;;<br><br>    mbedtls_ecdsa_init(&amp;ecdsa_dec_ctx);<br>    ret = mbedtls_ecdsa_from_keypair(&amp;ecdsa_dec_ctx, &amp;keypair);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ecdsa import key:%d\r\n&quot;</span>, ret);<br><br>    ret = mbedtls_ecdsa_read_signature(&amp;ecdsa_dec_ctx, hash, <span class="hljs-keyword">sizeof</span>(hash), out_sig, out_sig_len);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ecdsa verify2:%d\r\n&quot;</span>, ret);<br><br>    mbedtls_ecdsa_free(&amp;ecdsa_ctx);<br>    mbedtls_ecdsa_free(&amp;ecdsa_dec_ctx);<br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="非对称抽象层"><a class="markdownIt-Anchor" href="#非对称抽象层"></a> 非对称抽象层</h3><p>  <code>pk.c</code>是<code>mbedtls</code>用于抽象非对称加密的抽象层文件, 提供了对<code>RSA</code>, <code>ECC</code>的支持。</p><p><strong>签名</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">pk_sign_test</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_pk_context pk_pri_ctx;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> sign_info[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> md[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0x69</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xb7</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0x60</span>&#125;;<span class="hljs-comment">//md摘要值</span><br>    <span class="hljs-type">size_t</span> size;<br><br>    mbedtls_pk_init(&amp;pk_pri_ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>    <span class="hljs-type">int</span> ret = mbedtls_pk_parse_key(&amp;pk_pri_ctx, sub_key, <span class="hljs-keyword">sizeof</span>(sub_key), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, mbedtls_ctr_drbg_random, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parse pri key:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-built_in">memset</span>(sign_info, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(sign_info));<br>    ret = mbedtls_pk_sign(&amp;pk_pri_ctx, MBEDTLS_MD_MD5, md, <span class="hljs-number">0</span>, sign_info, <span class="hljs-keyword">sizeof</span>(sign_info), &amp;size, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;sign:%s size:%d\r\n&quot;</span>, ret ? <span class="hljs-string">&quot;FAIL&quot;</span> : <span class="hljs-string">&quot;OK&quot;</span>, size);<br>    show_message(<span class="hljs-string">&quot;PK SIGN:\r\n&quot;</span>, sign_info, size);<br><br>    mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>    mbedtls_pk_free(&amp;pk_pri_ctx);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>验签</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">pk_verfiy_test</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> md[<span class="hljs-number">16</span>] = &#123; <span class="hljs-number">0x69</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xb7</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0x60</span>&#125;;<span class="hljs-comment">//md摘要值</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> sign_info[<span class="hljs-number">256</span>] = &#123;<br>    	<span class="hljs-number">0X51</span>,<span class="hljs-number">0X05</span>,<span class="hljs-number">0X8d</span>,<span class="hljs-number">0X10</span>,<span class="hljs-number">0X63</span>,<span class="hljs-number">0X2a</span>,<span class="hljs-number">0Xe3</span>,<span class="hljs-number">0Xfe</span>,<span class="hljs-number">0X6b</span>,<span class="hljs-number">0Xfd</span>,<span class="hljs-number">0X1d</span>,<span class="hljs-number">0Xc6</span>,<span class="hljs-number">0Xd2</span>,<span class="hljs-number">0X15</span>,<span class="hljs-number">0X32</span>,<span class="hljs-number">0X84</span>,<br>    	<span class="hljs-number">0X7f</span>,<span class="hljs-number">0Xa0</span>,<span class="hljs-number">0X01</span>,<span class="hljs-number">0Xb1</span>,<span class="hljs-number">0Xfd</span>,<span class="hljs-number">0Xae</span>,<span class="hljs-number">0X50</span>,<span class="hljs-number">0X1d</span>,<span class="hljs-number">0X48</span>,<span class="hljs-number">0X86</span>,<span class="hljs-number">0X7e</span>,<span class="hljs-number">0X30</span>,<span class="hljs-number">0X09</span>,<span class="hljs-number">0X97</span>,<span class="hljs-number">0X81</span>,<span class="hljs-number">0Xae</span>,<br>    	<span class="hljs-number">0X57</span>,<span class="hljs-number">0Xda</span>,<span class="hljs-number">0X82</span>,<span class="hljs-number">0Xae</span>,<span class="hljs-number">0X9b</span>,<span class="hljs-number">0Xde</span>,<span class="hljs-number">0X88</span>,<span class="hljs-number">0X2d</span>,<span class="hljs-number">0Xbc</span>,<span class="hljs-number">0X13</span>,<span class="hljs-number">0X33</span>,<span class="hljs-number">0X7b</span>,<span class="hljs-number">0X8d</span>,<span class="hljs-number">0Xcf</span>,<span class="hljs-number">0Xdb</span>,<span class="hljs-number">0Xa3</span>,<br>    	<span class="hljs-number">0Xc7</span>,<span class="hljs-number">0Xe6</span>,<span class="hljs-number">0X6c</span>,<span class="hljs-number">0X15</span>,<span class="hljs-number">0X2c</span>,<span class="hljs-number">0X2d</span>,<span class="hljs-number">0Xa3</span>,<span class="hljs-number">0X4f</span>,<span class="hljs-number">0Xc9</span>,<span class="hljs-number">0Xfd</span>,<span class="hljs-number">0X23</span>,<span class="hljs-number">0Xcc</span>,<span class="hljs-number">0Xed</span>,<span class="hljs-number">0X0e</span>,<span class="hljs-number">0X58</span>,<span class="hljs-number">0X8a</span>,<br>    	<span class="hljs-number">0X02</span>,<span class="hljs-number">0Xad</span>,<span class="hljs-number">0X6e</span>,<span class="hljs-number">0X78</span>,<span class="hljs-number">0X6b</span>,<span class="hljs-number">0X67</span>,<span class="hljs-number">0Xa7</span>,<span class="hljs-number">0X46</span>,<span class="hljs-number">0X2d</span>,<span class="hljs-number">0Xfd</span>,<span class="hljs-number">0Xee</span>,<span class="hljs-number">0X27</span>,<span class="hljs-number">0X39</span>,<span class="hljs-number">0X26</span>,<span class="hljs-number">0Xb1</span>,<span class="hljs-number">0X58</span>,<br>    	<span class="hljs-number">0X6f</span>,<span class="hljs-number">0X69</span>,<span class="hljs-number">0X12</span>,<span class="hljs-number">0X1c</span>,<span class="hljs-number">0X44</span>,<span class="hljs-number">0X0f</span>,<span class="hljs-number">0Xcd</span>,<span class="hljs-number">0X0b</span>,<span class="hljs-number">0X82</span>,<span class="hljs-number">0Xa3</span>,<span class="hljs-number">0X41</span>,<span class="hljs-number">0X05</span>,<span class="hljs-number">0Xc1</span>,<span class="hljs-number">0Xc4</span>,<span class="hljs-number">0Xe6</span>,<span class="hljs-number">0Xdd</span>,<br>    	<span class="hljs-number">0Xba</span>,<span class="hljs-number">0X29</span>,<span class="hljs-number">0X02</span>,<span class="hljs-number">0X2e</span>,<span class="hljs-number">0X1b</span>,<span class="hljs-number">0X96</span>,<span class="hljs-number">0X6d</span>,<span class="hljs-number">0Xda</span>,<span class="hljs-number">0X85</span>,<span class="hljs-number">0X6a</span>,<span class="hljs-number">0X7b</span>,<span class="hljs-number">0Xa5</span>,<span class="hljs-number">0X4f</span>,<span class="hljs-number">0Xc1</span>,<span class="hljs-number">0Xc2</span>,<span class="hljs-number">0X0e</span>,<br>    	<span class="hljs-number">0Xb2</span>,<span class="hljs-number">0X40</span>,<span class="hljs-number">0X05</span>,<span class="hljs-number">0Xae</span>,<span class="hljs-number">0X88</span>,<span class="hljs-number">0Xb5</span>,<span class="hljs-number">0X7f</span>,<span class="hljs-number">0Xfb</span>,<span class="hljs-number">0X2e</span>,<span class="hljs-number">0X27</span>,<span class="hljs-number">0X48</span>,<span class="hljs-number">0X8d</span>,<span class="hljs-number">0Xf5</span>,<span class="hljs-number">0X3c</span>,<span class="hljs-number">0X3c</span>,<span class="hljs-number">0X03</span>,<br>    	<span class="hljs-number">0Xe0</span>,<span class="hljs-number">0X75</span>,<span class="hljs-number">0Xda</span>,<span class="hljs-number">0X46</span>,<span class="hljs-number">0Xd2</span>,<span class="hljs-number">0Xda</span>,<span class="hljs-number">0X36</span>,<span class="hljs-number">0X77</span>,<span class="hljs-number">0X9e</span>,<span class="hljs-number">0Xb3</span>,<span class="hljs-number">0Xe6</span>,<span class="hljs-number">0Xf8</span>,<span class="hljs-number">0Xc9</span>,<span class="hljs-number">0X3f</span>,<span class="hljs-number">0X8f</span>,<span class="hljs-number">0X58</span>,<br>    	<span class="hljs-number">0X3f</span>,<span class="hljs-number">0X42</span>,<span class="hljs-number">0X8e</span>,<span class="hljs-number">0X52</span>,<span class="hljs-number">0Xb0</span>,<span class="hljs-number">0X60</span>,<span class="hljs-number">0X10</span>,<span class="hljs-number">0X41</span>,<span class="hljs-number">0Xad</span>,<span class="hljs-number">0Xb5</span>,<span class="hljs-number">0X23</span>,<span class="hljs-number">0Xed</span>,<span class="hljs-number">0X59</span>,<span class="hljs-number">0X68</span>,<span class="hljs-number">0Xbb</span>,<span class="hljs-number">0Xc7</span>,<br>    	<span class="hljs-number">0X03</span>,<span class="hljs-number">0Xad</span>,<span class="hljs-number">0X01</span>,<span class="hljs-number">0Xb3</span>,<span class="hljs-number">0X1f</span>,<span class="hljs-number">0Xee</span>,<span class="hljs-number">0Xfb</span>,<span class="hljs-number">0X94</span>,<span class="hljs-number">0X98</span>,<span class="hljs-number">0Xaa</span>,<span class="hljs-number">0X17</span>,<span class="hljs-number">0X35</span>,<span class="hljs-number">0X50</span>,<span class="hljs-number">0Xe1</span>,<span class="hljs-number">0X7a</span>,<span class="hljs-number">0X9f</span>,<br>    	<span class="hljs-number">0Xcf</span>,<span class="hljs-number">0Xc7</span>,<span class="hljs-number">0X9a</span>,<span class="hljs-number">0X7e</span>,<span class="hljs-number">0X58</span>,<span class="hljs-number">0X90</span>,<span class="hljs-number">0X41</span>,<span class="hljs-number">0Xdb</span>,<span class="hljs-number">0X4c</span>,<span class="hljs-number">0Xf3</span>,<span class="hljs-number">0X22</span>,<span class="hljs-number">0Xff</span>,<span class="hljs-number">0X01</span>,<span class="hljs-number">0Xb2</span>,<span class="hljs-number">0X6c</span>,<span class="hljs-number">0Xa7</span>,<br>    	<span class="hljs-number">0Xe4</span>,<span class="hljs-number">0Xc9</span>,<span class="hljs-number">0Xa0</span>,<span class="hljs-number">0X33</span>,<span class="hljs-number">0Xec</span>,<span class="hljs-number">0Xe6</span>,<span class="hljs-number">0X2d</span>,<span class="hljs-number">0X07</span>,<span class="hljs-number">0X8b</span>,<span class="hljs-number">0X06</span>,<span class="hljs-number">0X54</span>,<span class="hljs-number">0X0c</span>,<span class="hljs-number">0X8d</span>,<span class="hljs-number">0X31</span>,<span class="hljs-number">0X59</span>,<span class="hljs-number">0Xbb</span>,<br>    	<span class="hljs-number">0X1e</span>,<span class="hljs-number">0X80</span>,<span class="hljs-number">0X28</span>,<span class="hljs-number">0X93</span>,<span class="hljs-number">0X27</span>,<span class="hljs-number">0X6c</span>,<span class="hljs-number">0X08</span>,<span class="hljs-number">0X9a</span>,<span class="hljs-number">0Xdc</span>,<span class="hljs-number">0X13</span>,<span class="hljs-number">0Xef</span>,<span class="hljs-number">0Xb9</span>,<span class="hljs-number">0X63</span>,<span class="hljs-number">0X2d</span>,<span class="hljs-number">0X05</span>,<span class="hljs-number">0Xa9</span>,<br>    	<span class="hljs-number">0Xf3</span>,<span class="hljs-number">0X26</span>,<span class="hljs-number">0Xe4</span>,<span class="hljs-number">0Xab</span>,<span class="hljs-number">0X76</span>,<span class="hljs-number">0X4c</span>,<span class="hljs-number">0X43</span>,<span class="hljs-number">0Xd5</span>,<span class="hljs-number">0Xff</span>,<span class="hljs-number">0X98</span>,<span class="hljs-number">0Xde</span>,<span class="hljs-number">0X28</span>,<span class="hljs-number">0Xce</span>,<span class="hljs-number">0Xe5</span>,<span class="hljs-number">0X95</span>,<span class="hljs-number">0X1b</span>,<br>    	<span class="hljs-number">0X93</span>,<span class="hljs-number">0X82</span>,<span class="hljs-number">0X8c</span>,<span class="hljs-number">0X5b</span>,<span class="hljs-number">0X5b</span>,<span class="hljs-number">0Xfd</span>,<span class="hljs-number">0X33</span>,<span class="hljs-number">0X51</span>,<span class="hljs-number">0X7a</span>,<span class="hljs-number">0Xfa</span>,<span class="hljs-number">0X66</span>,<span class="hljs-number">0Xfb</span>,<span class="hljs-number">0X14</span>,<span class="hljs-number">0Xaa</span>,<span class="hljs-number">0X80</span>,<span class="hljs-number">0Xcb</span>,<br>    &#125;;<br>    mbedtls_pk_context pk_ctx;<br>    mbedtls_pk_init(&amp;pk_ctx);<br><br>    <span class="hljs-type">int</span> ret = mbedtls_pk_parse_public_key(&amp;pk_ctx, sub_pub_key, <span class="hljs-keyword">sizeof</span>(sub_pub_key));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parse pub key:%d\r\n&quot;</span>, ret);<br><br>    <span class="hljs-type">int</span> size = mbedtls_pk_get_bitlen(&amp;pk_ctx);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pk key size:%d\r\n&quot;</span>, size);<br><br>    <span class="hljs-type">int</span> can_do = mbedtls_pk_can_do(&amp;pk_ctx, MBEDTLS_PK_RSA);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;can do :%d\r\n&quot;</span>, can_do);<br><br>    ret = mbedtls_pk_verify(&amp;pk_ctx, MBEDTLS_MD_MD5, md, <span class="hljs-number">0</span>,sign_info, <span class="hljs-keyword">sizeof</span>(sign_info));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;verify %s\r\n&quot;</span>, ret ? <span class="hljs-string">&quot;FAIL&quot;</span> : <span class="hljs-string">&quot;OK&quot;</span>);<br>    mbedtls_pk_free(&amp;pk_ctx);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>加密/解密</strong>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">pk_encrypt_decrypt_test</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    mbedtls_ctr_drbg_context ctrl_drbg;<br>	mbedtls_pk_context pk_ctx;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> plaintext[<span class="hljs-number">200</span>];<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> chipher[<span class="hljs-number">300</span>];<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">200</span>];<br>	<span class="hljs-type">size_t</span> chipher_len;<br>	<span class="hljs-type">size_t</span> out_len;<br><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">sizeof</span>(plaintext); i++)<br>	&#123;<br>		plaintext[i] = i;<br>	&#125;<br>	show_message(<span class="hljs-string">&quot;in:\r\n&quot;</span>, plaintext, <span class="hljs-keyword">sizeof</span>(plaintext));<br><br>	<span class="hljs-comment">//加密</span><br>	mbedtls_pk_init(&amp;pk_ctx);<br>    mbedtls_ctr_drbg_init(&amp;ctrl_drbg);<br><br>	<span class="hljs-type">int</span> ret = mbedtls_pk_parse_public_key(&amp;pk_ctx, sub_pub_key, <span class="hljs-keyword">sizeof</span>(sub_pub_key));<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parse pub key:%d\r\n&quot;</span>, ret);<br><br>	<span class="hljs-type">int</span> can_do = mbedtls_pk_can_do(&amp;pk_ctx, MBEDTLS_PK_RSA);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;can do :%d\r\n&quot;</span>, can_do);<br><br>	ret = mbedtls_pk_encrypt(&amp;pk_ctx, plaintext, <span class="hljs-keyword">sizeof</span>(plaintext), chipher, &amp;chipher_len, <span class="hljs-keyword">sizeof</span>(chipher), mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pk encrypt ret:%d len:%d\r\n&quot;</span>, ret, chipher_len);<br><br>	mbedtls_pk_free(&amp;pk_ctx);<br><br>	<span class="hljs-comment">//解密</span><br>	mbedtls_pk_init(&amp;pk_ctx);<br><br>	ret = mbedtls_pk_parse_key(&amp;pk_ctx, sub_key, <span class="hljs-keyword">sizeof</span>(sub_key), <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;parse pri key:%d\r\n&quot;</span>, ret);<br><br>	can_do = mbedtls_pk_can_do(&amp;pk_ctx, MBEDTLS_PK_RSA);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;can do :%d\r\n&quot;</span>, can_do);<br><br>	ret = mbedtls_pk_decrypt(&amp;pk_ctx, chipher, chipher_len, out, &amp;out_len, <span class="hljs-keyword">sizeof</span>(out), &amp;mbedtls_ctr_drbg_random, &amp;ctrl_drbg);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pk decrypt ret:%d len:%d\r\n&quot;</span>, ret, out_len);<br><br>	show_message(<span class="hljs-string">&quot;out:\r\n&quot;</span>, out, out_len);<br>	mbedtls_pk_free(&amp;pk_ctx);<br>	mbedtls_ctr_drbg_free(&amp;ctrl_drbg);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="单向散列函数"><a class="markdownIt-Anchor" href="#单向散列函数"></a> 单向散列函数</h3><p>  <code>mbedtls</code>支持多种单项散列函数, 如:<code>MD5</code>,<code>RIPEMD160</code>, <code>SHA1</code>, <code>SHA224</code>, <code>SHA256</code>, <code>SHA384</code>, <code>SHA512</code>, <code>SHA3-224</code>, <code>SHA3-256</code>, <code>SHA3-512</code>。与此同时, <code>mbedtls</code>为摘要函数提供了统一的访问入口, 在<code>md.c</code>文件中。</p><p>如使用<code>MD5</code>, 需要开启宏:</p><ul><li><code>MBEDTLS_MD_C</code></li><li><code>MBEDTLS_MD5_C</code></li><li><code>MBEDTLS_MD_CAN_MD5</code></li></ul><p>通用使用方法:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> test[] = <span class="hljs-string">&quot;this is a private sign test!&quot;</span>;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> len;<br><span class="hljs-type">mbedtls_md_context_t</span> md_ctx;<br><br>len = mbedtls_md_get_size_from_type(MBEDTLS_MD_MD5);<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[len]; <span class="hljs-comment">//摘要内容</span><br><br>mbedtls_md_init(&amp;md_ctx);<br><span class="hljs-type">int</span> ret = mbedtls_md_setup(&amp;md_ctx, mbedtls_md_info_from_type(MBEDTLS_MD_MD5), <span class="hljs-number">0</span>);<span class="hljs-comment">//采用MD5算法进行摘要</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;steup ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_md_starts(&amp;md_ctx);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;md start ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_md_update(&amp;md_ctx, test, <span class="hljs-built_in">strlen</span>(test));<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;md update ret:%d\r\n&quot;</span>, ret);<br><br>ret = mbedtls_md_finish(&amp;md_ctx, out);<span class="hljs-comment">//摘要完成</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;md finish ret:%d\r\n&quot;</span>, ret);<br><br>mbedtls_md_free(&amp;md_ctx);<br></code></pre></td></tr></table></figure><p>或者单条使用:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> test[] = <span class="hljs-string">&quot;this is a private sign test!&quot;</span>;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> len;<br><span class="hljs-type">mbedtls_md_context_t</span> md_ctx;<br><br>len = mbedtls_md_get_size_from_type(MBEDTLS_MD_MD5);<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[len];<br><br><span class="hljs-type">int</span> ret = mbedtls_md(mbedtls_md_info_from_type(MBEDTLS_MD_MD5), test, <span class="hljs-built_in">strlen</span>(test), out);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;md update ret:%d\r\n&quot;</span>, ret);<br></code></pre></td></tr></table></figure><p>当然也可以不使用统一的入口, 也就是不使用<code>md.c</code>文件, 单独使用<code>dm5</code>如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> ret;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> len;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> out[<span class="hljs-number">16</span>];<br>mbedtls_md5_context md5_ctx;<br><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> test[] = <span class="hljs-string">&quot;this is a private sign test!&quot;</span>;<br><br>mbedtls_md5_init(&amp;md5_ctx);<br>ret  = mbedtls_md5_starts(&amp;md5_ctx);<br>ret |= mbedtls_md5_update(&amp;md5_ctx, test, <span class="hljs-built_in">strlen</span>(test));<br>ret |= mbedtls_md5_finish(&amp;md5_ctx, out);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d\r\n&quot;</span>, ret);<br>mbedtls_md5_free(&amp;md5_ctx);<br></code></pre></td></tr></table></figure><p>测试<code>900 000 000</code>个数据函数结果如下:</p><table><thead><tr><th style="text-align:center">摘要算法</th><th style="text-align:center">摘要时间</th></tr></thead><tbody><tr><td style="text-align:center"><code>MD5</code></td><td style="text-align:center"><code>6.151s</code></td></tr><tr><td style="text-align:center"><code>SHA1</code></td><td style="text-align:center"><code>5.225s</code></td></tr><tr><td style="text-align:center"><code>SHA224</code></td><td style="text-align:center"><code>9.658s</code></td></tr><tr><td style="text-align:center"><code>SHA256</code></td><td style="text-align:center"><code>9.612s</code></td></tr><tr><td style="text-align:center"><code>SHA384</code></td><td style="text-align:center"><code>16.342s</code></td></tr><tr><td style="text-align:center"><code>SHA512</code></td><td style="text-align:center"><code>16.233s</code></td></tr><tr><td style="text-align:center"><code>SHA3-224</code></td><td style="text-align:center"><code>63.555s</code></td></tr><tr><td style="text-align:center"><code>SHA3-256</code></td><td style="text-align:center"><code>67.411s</code></td></tr><tr><td style="text-align:center"><code>SHA3-384</code></td><td style="text-align:center"><code>87.461s</code></td></tr><tr><td style="text-align:center"><code>SHA3-512</code></td><td style="text-align:center"><code>125.836s</code></td></tr></tbody></table><hr><h3 id="参考资料"><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h3><ul><li><a target="_blank" rel="noopener" href="https://github.com/Mbed-TLS/mbedtls">mbedtls</a></li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/" class="category-chain-item">密码学</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E5%8E%9F%E5%88%9B/">#原创</a> <a href="/tags/TLS/">#TLS</a> <a href="/tags/mbedtls/">#mbedtls</a></div></div><div class="license-box my-3"><div class="license-title"><div>mbedtls算法性能测试</div><div>http://example.com/2023/08/16/mbedtls/cipher-performance/085708/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>EtcFly</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年8月16日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年3月5日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/08/16/linux/http-base/112507/" title="http协议基础分析"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">http协议基础分析</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/08/16/tls/protocol/tls1_0/085550/" title="tls1.0协议原理"><span class="hidden-mobile">tls1.0协议原理</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",(function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.14.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.14.1/waline.min.js",(function(){var i=Object.assign({serverURL:"https://etcfly.top:14000/",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://unpkg.com/@waline/emojis@1.1.0/qq"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://github.com/EtcFly" target="_blank" rel="nofollow noopener"><span>Copyright</span></a> <i class="iconfont icon-copyright"></i> <a href="https://etcfly.top:14100/share/yqTLFDlP/%E4%BB%97%E5%89%91%E8%B5%B0%E5%A4%A9%E6%B6%AF" target="_blank" rel="nofollow noopener"><span>2018-2024 EtcFly</span></a><div style="font-size:.85rem"><span>总访问量 <span style="color:#000" id="PVstatic">0</span> 次&nbsp</span> <span>总访客数 <span style="color:#000" id="UVstatic">0</span> 人&nbsp</span> <span>当前在线 <span style="color:#000" id="ACTstatic">0</span> 人&nbsp</span><script src="https://etcfly.top:14200/statistics" defer></script></div><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="js/duration.js"></script></div></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener"></a> </span><span><a href="http://beian.miit.gov.cn/2023000858" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" alt="police-icon"> <span>浙ICP备2023000858号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/jquery.min.js"></script><script src="/live2d-widget/autoload.js"></script><script src="/js/star.js"></script><script src="/js/ribbon.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>