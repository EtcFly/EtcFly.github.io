<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="EtcFly"><meta name="keywords" content=""><meta name="description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介    http通信全称超文本报文传输协议, 是构成万维网w3C的重要基石。如我们日常使用浏览器(webclient)和服务器(webserver)进行数据交互的过程。     https是基于http通讯协议之上封装了一个TLS加密"><meta property="og:type" content="article"><meta property="og:title" content="http协议基础分析"><meta property="og:url" content="http://example.com/2023/08/16/linux/http-base/112507/"><meta property="og:site_name" content="仗剑走天涯"><meta property="og:description" content="版权归作者所有, 转载请保留该部分声明。本文作者：EtcFly原文地址：https:&#x2F;&#x2F;etcfly.top              简介    http通信全称超文本报文传输协议, 是构成万维网w3C的重要基石。如我们日常使用浏览器(webclient)和服务器(webserver)进行数据交互的过程。     https是基于http通讯协议之上封装了一个TLS加密"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/network.jpg"><meta property="article:published_time" content="2023-08-16T11:25:07.000Z"><meta property="article:modified_time" content="2024-03-05T03:41:03.000Z"><meta property="article:author" content="EtcFly"><meta property="article:tag" content="原创 - TCPIP - HTTP"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/img/network.jpg"><title>http协议基础分析 仗剑走天涯</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/fluid-extention.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"example.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!0,offset_factor:4},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"3AEufnWAJdp8cFODp1DXvrQU-MdYXbMMI",app_key:"mGJiL6xVvYv21ygqfynJoCyO",server_url:null,path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Strive For Dream</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="http协议基础分析"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-16 11:25" pubdate>2023年8月16日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 4.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 40 分钟 </span><span id="vvdpost_container_page_pvuv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="vvdpost_value_page_pv">0</span> 次&nbsp&nbsp <i class="iconfont icon-users" aria-hidden="true"></i> <span id="vvdpost_value_page_uv">0</span> 人</span><script>console.log(window.location.pathname);var httpRequest=new XMLHttpRequest;httpRequest.open("POST","https://etcfly.top:14200/poststats",!0),httpRequest.setRequestHeader("Content-type","application/json"),httpRequest.send(JSON.stringify(window.location.pathname)),httpRequest.onreadystatechange=function(){if(4==httpRequest.readyState&&200==httpRequest.status){var e=httpRequest.responseText,t=JSON.parse(e);console.log(t.pv);var o=document.querySelector("#vvdpost_container_page_pvuv");if(console.log(o),o){var n=document.querySelector("#vvdpost_value_page_pv");console.log(n);var s=document.querySelector("#vvdpost_value_page_uv");console.log(s),s&&s&&(n.innerText=t.pv,s.innerText=t.uv,o.style.display="inline")}}}</script></div></div></div></div></div></div><script async src="https://etcfly.top:14100/script.js" data-website-id="1a5c096d-21e5-4556-99b0-28c810c9c868"></script></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">http协议基础分析</h1><p class="note note-info">本文最后更新于：2024年3月5日 凌晨</p><div class="markdown-body"><div class="note note-success"><p>版权归作者所有, 转载请保留该部分声明。<br>本文作者：EtcFly<br>原文地址：<a target="_blank" rel="noopener" href="https://etcfly.top">https://etcfly.top</a></p></div><hr><h1 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h1><blockquote><p>  <code>http</code>通信全称超文本报文传输协议, 是构成万维网<code>w3C</code>的重要基石。如我们日常使用浏览器(<code>webclient</code>)和服务器(<code>webserver</code>)进行数据交互的过程。</p></blockquote><blockquote><p>  <code>https</code>是基于<code>http</code>通讯协议之上封装了一个<code>TLS</code>加密套件, 用于保护数据进行可信交换, 避免信息泄漏。</p></blockquote><hr><h1 id="uri"><a class="markdownIt-Anchor" href="#uri"></a> URI</h1><p>  在<code>web</code>中, 万千的资源各式各样, 如何准确定位每一个资源的准确位置? 统一资源标识符(<code>Uniform Resource Identifier, URI</code>), <code>URI</code>就像因特网上的邮件地址一样, 在全世界范围内唯一标识并定位资源。<code>URI</code>分为两种形式:</p><h2 id="url"><a class="markdownIt-Anchor" href="#url"></a> <code>URL</code></h2><p>  <code>URL</code>称为统一资源定位符, 是<code>URI</code>的一种, <code>URL</code>是最常见运用最广泛的一种资源定位标识符。</p><h3 id="格式"><a class="markdownIt-Anchor" href="#格式"></a> 格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">URL: &lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt;<br></code></pre></td></tr></table></figure><ul><li><code>scheme</code>(方案): 指示服务器获取资源使用的协议</li></ul><blockquote><p>比如<code>http</code>, <code>ftp</code>, <code>smtp</code>等等。</p></blockquote><ul><li><code>user</code>(用户): 某些方案访问资源需要用户名</li></ul><blockquote><p>并非每一个<code>URL</code>都存在这部分, 因为明文提供的用户名和密码是不安全的, 但是早期<code>ftp</code>是提供用户名和密码的。</p></blockquote><ul><li><code>passwd</code>(密码): 用户名所需的密码</li><li><code>host</code>(主机名): 资源宿主服务器的主机名或点分<code>ip</code>地址</li><li><code>port</code>(端口): 宿主服务器箭筒的端口号</li><li><code>path</code>(路径): 包含到达资源的完整路径和文件名</li><li><code>params</code>(参数): 某些方案需要指定输入参数, 参数以名/值对的形式存在(<code>a=10</code>), 多个参数字段以<code>;</code>分隔</li><li><code>query</code>(查询): 某些方案需要传递参数来激活应用程序, 多个参数以<code>&amp;</code>分隔</li><li><code>frag</code>(片段): 一小片或一部分资源的名字(通过#将其与其他部分分隔开, 多个分段以<code>&amp;</code>分隔)</li></ul><h3 id="保留及受限的字符"><a class="markdownIt-Anchor" href="#保留及受限的字符"></a> 保留及受限的字符</h3><p>  在<code>URL</code>中如下几种字符被保留使用, 有些字符会与互联网网关和协议产生混淆, 因此一般不赞成使用。在将其用于保留用途之外场合时, 要在<code>URL</code>中对其进行编码。</p><p><code>%</code> : 保留作为编码字符的转义标志</p><blockquote><p>用于对<code>URL</code>中一些不可见字符, 或者一些非<code>ASCii</code>字符进行转义。使得<code>URL</code>更加可靠安全。<br><img src="/2023/08/16/linux/http-base/112507/URL%E5%90%8D%E7%A7%B0%E8%BD%AC%E4%B9%89.png" srcset="/img/loading.gif" lazyload alt="URL名称转义.png"><br><code>/</code> : 保留用于路径组件中分隔路径段定界符<br><code>.</code> : 保留在路径组件中使用<br><code>..</code>: 保留在路径组件中使用<br><code>:</code> : 方案, 用户名/口令, 主机名/端口 组件的定界符<br><code>#</code> : 保留分段定位符使用<br>代表网页中的一个位置。其右面的字符，就是该位置的标识符, 比如，<code>http://www.example.com/index.html#print</code>就代表网页<code>index.html</code>的<code>print</code>位置。浏览器读取这个<code>URL</code>后，会自动将<code>print</code>位置滚动至可视区域。</p></blockquote><p><code>?</code> : 保留查询字符串定界符使用</p><blockquote><p>分隔实际的<code>URL</code>和参数, 比如传递一个参数<code>http://www.xx.com/test/?name=admin&amp;passwd=123456</code>, <code>?</code>分隔参数<code>name=admin&amp;passwd=123456</code>, 其中, <code>&amp;</code>用于连接两个参数<code>name</code>和<code>passwd</code>, <code>=</code>表示赋值, 以键值对存在。</p></blockquote><p><code>;</code> : 保留参数定界符<br><code>@&amp;=</code> : 在某些方案的上下文中有特殊的含义</p><blockquote><p><code>&amp;</code>用于不同参数之间连接符, <code>=</code>用于传参时以<code>key</code>对传递</p></blockquote><h2 id="urn-统一资源名"><a class="markdownIt-Anchor" href="#urn-统一资源名"></a> <code>URN</code>: 统一资源名</h2><p>  <code>URN</code>作为特定内容的唯一名称使用, 和<code>URL</code>不同, <code>URN</code>与资源目前所处位置无关, 使用<code>URN</code>的好处是可以将资源四处搬移仍然用同一个名字并通过多种网络访问协议来访问资源。(<code>URL</code>资源搬移后, 原<code>URL</code>将失效), 不过<code>URN</code>还处于实验阶段。</p><hr><h1 id="协议"><a class="markdownIt-Anchor" href="#协议"></a> 协议</h1><p>  <code>http</code>采用基本的<code>GET</code>, <code>POST</code>, <code>HEAD</code>, <code>PUT</code>, <code>TARCE</code>, <code>DELETE</code>, <code>OPTIONS</code>等方法进行数据控制, 保证正确的数据交换, 一般<code>http server</code>并不会全部支持所有方法, 其重要原因是 一般<code>http server</code>并不会让用户<code>DELETE</code>(删除) 或者 <code>POST</code> (上传)数据, 因为涉及到用户的权限问题。 在嵌入式领域, 一般基于<code>web client</code> 进行固件的升级, 上传等, 所以一般以<code>POST</code> 和 <code>GET</code> 方式为主。<code>HTTP</code>使用术语流入和流出来描述事务处理的方向。<br><img src="/2023/08/16/linux/http-base/112507/%E5%B8%B8%E8%A7%81HTTP%E6%96%B9%E6%B3%95.png" srcset="/img/loading.gif" lazyload alt="常见HTTP方法.png"></p><p>如下载:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/bin/</span>lz.gzip HTTP<span class="hljs-regexp">/1.1/</span>r/n<br>HOST : www.baidu.com\r\n<br>User-Agent: RT-Thread HTTP Agent\r\n\r\n<br></code></pre></td></tr></table></figure><p>服务器响应:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">HTTP</span>/<span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Server</span>: nginx/<span class="hljs-number">1</span>.<span class="hljs-number">10</span>.<span class="hljs-number">3</span> (Ubuntu)<br><span class="hljs-attribute">Date</span>: Mon, <span class="hljs-number">22</span> Jun <span class="hljs-number">2020</span> <span class="hljs-number">06</span>:<span class="hljs-number">37</span>:<span class="hljs-number">23</span> GMT<br><span class="hljs-attribute">Content</span>-Type: text/html<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">60</span><br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">X</span>-Powered-By: PHP/<span class="hljs-number">5</span>.<span class="hljs-number">5</span>.<span class="hljs-number">9</span>-<span class="hljs-number">1</span>ubuntu4.<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>即可实现在百度的web服务器下载lz.gzip的文件, 数据的一般流向为:<br><img src="/2023/08/16/linux/http-base/112507/HTTP%E4%BB%A3%E7%90%86%E6%B5%81%E5%90%91.png" srcset="/img/loading.gif" lazyload alt="数据流向.png"></p><hr><p>又如上传:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile">POST /service/echo HTTP/1.1<br><span class="hljs-section">Content-Length: 60</span><br><span class="hljs-section">Content-Type: application/octet-stream</span><br><span class="hljs-section">Host: www.rt-thread.com</span><br><span class="hljs-section">User-Agent: RT-Thread HTTP Agent</span><br><span class="hljs-section">Accept: */*</span><br>...  /* 消息实体 */<br></code></pre></td></tr></table></figure><p>服务器响应:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">HTTP</span>/<span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Server</span>: nginx/<span class="hljs-number">1</span>.<span class="hljs-number">10</span>.<span class="hljs-number">3</span> (Ubuntu)<br><span class="hljs-attribute">Date</span>: Mon, <span class="hljs-number">22</span> Jun <span class="hljs-number">2020</span> <span class="hljs-number">06</span>:<span class="hljs-number">37</span>:<span class="hljs-number">23</span> GMT<br><span class="hljs-attribute">Content</span>-Type: text/html<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">60</span><br><span class="hljs-attribute">Connection</span>: keep-alive<br><span class="hljs-attribute">X</span>-Powered-By: PHP/<span class="hljs-number">5</span>.<span class="hljs-number">5</span>.<span class="hljs-number">9</span>-<span class="hljs-number">1</span>ubuntu4.<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><hr><p><code>http</code>协议报文组成一般是 <strong>起始行</strong>、<strong>首部</strong>、<strong>实体</strong> 三部分组成。如下图</p><p><img src="/2023/08/16/linux/http-base/112507/HTTP%E6%8A%A5%E6%96%87%E4%BA%A4%E4%BA%92%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload alt="HTTP报文交互结构.png"></p><p>所有的<code>HTTP</code>报文都可以分为两类: <strong>请求报文</strong>、<strong>响应报文</strong>。请求报文向<code>web</code>服务器请求一个动作, 响应报文会将请求的结果返回客户端。两种报文基本结构相同, 包含如下三部分:</p><ul><li><strong>起始行：</strong> 所有<code>HTTP</code>报文都以一个起始行作为开始, 请求行和响应格式稍有差异:</li></ul><blockquote><ul><li>请求行: 指明<code>http</code>协议使用的协议版本, 操作的方法以及获取的具体文件。</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">GET /test.py HTTP/<span class="hljs-number">1.1</span><br></code></pre></td></tr></table></figure><p>表示<code>GET</code>方法, 请求资源为<code>/</code>路径下<code>test.py</code>, 请求协议为<code>HTTP</code>协议, 版本<code>v1.1</code>(注意: 请求行并不要求一定包含<code>HTTP</code>协议版本), 这几个部分以空格分隔开。</p><blockquote><ul><li>响应行: 响应行包含响应报文使用的<code>HTTP</code>协议版本, 数字状态码、以及简单的描述性短语。</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK<br></code></pre></td></tr></table></figure><ul><li><strong>首部：</strong> 以键值对的形式存在, 如<code>contex-length :19</code>表示实体为<code>19</code>Byte, 键值对之间用<code>：</code>来分隔, 首部以一个空行结束(<code>\r\n</code>)。</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">Content-type: text/plain<br>Content-length: <span class="hljs-number">19</span><br></code></pre></td></tr></table></figure><ul><li><strong>实体：</strong> 获取的文件具体内容, <code>HI! I'm a Messaage</code>, 主体是一个可选的部分, 其包含所有类型的数据。实体是首部以空行(<code>\r\n</code>)结束后连接的输出。</li></ul><hr><h1 id="首部"><a class="markdownIt-Anchor" href="#首部"></a> 首部</h1><p>其中首部又可以5种类型:</p><ul><li>通用首部</li></ul><blockquote><p>这些是客户端和服务器都可以使用的通用首部。可以在客户端、服务器和其他应用程序之间提供一些非常有用的通用功能。比如，Date首部就是一个通用首部，每一端都可以用它来说明构建报文的时间和日期<code>Date： Tue， 3 Oct 1974 02： 16： 00 GMT</code></p></blockquote><p><img src="/2023/08/16/linux/http-base/112507/HTTP%E9%80%9A%E7%94%A8%E9%A6%96%E9%83%A8.png" srcset="/img/loading.gif" lazyload alt="通用首部.png"></p><ul><li>实体首部</li></ul><blockquote><p>实体首部指的是用于应对实体主体部分的首部。比如，可以用实体首部来说明实体主体部分的数据类型。例如，可以通过下列 &gt;Content-Type首部告知应用程序，数据是以iso- latin-1字符集表示的HTML文档：<br>  <code>Content-Type： text/html： charset=iso-latin-1</code></p></blockquote><p><img src="/2023/08/16/linux/http-base/112507/HTTP%E5%AE%9E%E4%BD%93%E9%A6%96%E9%83%A8.png" srcset="/img/loading.gif" lazyload alt="实体首部"></p><ul><li>请求首部</li></ul><blockquote><p>从名字中就可以看出，请求首部是请求报文特有的。它们为服务器提供了一些额外信息，比如客户端希望接收什么类型的数据。例如，下面的 Accep首部就用来告知服务器客户端会接受与其请求相符的任意媒体类型：<br>  <code>Accept： */*</code></p></blockquote><p><img src="/2023/08/16/linux/http-base/112507/HTTP%E8%AF%B7%E6%B1%82%E9%A6%96%E9%83%A8.png" srcset="/img/loading.gif" lazyload alt="请求首部.png"></p><ul><li>响应首部</li></ul><blockquote><p>响应报文有自己的首部集，以便为客户端提供信息（比如，客户端在与哪种类型的服务器进行交互）.例如，下列 Server首部就用来告知客&gt; 户端它在与一个版本1.0的 Tiki-Hut服务器进行交互<br>   <code>Server： Tiki-Hut/1.0</code></p></blockquote><p><img src="/2023/08/16/linux/http-base/112507/HTTP%E5%93%8D%E5%BA%94%E9%A6%96%E9%83%A8.png" srcset="/img/loading.gif" lazyload alt="响应首部.png"></p><ul><li>扩展首部</li></ul><blockquote><p>扩展首部是非标准的首部，由应用程序开发者创建，但还未添加到已批准的HTTP规范中去。即使不知道这些扩展首部的含义，HTTP程序也要&gt;接受它们并对其进行转发。</p></blockquote><p>以上首部只是基本的首部分类, 具体点的可以更加细分。可参考 <em><strong>HTTP权威指南</strong></em>， 在嵌入式领域, 用的比较多的是<code>contex-length, HOST, ACCEPT</code>等。</p><hr><p>一般来说, 对于嵌入式端的<code>webclient</code>, 我们主要关心的是响应的状态, 及<code>HTTP/1.1 200 OK</code> 中的 <code>200</code>, 响应的头部一般格式为：</p><p><code>HTTP</code>/&lt;协议版本&gt; &lt;响应状态&gt; &lt;简单描述&gt;</p><ul><li><strong>协议版本:</strong> 目前主流的是<code>HTTP/1.1</code>版本, 早期还有<code>HTTP/0.9</code> 和 <code>HTTP/1.0</code> 版本, 但是其对数据种类以及扩展性能不足被时代淘汰, 但是现在仍有机器在运行这个版本的协议。</li><li><strong>响应状态:</strong> 响应状态是服务器对用户请求的响应。HTTP支持5类状态码, 但是由于其复杂性备受争议而收到限制。</li></ul><blockquote><ul><li>100-199: 信息性状态码</li><li>200-299: 成功状态码(请求成功)</li><li>300-399: 重定向状态码(资源被移走)</li><li>400-499: 客户端错误码(客户端出错)</li><li>500-599: 服务器错误码(服务器出错)</li></ul></blockquote><p>通常我们使用<code>200, 301， 302， 404</code>等。</p><p><strong>Note:</strong><br>  1. <code>http</code>一般每一行都必须以<code>\r\n</code>作为结尾, 但是为了和老旧机机器兼容, 如果是<code>\r</code> 或者 <code>\n</code> 软件也应该正确解析。<br>  2. <code>http</code>实体结束或者空实体都必须使用两个<code>\r\n</code>来标明<code>http</code>结束，及除了行结束的<code>\r\n</code>, 还必须加一个空行<code>\r\n</code></p><p>对于<code>http</code>报文传输格式, 主要标识为两类</p><ul><li><strong>Content-length:</strong> 指明实体的长度</li></ul><blockquote><p>主要通过在<code>Get</code> 或者<code>POST</code>阶段, 直接给出实体长度进行数据传输。也就是说, 接受方在接受数据的开始就已经知道了待接受数据的长度是多少。</p></blockquote><ul><li><strong>[Transfer-Encoding : chunked]:</strong> 分块传输</li></ul><blockquote><p>分块传输计数, 主要用于动态页面等实时生成的页面的传输, 如果使用传统的手段, 需要将这个页面缓存到内存中, 等到缓存更新完成后, 计算这个页面的大小, 并开始整个传输。 这个过程就存在几个缺点</p><ul><li>用户端显示延迟(比如加载一个页面, 由于服务端没有更新完成, 但是更新了大部分, 而不发分发给客户端, 导致客户端页面空白, 影响用户体验)</li><li>需要在内存中开辟较大的内存进行页面缓存</li></ul><p>如果使用分块加载就可以避免上述的缺点, 在没有更新完成的情况下在客户端显示。</p><p><strong>chunked模式的一般格式</strong><br>在每一个实体部分开始有一个十六进制的<code>chunked</code>长度编码, 标明当前实体的长度。通常<code>chunked</code>结束会使用一个0长度的头部接<code>\r\n</code>作为本次<code>GET</code>, <code>POS</code>等<code>HTTP</code>方法的结束。<br><img src="/2023/08/16/linux/http-base/112507/HTTP%E6%8A%93%E5%8C%85chunked%E6%A8%A1%E5%BC%8F.png" srcset="/img/loading.gif" lazyload alt="Chunked.png"><br>上图中长度为<code>31 34</code>, 并以<code>0d 0a</code>标识结束, <code>31 34</code>为<code>ASCII</code>的<code>1 4</code>, 标明数据长度为<code>0X14</code>为20字节, 于是乎<code>1F 8B 08 00 00 00 00 00 00 03 03 00 00 00 00 00 00 00 00 00</code> 这20字节就是实体的数据长度, 并以<code>0d 0a</code>为结尾, 后面<code>30</code>为ASCII值<code>0</code>并以<code>0d 0a</code>结尾, 标明下一个<code>chunke</code>长度为0, 最后<code>0d 0a</code>是通常大家约定多加的。 客户端接受到<code>0</code>长度的<code>chunked</code>实体就知道传输结束。</p></blockquote></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" class="category-chain-item">网络协议</a> <span>></span> <a href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/HTTP/" class="category-chain-item">HTTP</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E5%8E%9F%E5%88%9B-TCPIP-HTTP/">#原创 - TCPIP - HTTP</a></div></div><div class="license-box my-3"><div class="license-title"><div>http协议基础分析</div><div>http://example.com/2023/08/16/linux/http-base/112507/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>EtcFly</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年8月16日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2024年3月5日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/08/16/tls/protocol/psk/163823/" title="tls加密之psk原理分析"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">tls加密之psk原理分析</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/08/16/mbedtls/cipher-performance/085708/" title="mbedtls算法性能测试"><span class="hidden-mobile">mbedtls算法性能测试</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments"><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",(function(){Fluid.utils.createCssLink("https://lib.baomitu.com/waline/2.14.1/waline.min.css"),Fluid.utils.createScript("https://lib.baomitu.com/waline/2.14.1/waline.min.js",(function(){var i=Object.assign({serverURL:"https://etcfly.top:14000/",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://unpkg.com/@waline/emojis@1.1.0/qq"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://github.com/EtcFly" target="_blank" rel="nofollow noopener"><span>Copyright</span></a> <i class="iconfont icon-copyright"></i> <a href="https://etcfly.top:14100/share/yqTLFDlP/%E4%BB%97%E5%89%91%E8%B5%B0%E5%A4%A9%E6%B6%AF" target="_blank" rel="nofollow noopener"><span>2018-2024 EtcFly</span></a><div style="font-size:.85rem"><span>总访问量 <span style="color:#000" id="PVstatic">0</span> 次&nbsp</span> <span>总访客数 <span style="color:#000" id="UVstatic">0</span> 人&nbsp</span> <span>当前在线 <span style="color:#000" id="ACTstatic">0</span> 人&nbsp</span><script src="https://etcfly.top:14200/statistics" defer></script></div><div style="font-size:.85rem"><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="js/duration.js"></script></div></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener"></a> </span><span><a href="http://beian.miit.gov.cn/2023000858" rel="nofollow noopener" class="beian-police" target="_blank"><span style="visibility:hidden;width:0">|</span> <img src="/img/police_beian.png" alt="police-icon"> <span>浙ICP备2023000858号</span></a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/jquery.min.js"></script><script src="/live2d-widget/autoload.js"></script><script src="/js/star.js"></script><script src="/js/ribbon.min.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>